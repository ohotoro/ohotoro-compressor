<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OHOTORO HORIE Optimizer</title>
    
    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@ffmpeg/ffmpeg@0.11.6/dist/ffmpeg.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@ffmpeg/core@0.11.0/dist/ffmpeg-core.js"></script>
    
    <style>
        /* 기본 리셋 및 폰트 설정 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Helvetica Neue', Arial, sans-serif;
            background: #f6f6f6;
            color: #111;
            line-height: 1.6;
            font-size: 13px;
            letter-spacing: 0.02em;
        }

        /* 메인 컨테이너 */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 60px 40px;
        }

        /* 헤더 */
        header {
            text-align: center;
            margin-bottom: 60px;
            position: relative;
        }

        h1 {
            font-size: 11px;
            font-weight: 400;
            letter-spacing: 0.3em;
            text-transform: uppercase;
            margin-bottom: 8px;
        }

        .subtitle {
            font-size: 10px;
            color: #666;
            letter-spacing: 0.15em;
        }

        /* 언어 전환 버튼 */
        .language-switch {
            position: absolute;
            top: 20px;
            left: 40px;
            display: flex;
            gap: 8px;
        }

        .lang-btn {
            padding: 6px 12px;
            background: none;
            border: 1px solid #e6e6e6;
            font-size: 10px;
            letter-spacing: 0.1em;
            cursor: pointer;
            color: #999;
            transition: all 0.3s ease;
        }

        .lang-btn:hover {
            border-color: #999;
            color: #111;
        }

        .lang-btn.active {
            background: #111;
            color: #fff;
            border-color: #111;
        }

        /* 탭 네비게이션 */
        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 50px;
            border-bottom: 1px solid #e6e6e6;
        }

        .tab {
            padding: 12px 40px;
            background: none;
            border: none;
            font-size: 11px;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            cursor: pointer;
            color: #999;
            transition: color 0.3s ease;
            position: relative;
        }

        .tab:hover {
            color: #111;
        }

        .tab.active {
            color: #111;
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            right: 0;
            height: 1px;
            background: #111;
        }

        /* 탭 콘텐츠 */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* 업로드 영역 */
        .upload-area {
            border: 1px dashed #e6e6e6;
            border-radius: 0;
            padding: 80px 40px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            background: #fff;
            margin-bottom: 40px;
        }

        .upload-area:hover {
            border-color: #999;
            background: #fafafa;
        }

        .upload-area.dragover {
            border-color: #111;
            background: #f5f5f5;
        }

        .upload-icon {
            font-size: 32px;
            margin-bottom: 16px;
            color: #999;
        }

        .upload-text {
            font-size: 11px;
            letter-spacing: 0.1em;
            color: #666;
            text-transform: uppercase;
            margin-bottom: 8px;
        }

        .upload-subtext {
            font-size: 10px;
            color: #999;
        }

        input[type="file"] {
            display: none;
        }

        /* 설정 패널 */
        .settings-panel {
            background: #fff;
            padding: 40px;
            margin-bottom: 30px;
            border: 1px solid #e6e6e6;
        }

        .settings-group {
            margin-bottom: 30px;
        }

        .settings-group:last-child {
            margin-bottom: 0;
        }

        .settings-label {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: #666;
            margin-bottom: 12px;
            display: block;
        }

        /* 라디오 버튼 그룹 */
        .radio-group {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .radio-option {
            position: relative;
            cursor: pointer;
            padding: 8px 16px;
            border: 1px solid #e6e6e6;
            font-size: 11px;
            transition: all 0.3s ease;
            background: #fff;
        }

        .radio-option:hover {
            border-color: #999;
        }

        .radio-option input {
            position: absolute;
            opacity: 0;
        }

        .radio-option.selected {
            background: #111;
            color: #fff;
            border-color: #111;
        }

        /* 커스텀 입력 */
        .custom-input {
            display: none;
            margin-top: 12px;
        }

        .custom-input.active {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .custom-input input {
            width: 100px;
            padding: 8px 12px;
            border: 1px solid #e6e6e6;
            font-size: 11px;
            background: #fff;
            transition: border-color 0.3s ease;
        }

        .custom-input input:focus {
            outline: none;
            border-color: #111;
        }

        .custom-input span {
            font-size: 11px;
            color: #666;
        }

        /* 체크박스 */
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-top: 8px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
        }

        .checkbox-item input[type="checkbox"] {
            width: 14px;
            height: 14px;
            cursor: pointer;
        }

        .checkbox-item label {
            font-size: 11px;
            color: #666;
            cursor: pointer;
        }

        /* 파일 리스트 */
        .file-list {
            display: none;
            margin-bottom: 30px;
            background: #fff;
            border: 1px solid #e6e6e6;
        }

        .file-item {
            padding: 16px 20px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.3s ease;
        }

        .file-item:last-child {
            border-bottom: none;
        }

        .file-item:hover {
            background: #fafafa;
        }

        .file-info {
            flex: 1;
        }

        .file-name {
            font-size: 11px;
            color: #111;
            margin-bottom: 4px;
        }

        .file-size {
            font-size: 10px;
            color: #999;
        }

        .file-status {
            font-size: 10px;
            color: #999;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .file-status.processing {
            color: #f5a623;
        }

        .file-status.complete {
            color: #4caf50;
        }

        .file-status.error {
            color: #f44336;
        }

        /* 버튼 */
        .buttons {
            display: none;
            gap: 16px;
            justify-content: center;
            margin-bottom: 30px;
        }

        .btn {
            padding: 12px 32px;
            background: #111;
            color: #fff;
            border: none;
            font-size: 10px;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn:hover {
            background: #333;
            transform: translateY(-1px);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: #fff;
            color: #111;
            border: 1px solid #e6e6e6;
        }

        .btn-secondary:hover {
            background: #f5f5f5;
            border-color: #999;
        }

        /* 통계 */
        .stats {
            display: none;
            background: #fff;
            padding: 30px;
            border: 1px solid #e6e6e6;
            margin-bottom: 30px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 30px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-label {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: #999;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 300;
            color: #111;
        }

        /* 로딩 */
        .loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.98);
            padding: 40px;
            border: 1px solid #e6e6e6;
            text-align: center;
            z-index: 1000;
            display: none;
        }

        .loading.active {
            display: block;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #111;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 11px;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            color: #666;
        }

        /* 진행률 바 */
        .progress-bar {
            width: 100%;
            height: 2px;
            background: #f0f0f0;
            margin: 30px 0;
            position: relative;
            display: none;
        }

        .progress-bar.active {
            display: block;
        }

        .progress-fill {
            height: 100%;
            background: #111;
            width: 0;
            transition: width 0.5s ease;
        }

        /* 메시지 */
        .success-message {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: #111;
            color: #fff;
            padding: 12px 20px;
            font-size: 11px;
            letter-spacing: 0.1em;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s ease;
            z-index: 1001;
        }

        .success-message.active {
            opacity: 1;
            transform: translateY(0);
        }

        /* 크롭 에디터 스타일 추가 */
        .crop-editor {
            display: none;
            background: #fff;
            border: 1px solid #e6e6e6;
            padding: 30px;
            margin-bottom: 30px;
        }

        .crop-editor.active {
            display: block;
        }

        .crop-container {
            position: relative;
            max-width: 800px;
            margin: 0 auto 30px;
            background: #f9f9f9;
            border: 1px solid #e6e6e6;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 400px;
        }

        .crop-canvas {
            max-width: 100%;
            max-height: 600px;
            display: block;
            cursor: crosshair;
        }

        .crop-overlay {
            position: absolute;
            border: 2px dashed #111;
            background: rgba(255, 255, 255, 0.3);
            pointer-events: none;
        }

        .crop-handle {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #111;
            border: 2px solid #fff;
            pointer-events: all;
            cursor: move;
        }

        .crop-handle.nw { top: -5px; left: -5px; cursor: nw-resize; }
        .crop-handle.ne { top: -5px; right: -5px; cursor: ne-resize; }
        .crop-handle.sw { bottom: -5px; left: -5px; cursor: sw-resize; }
        .crop-handle.se { bottom: -5px; right: -5px; cursor: se-resize; }

        .crop-controls {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 20px;
        }

        .crop-ratio-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .crop-ratio-btn {
            padding: 8px 16px;
            background: #fff;
            border: 1px solid #e6e6e6;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .crop-ratio-btn:hover {
            border-color: #999;
        }

        .crop-ratio-btn.active {
            background: #111;
            color: #fff;
            border-color: #111;
        }

        .crop-info {
            text-align: center;
            font-size: 10px;
            color: #999;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            margin-top: 10px;
        }

        /* 미리보기 모달 */
        .preview-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .preview-modal.active {
            display: flex;
        }

        .preview-content {
            max-width: 90%;
            max-height: 90%;
            position: relative;
        }

        .preview-image {
            max-width: 100%;
            max-height: 80vh;
            display: block;
        }

        .preview-close {
            position: absolute;
            top: -40px;
            right: 0;
            background: none;
            border: none;
            color: #fff;
            font-size: 30px;
            cursor: pointer;
            line-height: 1;
        }

        .preview-info {
            color: #fff;
            text-align: center;
            margin-top: 20px;
            font-size: 11px;
            letter-spacing: 0.1em;
        }

        /* Settings 버튼 스타일 */
        .settings-btn {
            position: fixed;
            bottom: 30px;
            left: 30px;
            padding: 10px 20px;
            background: #fff;
            border: 1px solid #e6e6e6;
            font-size: 10px;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .settings-btn:hover {
            background: #111;
            color: #fff;
            border-color: #111;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 헤더 -->
        <header>
            <div class="language-switch">
                <button class="lang-btn" data-lang="ko">한국어</button>
                <button class="lang-btn active" data-lang="en">English</button>
            </div>
            <h1 id="main-title">OHOTORO HORIE Optimizer</h1>
            <div class="subtitle" id="main-subtitle">Professional Media Optimization Suite</div>
        </header>

        <!-- 탭 네비게이션 -->
        <div class="tabs">
            <button class="tab active" data-tab="image">Image</button>
            <button class="tab" data-tab="video">Video</button>
        </div>

        <!-- 이미지 탭 -->
        <div class="tab-content active" id="image-tab">
            <!-- 업로드 영역 -->
            <div class="upload-area" id="image-upload-area">
                <div class="upload-icon">📷</div>
                <div class="upload-text" id="image-upload-text">Drop images here</div>
                <div class="upload-subtext" id="image-upload-subtext">or click to select</div>
            </div>
            <input type="file" id="image-input" accept="image/*" multiple>

            <!-- 크롭 에디터 -->
            <div class="crop-editor" id="crop-editor">
                <div class="settings-label" id="crop-label">CROP SETTINGS</div>
                
                <div class="crop-controls">
                    <div class="crop-ratio-group">
                        <button class="crop-ratio-btn active" data-ratio="5:7">5:7 (Default)</button>
                        <button class="crop-ratio-btn" data-ratio="free">Free</button>
                        <button class="crop-ratio-btn" data-ratio="1:1">1:1</button>
                        <button class="crop-ratio-btn" data-ratio="4:3">4:3</button>
                        <button class="crop-ratio-btn" data-ratio="16:9">16:9</button>
                        <button class="crop-ratio-btn" data-ratio="3:2">3:2</button>
                        <button class="crop-ratio-btn" data-ratio="9:16">9:16</button>
                    </div>
                </div>

                <div class="crop-container">
                    <canvas class="crop-canvas" id="crop-canvas"></canvas>
                    <div class="crop-overlay" id="crop-overlay">
                        <div class="crop-handle nw"></div>
                        <div class="crop-handle ne"></div>
                        <div class="crop-handle sw"></div>
                        <div class="crop-handle se"></div>
                    </div>
                </div>

                <div class="crop-info" id="crop-info">
                    <span id="crop-dimensions">0 x 0</span>
                </div>

                <div class="buttons" style="display: flex; margin-top: 20px;">
                    <button class="btn btn-secondary" id="crop-preview">Preview</button>
                    <button class="btn btn-secondary" id="crop-reset">Reset</button>
                    <button class="btn" id="crop-apply">Apply Crop</button>
                    <button class="btn btn-secondary" id="crop-skip">Skip Crop</button>
                </div>
            </div>

            <!-- 설정 패널 -->
            <div class="settings-panel" id="image-settings" style="display: none;">
                <!-- 품질 설정 -->
                <div class="settings-group">
                    <label class="settings-label" id="quality-label">Quality</label>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="quality" value="low">
                            <span id="quality-low">Low (60)</span>
                        </label>
                        <label class="radio-option selected">
                            <input type="radio" name="quality" value="medium" checked>
                            <span id="quality-medium">Medium (80)</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="quality" value="high">
                            <span id="quality-high">High (92)</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="quality" value="custom">
                            <span id="quality-custom">Custom</span>
                        </label>
                    </div>
                    <div class="custom-input" id="quality-custom-input">
                        <input type="number" id="quality-custom-value" min="1" max="100" value="85">
                        <span>(1-100)</span>
                    </div>
                </div>

                <!-- 크기 조정 -->
                <div class="settings-group">
                    <label class="settings-label" id="size-label">Max Width</label>
                    <div class="radio-group">
                        <label class="radio-option selected">
                            <input type="radio" name="size" value="original" checked>
                            <span id="size-original">Original</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="size" value="1920">
                            <span>1920px</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="size" value="1280">
                            <span>1280px</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="size" value="800">
                            <span>800px</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="size" value="custom">
                            <span id="size-custom">Custom</span>
                        </label>
                    </div>
                    <div class="custom-input" id="size-custom-input">
                        <input type="number" id="size-custom-value" min="100" max="5000" value="1600">
                        <span>px</span>
                    </div>
                </div>

                <!-- 포맷 변환 -->
                <div class="settings-group">
                    <label class="settings-label" id="format-label">Output Format</label>
                    <div class="radio-group">
                        <label class="radio-option selected">
                            <input type="radio" name="format" value="original" checked>
                            <span id="format-original">Keep Original</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="format" value="jpeg">
                            <span>JPEG</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="format" value="png">
                            <span>PNG</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="format" value="webp">
                            <span>WebP</span>
                        </label>
                    </div>
                </div>

                <!-- 추가 옵션 -->
                <div class="settings-group">
                    <label class="settings-label" id="options-label">Additional Options</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="remove-metadata">
                            <label for="remove-metadata" id="metadata-label">Remove metadata</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="progressive" checked>
                            <label for="progressive" id="progressive-label">Progressive encoding</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 파일 리스트 -->
            <div class="file-list" id="image-file-list"></div>

            <!-- 버튼들 -->
            <div class="buttons" id="image-buttons">
                <button class="btn" id="image-process">Process Images</button>
                <button class="btn btn-secondary" id="image-clear">Clear All</button>
                <button class="btn" id="image-download" style="display: none;">Download All</button>
            </div>

            <!-- 진행률 바 -->
            <div class="progress-bar" id="image-progress">
                <div class="progress-fill"></div>
            </div>

            <!-- 통계 -->
            <div class="stats" id="image-stats">
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-label" id="stat-files">Total Files</div>
                        <div class="stat-value" id="image-total-files">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label" id="stat-original">Original Size</div>
                        <div class="stat-value" id="image-original-size">0 MB</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label" id="stat-compressed">Compressed Size</div>
                        <div class="stat-value" id="image-compressed-size">0 MB</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label" id="stat-saved">Space Saved</div>
                        <div class="stat-value" id="image-saved">0%</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 비디오 탭 -->
        <div class="tab-content" id="video-tab">
            <!-- 업로드 영역 -->
            <div class="upload-area" id="video-upload-area">
                <div class="upload-icon">🎬</div>
                <div class="upload-text" id="video-upload-text">Drop videos here</div>
                <div class="upload-subtext" id="video-upload-subtext">or click to select</div>
            </div>
            <input type="file" id="video-input" accept="video/*" multiple>

            <!-- 설정 패널 -->
            <div class="settings-panel" id="video-settings" style="display: none;">
                <!-- 품질 설정 -->
                <div class="settings-group">
                    <label class="settings-label" id="video-quality-label">Video Quality</label>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="video-quality" value="low">
                            <span id="video-quality-low">Low</span>
                        </label>
                        <label class="radio-option selected">
                            <input type="radio" name="video-quality" value="medium" checked>
                            <span id="video-quality-medium">Medium</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="video-quality" value="high">
                            <span id="video-quality-high">High</span>
                        </label>
                    </div>
                </div>

                <!-- 해상도 설정 -->
                <div class="settings-group">
                    <label class="settings-label" id="video-resolution-label">Resolution</label>
                    <div class="radio-group">
                        <label class="radio-option selected">
                            <input type="radio" name="video-resolution" value="original" checked>
                            <span id="video-resolution-original">Keep Original</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="video-resolution" value="1080">
                            <span>1080p</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="video-resolution" value="720">
                            <span>720p</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="video-resolution" value="480">
                            <span>480p</span>
                        </label>
                    </div>
                </div>

                <!-- 추가 옵션 -->
                <div class="settings-group">
                    <label class="settings-label" id="video-options-label">Options</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="remove-audio">
                            <label for="remove-audio" id="audio-label">Remove audio</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 파일 리스트 -->
            <div class="file-list" id="video-file-list"></div>

            <!-- 버튼들 -->
            <div class="buttons" id="video-buttons">
                <button class="btn" id="video-process">Process Videos</button>
                <button class="btn btn-secondary" id="video-clear">Clear All</button>
                <button class="btn" id="video-download" style="display: none;">Download All</button>
            </div>

            <!-- 진행률 바 -->
            <div class="progress-bar" id="video-progress">
                <div class="progress-fill"></div>
            </div>

            <!-- 통계 -->
            <div class="stats" id="video-stats">
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-label">Total Files</div>
                        <div class="stat-value" id="video-total-files">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Original Size</div>
                        <div class="stat-value" id="video-original-size">0 MB</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Compressed Size</div>
                        <div class="stat-value" id="video-compressed-size">0 MB</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Space Saved</div>
                        <div class="stat-value" id="video-saved">0%</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 로딩 표시 -->
    <div class="loading" id="image-loading">
        <div class="loading-spinner"></div>
        <div class="loading-text">Processing...</div>
    </div>

    <div class="loading" id="video-loading">
        <div class="loading-spinner"></div>
        <div class="loading-text">Processing...</div>
    </div>

    <!-- 성공 메시지 -->
    <div class="success-message" id="success-message"></div>

    <!-- 미리보기 모달 -->
    <div class="preview-modal" id="preview-modal">
        <div class="preview-content">
            <button class="preview-close" id="preview-close">×</button>
            <img class="preview-image" id="preview-image">
            <div class="preview-info" id="preview-info"></div>
        </div>
    </div>

    <!-- Settings 버튼 -->
    <button class="settings-btn" id="reset-settings">Reset Settings</button>

    <script>
        // ============= 전역 변수 =============
        let imageFiles = [];
        let processedImages = [];
        let videoFiles = [];
        let processedVideos = [];
        let ffmpeg = null;
        let ffmpegLoaded = false;
        let currentLanguage = 'en';
        
        // 크롭 관련 변수
        let cropEditor = {
            canvas: null,
            ctx: null,
            image: null,
            currentImageIndex: 0,
            cropData: [],
            isDragging: false,
            isResizing: false,
            resizeHandle: null,
            startX: 0,
            startY: 0,
            cropX: 0,
            cropY: 0,
            cropWidth: 0,
            cropHeight: 0,
            aspectRatio: 5/7,
            currentRatio: '5:7'
        };

        // ============= 다국어 지원 =============
        const messages = {
            ko: {
                // 헤더
                main_title: 'OHOTORO HORIE 최적화 도구',
                main_subtitle: '전문 미디어 최적화 스위트',
                
                // 탭
                tab_image: '이미지',
                tab_video: '비디오',
                
                // 업로드
                image_upload_text: '이미지를 여기에 놓으세요',
                image_upload_subtext: '또는 클릭하여 선택',
                video_upload_text: '비디오를 여기에 놓으세요',
                video_upload_subtext: '또는 클릭하여 선택',
                
                // 크롭
                crop_label: '크롭 설정',
                crop_preview: '미리보기',
                crop_reset: '초기화',
                crop_apply: '크롭 적용',
                crop_skip: '크롭 건너뛰기',
                
                // 설정 라벨
                quality_label: '품질',
                size_label: '최대 너비',
                format_label: '출력 형식',
                options_label: '추가 옵션',
                video_quality_label: '비디오 품질',
                video_resolution_label: '해상도',
                video_options_label: '옵션',
                
                // 품질 옵션
                quality_low: '낮음 (60)',
                quality_medium: '중간 (80)',
                quality_high: '높음 (92)',
                quality_custom: '사용자 지정',
                video_quality_low: '낮음',
                video_quality_medium: '중간',
                video_quality_high: '높음',
                
                // 크기 옵션
                size_original: '원본',
                size_custom: '사용자 지정',
                
                // 포맷 옵션
                format_original: '원본 유지',
                
                // 해상도 옵션
                video_resolution_original: '원본 유지',
                
                // 체크박스
                metadata_label: '메타데이터 제거',
                progressive_label: '프로그레시브 인코딩',
                audio_label: '오디오 제거',
                
                // 버튼
                process_images: '이미지 처리',
                process_videos: '비디오 처리',
                clear_all: '모두 지우기',
                download_all: '모두 다운로드',
                
                // 통계
                stat_files: '전체 파일',
                stat_original: '원본 크기',
                stat_compressed: '압축 크기',
                stat_saved: '절약된 공간',
                
                // 상태
                status_waiting: '대기 중',
                status_processing: '처리 중',
                status_complete: '완료',
                status_error: '오류',
                
                // 메시지
                message_ready: 'FFmpeg 로딩 중입니다. 잠시만 기다려주세요.',
                message_preparing: '다운로드 준비 중...',
                message_complete: '다운로드 준비 완료!',
                message_compressed_image: '개 이미지가 압축되었습니다!',
                message_compressed_video: '개 비디오가 압축되었습니다!',
                message_initialized: '설정이 초기화되었습니다.',
                message_reset_confirm: '모든 설정을 초기화하시겠습니까?'
            },
            en: {
                // 헤더
                main_title: 'OHOTORO HORIE Optimizer',
                main_subtitle: 'Professional Media Optimization Suite',
                
                // 탭
                tab_image: 'Image',
                tab_video: 'Video',
                
                // 업로드
                image_upload_text: 'Drop images here',
                image_upload_subtext: 'or click to select',
                video_upload_text: 'Drop videos here',
                video_upload_subtext: 'or click to select',
                
                // 크롭
                crop_label: 'CROP SETTINGS',
                crop_preview: 'Preview',
                crop_reset: 'Reset',
                crop_apply: 'Apply Crop',
                crop_skip: 'Skip Crop',
                
                // 설정 라벨
                quality_label: 'Quality',
                size_label: 'Max Width',
                format_label: 'Output Format',
                options_label: 'Additional Options',
                video_quality_label: 'Video Quality',
                video_resolution_label: 'Resolution',
                video_options_label: 'Options',
                
                // 품질 옵션
                quality_low: 'Low (60)',
                quality_medium: 'Medium (80)',
                quality_high: 'High (92)',
                quality_custom: 'Custom',
                video_quality_low: 'Low',
                video_quality_medium: 'Medium',
                video_quality_high: 'High',
                
                // 크기 옵션
                size_original: 'Original',
                size_custom: 'Custom',
                
                // 포맷 옵션
                format_original: 'Keep Original',
                
                // 해상도 옵션
                video_resolution_original: 'Keep Original',
                
                // 체크박스
                metadata_label: 'Remove metadata',
                progressive_label: 'Progressive encoding',
                audio_label: 'Remove audio',
                
                // 버튼
                process_images: 'Process Images',
                process_videos: 'Process Videos',
                clear_all: 'Clear All',
                download_all: 'Download All',
                
                // 통계
                stat_files: 'Total Files',
                stat_original: 'Original Size',
                stat_compressed: 'Compressed Size',
                stat_saved: 'Space Saved',
                
                // 상태
                status_waiting: 'Waiting',
                status_processing: 'Processing',
                status_complete: 'Complete',
                status_error: 'Error',
                
                // 메시지
                message_ready: 'FFmpeg is loading. Please wait.',
                message_preparing: 'Preparing download...',
                message_complete: 'Download ready!',
                message_compressed_image: ' images compressed!',
                message_compressed_video: ' videos compressed!',
                message_initialized: 'Settings have been reset.',
                message_reset_confirm: 'Reset all settings?'
            }
        };

        // 메시지 가져오기
        function getMessage(key) {
            return messages[currentLanguage][key] || messages.en[key] || key;
        }

        // 언어 전환
        function setLanguage(lang) {
            currentLanguage = lang;
            localStorage.setItem('ohotoro-language', lang);
            
            // 언어 버튼 업데이트
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.lang === lang);
            });
            
            // UI 텍스트 업데이트
            updateUIText();
        }

        // UI 텍스트 업데이트
        function updateUIText() {
            // 모든 id가 있는 요소의 텍스트 업데이트
            const textElements = [
                'main-title', 'main-subtitle',
                'image-upload-text', 'image-upload-subtext',
                'video-upload-text', 'video-upload-subtext',
                'crop-label', 'quality-label', 'size-label', 'format-label', 'options-label',
                'video-quality-label', 'video-resolution-label', 'video-options-label',
                'quality-low', 'quality-medium', 'quality-high', 'quality-custom',
                'video-quality-low', 'video-quality-medium', 'video-quality-high',
                'size-original', 'size-custom', 'format-original',
                'video-resolution-original', 'metadata-label', 'progressive-label', 'audio-label',
                'stat-files', 'stat-original', 'stat-compressed', 'stat-saved'
            ];
            
            textElements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    const key = id.replace(/-/g, '_');
                    const text = getMessage(key);
                    if (text) element.textContent = text;
                }
            });
            
            // 탭 텍스트 업데이트
            document.querySelectorAll('.tab').forEach(tab => {
                const tabName = tab.dataset.tab;
                tab.textContent = getMessage(`tab_${tabName}`);
            });
            
            // 버튼 텍스트 업데이트
            document.getElementById('image-process').textContent = getMessage('process_images');
            document.getElementById('video-process').textContent = getMessage('process_videos');
            document.querySelectorAll('#image-clear, #video-clear').forEach(btn => {
                btn.textContent = getMessage('clear_all');
            });
            document.querySelectorAll('#image-download, #video-download').forEach(btn => {
                btn.textContent = getMessage('download_all');
            });
            
            // 크롭 버튼 텍스트 업데이트
            document.getElementById('crop-preview').textContent = getMessage('crop_preview');
            document.getElementById('crop-reset').textContent = getMessage('crop_reset');
            document.getElementById('crop-apply').textContent = getMessage('crop_apply');
            document.getElementById('crop-skip').textContent = getMessage('crop_skip');
        }

        // 언어 초기화
        function initLanguage() {
            const savedLang = localStorage.getItem('ohotoro-language') || 'en';
            setLanguage(savedLang);
        }

        // 언어 버튼 이벤트
        document.querySelectorAll('.lang-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                setLanguage(btn.dataset.lang);
            });
        });

        // ============= 설정 관리 =============
        const settings = {
            save: function() {
                const data = {
                    quality: document.querySelector('input[name="quality"]:checked').value,
                    qualityCustom: document.getElementById('quality-custom-value').value,
                    size: document.querySelector('input[name="size"]:checked').value,
                    sizeCustom: document.getElementById('size-custom-value').value,
                    format: document.querySelector('input[name="format"]:checked').value,
                    removeMetadata: document.getElementById('remove-metadata').checked,
                    progressive: document.getElementById('progressive').checked,
                    videoQuality: document.querySelector('input[name="video-quality"]:checked')?.value,
                    videoResolution: document.querySelector('input[name="video-resolution"]:checked')?.value,
                    removeAudio: document.getElementById('remove-audio').checked
                };
                localStorage.setItem('ohotoro-settings', JSON.stringify(data));
            },
            
            load: function() {
                const saved = localStorage.getItem('ohotoro-settings');
                if (!saved) return null;
                
                try {
                    return JSON.parse(saved);
                } catch {
                    return null;
                }
            },
            
            apply: function() {
                const data = this.load();
                if (!data) return;
                
                // 이미지 설정
                if (data.quality) {
                    document.querySelector(`input[name="quality"][value="${data.quality}"]`).checked = true;
                    document.querySelectorAll('.radio-option').forEach(opt => {
                        const radio = opt.querySelector('input[name="quality"]');
                        opt.classList.toggle('selected', radio && radio.checked);
                    });
                }
                
                if (data.qualityCustom) {
                    document.getElementById('quality-custom-value').value = data.qualityCustom;
                }
                
                if (data.size) {
                    document.querySelector(`input[name="size"][value="${data.size}"]`).checked = true;
                    document.querySelectorAll('.radio-option').forEach(opt => {
                        const radio = opt.querySelector('input[name="size"]');
                        opt.classList.toggle('selected', radio && radio.checked);
                    });
                }
                
                if (data.sizeCustom) {
                    document.getElementById('size-custom-value').value = data.sizeCustom;
                }
                
                if (data.format) {
                    document.querySelector(`input[name="format"][value="${data.format}"]`).checked = true;
                    document.querySelectorAll('.radio-option').forEach(opt => {
                        const radio = opt.querySelector('input[name="format"]');
                        opt.classList.toggle('selected', radio && radio.checked);
                    });
                }
                
                document.getElementById('remove-metadata').checked = data.removeMetadata || false;
                document.getElementById('progressive').checked = data.progressive !== false;
                
                // 비디오 설정
                if (data.videoQuality) {
                    const videoQuality = document.querySelector(`input[name="video-quality"][value="${data.videoQuality}"]`);
                    if (videoQuality) {
                        videoQuality.checked = true;
                        document.querySelectorAll('.radio-option').forEach(opt => {
                            const radio = opt.querySelector('input[name="video-quality"]');
                            opt.classList.toggle('selected', radio && radio.checked);
                        });
                    }
                }
                
                if (data.videoResolution) {
                    const videoRes = document.querySelector(`input[name="video-resolution"][value="${data.videoResolution}"]`);
                    if (videoRes) {
                        videoRes.checked = true;
                        document.querySelectorAll('.radio-option').forEach(opt => {
                            const radio = opt.querySelector('input[name="video-resolution"]');
                            opt.classList.toggle('selected', radio && radio.checked);
                        });
                    }
                }
                
                document.getElementById('remove-audio').checked = data.removeAudio || false;
            }
        };

        // ============= FFmpeg 초기화 =============
        async function initFFmpeg() {
            if (typeof FFmpeg === 'undefined') {
                console.warn('FFmpeg not loaded');
                return;
            }
            
            const { createFFmpeg } = FFmpeg;
            ffmpeg = createFFmpeg({ log: false });
            
            try {
                await ffmpeg.load();
                ffmpegLoaded = true;
                console.log('FFmpeg loaded successfully');
            } catch (error) {
                console.error('Failed to load FFmpeg:', error);
            }
        }

        // FFmpeg 초기화 시작
        initFFmpeg();

        // ============= 탭 전환 =============
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                // 모든 탭 비활성화
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                // 선택된 탭 활성화
                tab.classList.add('active');
                document.getElementById(`${tab.dataset.tab}-tab`).classList.add('active');
            });
        });

        // ============= 라디오 버튼 스타일 =============
        document.querySelectorAll('.radio-option').forEach(option => {
            option.addEventListener('click', function() {
                const input = this.querySelector('input[type="radio"]');
                if (input) {
                    // 같은 그룹의 다른 옵션들 비활성화
                    const groupName = input.name;
                    document.querySelectorAll(`input[name="${groupName}"]`).forEach(radio => {
                        radio.closest('.radio-option').classList.remove('selected');
                    });
                    
                    // 현재 옵션 활성화
                    input.checked = true;
                    this.classList.add('selected');
                    
                    // 커스텀 입력 표시/숨기기
                    if (input.value === 'custom') {
                        const customInput = document.getElementById(`${groupName.replace('-', '')}-custom-input`);
                        if (customInput) customInput.classList.add('active');
                    } else {
                        const customInput = document.getElementById(`${groupName.replace('-', '')}-custom-input`);
                        if (customInput) customInput.classList.remove('active');
                    }
                    
                    // 설정 저장
                    settings.save();
                }
            });
        });

        // 체크박스 변경 시 설정 저장
        document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
            checkbox.addEventListener('change', () => settings.save());
        });

        // 커스텀 값 변경 시 설정 저장
        document.querySelectorAll('.custom-input input').forEach(input => {
            input.addEventListener('input', () => settings.save());
        });

        // ============= 성공 메시지 표시 =============
        function showSuccessMessage(text) {
            const message = document.getElementById('success-message');
            message.textContent = text;
            message.classList.add('active');
            
            setTimeout(() => {
                message.classList.remove('active');
            }, 3000);
        }

        // ============= 이미지 처리 =============
        
        // 이미지 업로드 영역
        const imageUploadArea = document.getElementById('image-upload-area');
        const imageInput = document.getElementById('image-input');

        // 이미지 업로드 영역 클릭
        imageUploadArea.addEventListener('click', () => {
            imageInput.click();
        });

        // 드래그 앤 드롭
        imageUploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            imageUploadArea.classList.add('dragover');
        });

        imageUploadArea.addEventListener('dragleave', () => {
            imageUploadArea.classList.remove('dragover');
        });

        imageUploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            imageUploadArea.classList.remove('dragover');
            
            const files = Array.from(e.dataTransfer.files).filter(file => file.type.startsWith('image/'));
            if (files.length > 0) {
                handleImageFiles(files);
            }
        });

        // 파일 선택
        imageInput.addEventListener('change', (e) => {
            const files = Array.from(e.target.files);
            handleImageFiles(files);
        });

        // 이미지 파일 처리
        function handleImageFiles(files) {
            imageFiles = files;
            
            // 크롭 데이터 초기화
            cropEditor.cropData = new Array(files.length).fill(null);
            cropEditor.currentImageIndex = 0;
            
            // 크롭 에디터 표시
            document.getElementById('crop-editor').classList.add('active');
            
            // 첫 번째 이미지 로드
            loadImageForCrop(0);
        }

        // 크롭을 위한 이미지 로드
        function loadImageForCrop(index) {
            if (index >= imageFiles.length) {
                // 모든 이미지 크롭 완료
                finalizeCroppedImages();
                return;
            }

            const file = imageFiles[index];
            const reader = new FileReader();

            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    cropEditor.image = img;
                    cropEditor.currentImageIndex = index;
                    initializeCropCanvas();
                };
                img.src = e.target.result;
            };

            reader.readAsDataURL(file);
        }

        // 크롭 캔버스 초기화
        function initializeCropCanvas() {
            cropEditor.canvas = document.getElementById('crop-canvas');
            cropEditor.ctx = cropEditor.canvas.getContext('2d');

            const container = document.querySelector('.crop-container');
            const maxWidth = container.clientWidth - 60;
            const maxHeight = 600;

            let scale = 1;
            if (cropEditor.image.width > maxWidth) {
                scale = maxWidth / cropEditor.image.width;
            }
            if (cropEditor.image.height * scale > maxHeight) {
                scale = maxHeight / cropEditor.image.height;
            }

            cropEditor.canvas.width = cropEditor.image.width * scale;
            cropEditor.canvas.height = cropEditor.image.height * scale;

            // 이미지 그리기
            cropEditor.ctx.drawImage(cropEditor.image, 0, 0, cropEditor.canvas.width, cropEditor.canvas.height);

            // 기본 크롭 영역 설정 (5:7 비율)
            if (!cropEditor.cropData[cropEditor.currentImageIndex]) {
                setCropAreaByRatio();
            } else {
                // 저장된 크롭 데이터 적용
                const data = cropEditor.cropData[cropEditor.currentImageIndex];
                cropEditor.cropX = data.x * (cropEditor.canvas.width / cropEditor.image.width);
                cropEditor.cropY = data.y * (cropEditor.canvas.height / cropEditor.image.height);
                cropEditor.cropWidth = data.width * (cropEditor.canvas.width / cropEditor.image.width);
                cropEditor.cropHeight = data.height * (cropEditor.canvas.height / cropEditor.image.height);
            }

            updateCropOverlay();
            updateCropInfo();
        }

        // 비율에 따른 크롭 영역 설정
        function setCropAreaByRatio() {
            const canvasWidth = cropEditor.canvas.width;
            const canvasHeight = cropEditor.canvas.height;

            if (cropEditor.currentRatio === 'free') {
                cropEditor.cropWidth = canvasWidth * 0.8;
                cropEditor.cropHeight = canvasHeight * 0.8;
            } else {
                if (canvasWidth / canvasHeight > cropEditor.aspectRatio) {
                    cropEditor.cropHeight = canvasHeight * 0.8;
                    cropEditor.cropWidth = cropEditor.cropHeight * cropEditor.aspectRatio;
                } else {
                    cropEditor.cropWidth = canvasWidth * 0.8;
                    cropEditor.cropHeight = cropEditor.cropWidth / cropEditor.aspectRatio;
                }
            }

            cropEditor.cropX = (canvasWidth - cropEditor.cropWidth) / 2;
            cropEditor.cropY = (canvasHeight - cropEditor.cropHeight) / 2;
        }

        // 크롭 오버레이 업데이트
        function updateCropOverlay() {
            const overlay = document.getElementById('crop-overlay');
            overlay.style.left = cropEditor.cropX + 'px';
            overlay.style.top = cropEditor.cropY + 'px';
            overlay.style.width = cropEditor.cropWidth + 'px';
            overlay.style.height = cropEditor.cropHeight + 'px';
        }

        // 크롭 정보 업데이트
        function updateCropInfo() {
            const scale = cropEditor.image.width / cropEditor.canvas.width;
            const actualWidth = Math.round(cropEditor.cropWidth * scale);
            const actualHeight = Math.round(cropEditor.cropHeight * scale);
            document.getElementById('crop-dimensions').textContent = `${actualWidth} x ${actualHeight}`;
        }

        // 크롭 비율 버튼 이벤트
        document.querySelectorAll('.crop-ratio-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.crop-ratio-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');

                cropEditor.currentRatio = this.dataset.ratio;

                switch (this.dataset.ratio) {
                    case 'free':
                        cropEditor.aspectRatio = null;
                        break;
                    case '1:1':
                        cropEditor.aspectRatio = 1;
                        break;
                    case '4:3':
                        cropEditor.aspectRatio = 4/3;
                        break;
                    case '16:9':
                        cropEditor.aspectRatio = 16/9;
                        break;
                    case '3:2':
                        cropEditor.aspectRatio = 3/2;
                        break;
                    case '9:16':
                        cropEditor.aspectRatio = 9/16;
                        break;
                    case '5:7':
                    default:
                        cropEditor.aspectRatio = 5/7;
                        break;
                }

                if (cropEditor.aspectRatio) {
                    // 현재 중심점 유지하며 비율 조정
                    const centerX = cropEditor.cropX + cropEditor.cropWidth / 2;
                    const centerY = cropEditor.cropY + cropEditor.cropHeight / 2;

                    if (cropEditor.cropWidth / cropEditor.cropHeight > cropEditor.aspectRatio) {
                        cropEditor.cropWidth = cropEditor.cropHeight * cropEditor.aspectRatio;
                    } else {
                        cropEditor.cropHeight = cropEditor.cropWidth / cropEditor.aspectRatio;
                    }

                    cropEditor.cropX = centerX - cropEditor.cropWidth / 2;
                    cropEditor.cropY = centerY - cropEditor.cropHeight / 2;

                    // 경계 체크
                    if (cropEditor.cropX < 0) cropEditor.cropX = 0;
                    if (cropEditor.cropY < 0) cropEditor.cropY = 0;
                    if (cropEditor.cropX + cropEditor.cropWidth > cropEditor.canvas.width) {
                        cropEditor.cropX = cropEditor.canvas.width - cropEditor.cropWidth;
                    }
                    if (cropEditor.cropY + cropEditor.cropHeight > cropEditor.canvas.height) {
                        cropEditor.cropY = cropEditor.canvas.height - cropEditor.cropHeight;
                    }

                    updateCropOverlay();
                    updateCropInfo();
                }
            });
        });

        // 크롭 영역 드래그 이벤트
        document.getElementById('crop-canvas').addEventListener('mousedown', function(e) {
            const rect = this.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            // 크롭 영역 내부 클릭 확인
            if (x >= cropEditor.cropX && x <= cropEditor.cropX + cropEditor.cropWidth &&
                y >= cropEditor.cropY && y <= cropEditor.cropY + cropEditor.cropHeight) {
                cropEditor.isDragging = true;
                cropEditor.startX = x - cropEditor.cropX;
                cropEditor.startY = y - cropEditor.cropY;
                e.preventDefault();
            }
        });

        document.addEventListener('mousemove', function(e) {
            if (cropEditor.isDragging) {
                const canvas = cropEditor.canvas;
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;

                cropEditor.cropX = x - cropEditor.startX;
                cropEditor.cropY = y - cropEditor.startY;

                // 경계 체크
                if (cropEditor.cropX < 0) cropEditor.cropX = 0;
                if (cropEditor.cropY < 0) cropEditor.cropY = 0;
                if (cropEditor.cropX + cropEditor.cropWidth > canvas.width) {
                    cropEditor.cropX = canvas.width - cropEditor.cropWidth;
                }
                if (cropEditor.cropY + cropEditor.cropHeight > canvas.height) {
                    cropEditor.cropY = canvas.height - cropEditor.cropHeight;
                }

                updateCropOverlay();
                updateCropInfo();
            }
        });

        document.addEventListener('mouseup', function() {
            cropEditor.isDragging = false;
        });

        // 크롭 핸들 리사이즈 이벤트
        document.querySelectorAll('.crop-handle').forEach(handle => {
            handle.addEventListener('mousedown', function(e) {
                e.stopPropagation();
                cropEditor.isResizing = true;
                cropEditor.resizeHandle = this.className.split(' ')[1];
                cropEditor.startX = e.clientX;
                cropEditor.startY = e.clientY;
                cropEditor.startWidth = cropEditor.cropWidth;
                cropEditor.startHeight = cropEditor.cropHeight;
                cropEditor.startCropX = cropEditor.cropX;
                cropEditor.startCropY = cropEditor.cropY;
                e.preventDefault();
            });
        });

        document.addEventListener('mousemove', function(e) {
            if (cropEditor.isResizing) {
                const dx = e.clientX - cropEditor.startX;
                const dy = e.clientY - cropEditor.startY;

                switch (cropEditor.resizeHandle) {
                    case 'se':
                        if (cropEditor.currentRatio === 'free') {
                            cropEditor.cropWidth = Math.max(50, cropEditor.startWidth + dx);
                            cropEditor.cropHeight = Math.max(50, cropEditor.startHeight + dy);
                        } else {
                            const newWidth = Math.max(50, cropEditor.startWidth + dx);
                            const newHeight = Math.max(50, cropEditor.startHeight + dy);
                            
                            if (Math.abs(dx) > Math.abs(dy)) {
                                cropEditor.cropWidth = newWidth;
                                cropEditor.cropHeight = newWidth / cropEditor.aspectRatio;
                            } else {
                                cropEditor.cropHeight = newHeight;
                                cropEditor.cropWidth = newHeight * cropEditor.aspectRatio;
                            }
                        }
                        break;
                    case 'sw':
                        if (cropEditor.currentRatio === 'free') {
                            cropEditor.cropWidth = Math.max(50, cropEditor.startWidth - dx);
                            cropEditor.cropHeight = Math.max(50, cropEditor.startHeight + dy);
                            cropEditor.cropX = cropEditor.startCropX + dx;
                        } else {
                            const newWidth = Math.max(50, cropEditor.startWidth - dx);
                            const newHeight = Math.max(50, cropEditor.startHeight + dy);
                            
                            if (Math.abs(dx) > Math.abs(dy)) {
                                cropEditor.cropWidth = newWidth;
                                cropEditor.cropHeight = newWidth / cropEditor.aspectRatio;
                            } else {
                                cropEditor.cropHeight = newHeight;
                                cropEditor.cropWidth = newHeight * cropEditor.aspectRatio;
                            }
                            cropEditor.cropX = cropEditor.startCropX + cropEditor.startWidth - cropEditor.cropWidth;
                        }
                        break;
                    case 'ne':
                        if (cropEditor.currentRatio === 'free') {
                            cropEditor.cropWidth = Math.max(50, cropEditor.startWidth + dx);
                            cropEditor.cropHeight = Math.max(50, cropEditor.startHeight - dy);
                            cropEditor.cropY = cropEditor.startCropY + dy;
                        } else {
                            const newWidth = Math.max(50, cropEditor.startWidth + dx);
                            const newHeight = Math.max(50, cropEditor.startHeight - dy);
                            
                            if (Math.abs(dx) > Math.abs(dy)) {
                                cropEditor.cropWidth = newWidth;
                                cropEditor.cropHeight = newWidth / cropEditor.aspectRatio;
                            } else {
                                cropEditor.cropHeight = newHeight;
                                cropEditor.cropWidth = newHeight * cropEditor.aspectRatio;
                            }
                            cropEditor.cropY = cropEditor.startCropY + cropEditor.startHeight - cropEditor.cropHeight;
                        }
                        break;
                    case 'nw':
                        if (cropEditor.currentRatio === 'free') {
                            cropEditor.cropWidth = Math.max(50, cropEditor.startWidth - dx);
                            cropEditor.cropHeight = Math.max(50, cropEditor.startHeight - dy);
                            cropEditor.cropX = cropEditor.startCropX + dx;
                            cropEditor.cropY = cropEditor.startCropY + dy;
                        } else {
                            const newWidth = Math.max(50, cropEditor.startWidth - dx);
                            const newHeight = Math.max(50, cropEditor.startHeight - dy);
                            
                            if (Math.abs(dx) > Math.abs(dy)) {
                                cropEditor.cropWidth = newWidth;
                                cropEditor.cropHeight = newWidth / cropEditor.aspectRatio;
                            } else {
                                cropEditor.cropHeight = newHeight;
                                cropEditor.cropWidth = newHeight * cropEditor.aspectRatio;
                            }
                            cropEditor.cropX = cropEditor.startCropX + cropEditor.startWidth - cropEditor.cropWidth;
                            cropEditor.cropY = cropEditor.startCropY + cropEditor.startHeight - cropEditor.cropHeight;
                        }
                        break;
                }

                // 경계 체크
                if (cropEditor.cropX < 0) cropEditor.cropX = 0;
                if (cropEditor.cropY < 0) cropEditor.cropY = 0;
                if (cropEditor.cropX + cropEditor.cropWidth > cropEditor.canvas.width) {
                    cropEditor.cropWidth = cropEditor.canvas.width - cropEditor.cropX;
                    if (cropEditor.aspectRatio) {
                        cropEditor.cropHeight = cropEditor.cropWidth / cropEditor.aspectRatio;
                    }
                }
                if (cropEditor.cropY + cropEditor.cropHeight > cropEditor.canvas.height) {
                    cropEditor.cropHeight = cropEditor.canvas.height - cropEditor.cropY;
                    if (cropEditor.aspectRatio) {
                        cropEditor.cropWidth = cropEditor.cropHeight * cropEditor.aspectRatio;
                    }
                }

                updateCropOverlay();
                updateCropInfo();
            }
        });

        document.addEventListener('mouseup', function() {
            cropEditor.isResizing = false;
            cropEditor.resizeHandle = null;
        });

        // 크롭 미리보기
        document.getElementById('crop-preview').addEventListener('click', function() {
            const scale = cropEditor.image.width / cropEditor.canvas.width;
            const cropX = cropEditor.cropX * scale;
            const cropY = cropEditor.cropY * scale;
            const cropWidth = cropEditor.cropWidth * scale;
            const cropHeight = cropEditor.cropHeight * scale;

            const tempCanvas = document.createElement('canvas');
            tempCanvas.width = cropWidth;
            tempCanvas.height = cropHeight;
            const tempCtx = tempCanvas.getContext('2d');

            tempCtx.drawImage(cropEditor.image, cropX, cropY, cropWidth, cropHeight, 0, 0, cropWidth, cropHeight);

            const modal = document.getElementById('preview-modal');
            const previewImage = document.getElementById('preview-image');
            const previewInfo = document.getElementById('preview-info');

            previewImage.src = tempCanvas.toDataURL('image/png');
            previewInfo.textContent = `${Math.round(cropWidth)} x ${Math.round(cropHeight)} pixels`;
            modal.classList.add('active');
        });

        // 미리보기 모달 닫기
        document.getElementById('preview-close').addEventListener('click', function() {
            document.getElementById('preview-modal').classList.remove('active');
        });

        document.getElementById('preview-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                this.classList.remove('active');
            }
        });

        // 크롭 리셋
        document.getElementById('crop-reset').addEventListener('click', function() {
            setCropAreaByRatio();
            updateCropOverlay();
            updateCropInfo();
        });

        // 크롭 적용
        document.getElementById('crop-apply').addEventListener('click', function() {
            // 현재 이미지의 크롭 데이터 저장
            const scale = cropEditor.image.width / cropEditor.canvas.width;
            cropEditor.cropData[cropEditor.currentImageIndex] = {
                x: cropEditor.cropX * scale,
                y: cropEditor.cropY * scale,
                width: cropEditor.cropWidth * scale,
                height: cropEditor.cropHeight * scale
            };

            // 다음 이미지로
            cropEditor.currentImageIndex++;
            loadImageForCrop(cropEditor.currentImageIndex);
        });

        // 크롭 건너뛰기
        document.getElementById('crop-skip').addEventListener('click', function() {
            // 크롭 데이터 없이 다음 이미지로
            cropEditor.cropData[cropEditor.currentImageIndex] = null;
            
            // 다음 이미지로
            cropEditor.currentImageIndex++;
            loadImageForCrop(cropEditor.currentImageIndex);
        });

        // 크롭 완료 후 이미지 처리
        function finalizeCroppedImages() {
            document.getElementById('crop-editor').classList.remove('active');
            
            // UI 업데이트
            document.getElementById('image-settings').style.display = 'block';
            document.getElementById('image-file-list').style.display = 'block';
            document.getElementById('image-buttons').style.display = 'flex';
            
            // 파일 리스트 표시
            displayImageFiles();
        }

        // 이미지 파일 리스트 표시
        function displayImageFiles() {
            const fileList = document.getElementById('image-file-list');
            fileList.innerHTML = '';
            
            imageFiles.forEach((file, index) => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.innerHTML = `
                    <div class="file-info">
                        <div class="file-name">${file.name}</div>
                        <div class="file-size">${formatFileSize(file.size)}</div>
                    </div>
                    <div class="file-status" id="status-${index}">${getMessage('status_waiting')}</div>
                `;
                fileList.appendChild(fileItem);
            });
        }

        // 이미지 처리 버튼
        document.getElementById('image-process').addEventListener('click', async () => {
            const quality = document.querySelector('input[name="quality"]:checked').value;
            const size = document.querySelector('input[name="size"]:checked').value;
            const format = document.querySelector('input[name="format"]:checked').value;
            const removeMetadata = document.getElementById('remove-metadata').checked;
            const progressive = document.getElementById('progressive').checked;
            
            // 로딩 표시
            const loading = document.getElementById('image-loading');
            const progressBar = document.getElementById('image-progress');
            progressBar.classList.add('active');
            
            processedImages = [];
            let totalOriginalSize = 0;
            let totalCompressedSize = 0;

            for (let i = 0; i < imageFiles.length; i++) {
                const file = imageFiles[i];
                const statusElement = document.getElementById(`status-${i}`);
                statusElement.textContent = getMessage('status_processing');
                statusElement.className = 'file-status processing';
                
                loading.classList.add('active');
                loading.querySelector('.loading-text').textContent = `${getMessage('status_processing')}: ${file.name}`;

                try {
                    const processed = await processImage(file, i, quality, size, format, removeMetadata, progressive);
                    processedImages.push(processed);
                    
                    totalOriginalSize += file.size;
                    totalCompressedSize += processed.blob.size;
                    
                    statusElement.textContent = getMessage('status_complete');
                    statusElement.className = 'file-status complete';
                } catch (error) {
                    console.error('Error processing image:', error);
                    statusElement.textContent = getMessage('status_error');
                    statusElement.className = 'file-status error';
                }

                // 진행률 업데이트
                const progress = ((i + 1) / imageFiles.length) * 100;
                progressBar.querySelector('.progress-fill').style.width = progress + '%';
            }

            loading.classList.remove('active');
            
            // 통계 표시
            displayImageStats(totalOriginalSize, totalCompressedSize);
            
            // 성공 메시지 표시
            showSuccessMessage(`${imageFiles.length}${getMessage('message_compressed_image')}`);
            
            // 다운로드 버튼 표시
            document.getElementById('image-download').style.display = 'inline-block';
            progressBar.classList.remove('active');
        });

        // 이미지 처리 함수
        async function processImage(file, index, quality, size, format, removeMetadata, progressive) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const img = new Image();
                    
                    img.onload = function() {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        
                        let width = img.width;
                        let height = img.height;
                        
                        // 크롭 적용
                        const cropData = cropEditor.cropData[index];
                        if (cropData) {
                            canvas.width = cropData.width;
                            canvas.height = cropData.height;
                            ctx.drawImage(img, cropData.x, cropData.y, cropData.width, cropData.height, 0, 0, cropData.width, cropData.height);
                            
                            // 크롭 후 이미지로 업데이트
                            const tempImg = new Image();
                            tempImg.onload = function() {
                                width = tempImg.width;
                                height = tempImg.height;
                                
                                // 크기 조정 적용
                                applyResize();
                            };
                            tempImg.src = canvas.toDataURL('image/png');
                        } else {
                            // 크기 조정 적용
                            applyResize();
                        }
                        
                        function applyResize() {
                            // 크기 조정
                            let maxWidth = size === 'original' ? width : parseInt(size);
                            if (size === 'custom') {
                                maxWidth = parseInt(document.getElementById('size-custom-value').value);
                            }
                            
                            if (width > maxWidth) {
                                const ratio = maxWidth / width;
                                width = maxWidth;
                                height = Math.round(height * ratio);
                            }
                            
                            canvas.width = width;
                            canvas.height = height;
                            
                            // 이미지 그리기
                            if (cropData) {
                                // 크롭된 이미지 다시 그리기
                                const tempCanvas = document.createElement('canvas');
                                tempCanvas.width = cropData.width;
                                tempCanvas.height = cropData.height;
                                const tempCtx = tempCanvas.getContext('2d');
                                tempCtx.drawImage(img, cropData.x, cropData.y, cropData.width, cropData.height, 0, 0, cropData.width, cropData.height);
                                
                                ctx.drawImage(tempCanvas, 0, 0, tempCanvas.width, tempCanvas.height, 0, 0, width, height);
                            } else {
                                ctx.drawImage(img, 0, 0, width, height);
                            }
                            
                            // 품질 설정
                            let qualityValue = 0.8;
                            if (quality === 'low') qualityValue = 0.6;
                            else if (quality === 'high') qualityValue = 0.92;
                            else if (quality === 'custom') {
                                qualityValue = parseInt(document.getElementById('quality-custom-value').value) / 100;
                            }
                            
                            // 포맷 결정
                            let outputFormat = format;
                            if (format === 'original') {
                                outputFormat = file.type.includes('png') ? 'png' : 
                                              file.type.includes('webp') ? 'webp' : 'jpeg';
                            }
                            
                            // 블롭 생성
                            canvas.toBlob(function(blob) {
                                if (blob) {
                                    // 파일명 생성
                                    const extension = outputFormat === 'jpeg' ? 'jpg' : outputFormat;
                                    const baseName = file.name.substring(0, file.name.lastIndexOf('.')) || file.name;
                                    const fileName = `${baseName}.${extension}`;
                                    
                                    resolve({
                                        blob: blob,
                                        name: fileName,
                                        originalName: file.name
                                    });
                                } else {
                                    reject(new Error('Failed to create blob'));
                                }
                            }, `image/${outputFormat}`, qualityValue);
                        }
                    };
                    
                    img.onerror = function() {
                        reject(new Error('Failed to load image'));
                    };
                    
                    img.src = e.target.result;
                };
                
                reader.onerror = function() {
                    reject(new Error('Failed to read file'));
                };
                
                reader.readAsDataURL(file);
            });
        }

        // 이미지 통계 표시
        function displayImageStats(originalSize, compressedSize) {
            document.getElementById('image-stats').style.display = 'flex';
            document.getElementById('image-total-files').textContent = imageFiles.length;
            document.getElementById('image-original-size').textContent = formatFileSize(originalSize);
            document.getElementById('image-compressed-size').textContent = formatFileSize(compressedSize);
            
            const savedPercentage = Math.round((1 - compressedSize / originalSize) * 100);
            document.getElementById('image-saved').textContent = savedPercentage + '%';
        }

        // 이미지 다운로드
        document.getElementById('image-download').addEventListener('click', async () => {
            if (processedImages.length === 0) return;
            
            showSuccessMessage(getMessage('message_preparing'));
            
            if (processedImages.length === 1) {
                // 단일 파일 다운로드
                downloadFile(processedImages[0].blob, processedImages[0].name);
            } else {
                // ZIP으로 다운로드
                const zip = new JSZip();
                processedImages.forEach(img => {
                    zip.file(img.name, img.blob);
                });
                
                const zipBlob = await zip.generateAsync({type: 'blob'});
                downloadFile(zipBlob, 'images.zip');
            }
            
            setTimeout(() => {
                showSuccessMessage(getMessage('message_complete'));
            }, 1000);
        });

        // 이미지 초기화
        document.getElementById('image-clear').addEventListener('click', () => {
            imageFiles = [];
            processedImages = [];
            cropEditor.cropData = [];
            cropEditor.currentImageIndex = 0;
            document.getElementById('crop-editor').classList.remove('active');
            document.getElementById('image-settings').style.display = 'none';
            document.getElementById('image-file-list').style.display = 'none';
            document.getElementById('image-stats').style.display = 'none';
            document.getElementById('image-buttons').style.display = 'none';
            document.getElementById('image-download').style.display = 'none';
            imageInput.value = '';
        });

        // ============= 비디오 처리 =============
        
        // 비디오 업로드 영역
        const videoUploadArea = document.getElementById('video-upload-area');
        const videoInput = document.getElementById('video-input');

        // 비디오 업로드 영역 클릭
        videoUploadArea.addEventListener('click', () => {
            videoInput.click();
        });

        // 드래그 앤 드롭
        videoUploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            videoUploadArea.classList.add('dragover');
        });

        videoUploadArea.addEventListener('dragleave', () => {
            videoUploadArea.classList.remove('dragover');
        });

        videoUploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            videoUploadArea.classList.remove('dragover');
            
            const files = Array.from(e.dataTransfer.files).filter(file => file.type.startsWith('video/'));
            if (files.length > 0) {
                handleVideoFiles(files);
            }
        });

        // 파일 선택
        videoInput.addEventListener('change', (e) => {
            const files = Array.from(e.target.files);
            handleVideoFiles(files);
        });

        // 비디오 파일 처리
        function handleVideoFiles(files) {
            videoFiles = files;
            
            // UI 업데이트
            document.getElementById('video-settings').style.display = 'block';
            document.getElementById('video-file-list').style.display = 'block';
            document.getElementById('video-buttons').style.display = 'flex';
            
            // 파일 리스트 표시
            displayVideoFiles();
        }

        // Video 파일 리스트 표시
        function displayVideoFiles() {
            const fileList = document.getElementById('video-file-list');
            fileList.innerHTML = '';
            
            videoFiles.forEach((file, index) => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.innerHTML = `
                    <div class="file-info">
                        <div class="file-name">${file.name}</div>
                        <div class="file-size">${formatFileSize(file.size)}</div>
                    </div>
                    <div class="file-status" id="video-status-${index}">${getMessage('status_waiting')}</div>
                `;
                fileList.appendChild(fileItem);
            });
        }

        // Video 처리 버튼
        document.getElementById('video-process').addEventListener('click', async () => {
            if (!ffmpegLoaded) {
                alert(getMessage('message_ready'));
                return;
            }

            const quality = document.querySelector('input[name="video-quality"]:checked').value;
            const resolution = document.querySelector('input[name="video-resolution"]:checked').value;
            const removeAudio = document.getElementById('remove-audio').checked;

            // 로딩 표시
            const loading = document.getElementById('video-loading');
            const progressBar = document.getElementById('video-progress');
            progressBar.classList.add('active');
            
            processedVideos = [];
            let totalOriginalSize = 0;
            let totalCompressedSize = 0;

            for (let i = 0; i < videoFiles.length; i++) {
                const file = videoFiles[i];
                const statusElement = document.getElementById(`video-status-${i}`);
                statusElement.textContent = getMessage('status_processing');
                statusElement.className = 'file-status processing';
                
                loading.classList.add('active');
                loading.querySelector('.loading-text').textContent = `${getMessage('status_processing')}: ${file.name}`;

                try {
                    const processed = await processVideo(file, quality, resolution, removeAudio);
                    processedVideos.push(processed);
                    
                    totalOriginalSize += file.size;
                    totalCompressedSize += processed.blob.size;
                    
                    statusElement.textContent = getMessage('status_complete');
                    statusElement.className = 'file-status complete';
                } catch (error) {
                    console.error('Error processing video:', error);
                    statusElement.textContent = getMessage('status_error');
                    statusElement.className = 'file-status error';
                }

                // 진행률 업데이트
                const progress = ((i + 1) / videoFiles.length) * 100;
                progressBar.querySelector('.progress-fill').style.width = progress + '%';
            }

            loading.classList.remove('active');
            
            // 통계 표시
            displayVideoStats(totalOriginalSize, totalCompressedSize);
            
            // 성공 메시지 표시
            showSuccessMessage(`${videoFiles.length}${getMessage('message_compressed_video')}`);
            
            // 다운로드 버튼 표시
            document.getElementById('video-download').style.display = 'inline-block';
            progressBar.classList.remove('active');
        });

        // 비디오 처리 함수 (간소화 버전)
        async function processVideo(file, quality, resolution, removeAudio) {
            // FFmpeg.wasm을 사용한 실제 비디오 압축은 복잡하므로
            // 여기서는 기본 구조만 제공
            // 실제 구현시 FFmpeg 명령어를 조합하여 처리
            
            const inputName = 'input.mp4';
            const outputName = 'output.mp4';
            
            // 파일을 FFmpeg 파일 시스템에 쓰기
            const data = new Uint8Array(await file.arrayBuffer());
            ffmpeg.FS('writeFile', inputName, data);
            
            // FFmpeg 명령어 구성
            let ffmpegCommand = ['-i', inputName];
            
            // 품질 설정
            if (quality === 'low') {
                ffmpegCommand.push('-crf', '28');
            } else if (quality === 'medium') {
                ffmpegCommand.push('-crf', '23');
            } else {
                ffmpegCommand.push('-crf', '18');
            }
            
            // 해상도 설정 - 비율 유지하며 리사이징
            if (resolution !== 'original') {
                // -1을 사용하면 비율에 맞춰 자동 계산
                // pad 필터로 비율이 맞지 않을 경우를 대비
                if (resolution === '1080') {
                    ffmpegCommand.push('-vf', 'scale=-2:1080');
                } else if (resolution === '720') {
                    ffmpegCommand.push('-vf', 'scale=-2:720');
                } else if (resolution === '480') {
                    ffmpegCommand.push('-vf', 'scale=-2:480');
                }
            }
            
            // 오디오 제거
            if (removeAudio) {
                ffmpegCommand.push('-an');
            }
            
            // 출력 설정
            ffmpegCommand.push('-c:v', 'libx264', '-preset', 'medium', outputName);
            
            // FFmpeg 실행
            await ffmpeg.run(...ffmpegCommand);
            
            // 결과 읽기
            const outputData = ffmpeg.FS('readFile', outputName);
            const blob = new Blob([outputData.buffer], { type: 'video/mp4' });
            
            // 파일 시스템 정리
            ffmpeg.FS('unlink', inputName);
            ffmpeg.FS('unlink', outputName);
            
            // 파일명 생성 - 원본 이름 그대로 사용
            const baseName = file.name.substring(0, file.name.lastIndexOf('.')) || file.name;
            const fileName = `${baseName}.mp4`;
            
            return {
                blob: blob,
                name: fileName,
                originalName: file.name
            };
        }

        // Video 통계 표시
        function displayVideoStats(originalSize, compressedSize) {
            document.getElementById('video-stats').style.display = 'flex';
            document.getElementById('video-total-files').textContent = videoFiles.length;
            document.getElementById('video-original-size').textContent = formatFileSize(originalSize);
            document.getElementById('video-compressed-size').textContent = formatFileSize(compressedSize);
            
            const savedPercentage = Math.round((1 - compressedSize / originalSize) * 100);
            document.getElementById('video-saved').textContent = savedPercentage + '%';
        }

        // Video 다운로드
        document.getElementById('video-download').addEventListener('click', async () => {
            if (processedVideos.length === 0) return;
            
            showSuccessMessage(getMessage('message_preparing'));
            
            if (processedVideos.length === 1) {
                // 단일 파일 다운로드
                downloadFile(processedVideos[0].blob, processedVideos[0].name);
            } else {
                // ZIP으로 다운로드
                const zip = new JSZip();
                processedVideos.forEach(video => {
                    zip.file(video.name, video.blob);
                });
                
                const zipBlob = await zip.generateAsync({type: 'blob'});
                downloadFile(zipBlob, 'videos.zip');
            }
            
            setTimeout(() => {
                showSuccessMessage(getMessage('message_complete'));
            }, 1000);
        });

        // Video 초기화
        document.getElementById('video-clear').addEventListener('click', () => {
            videoFiles = [];
            processedVideos = [];
            document.getElementById('video-settings').style.display = 'none';
            document.getElementById('video-file-list').style.display = 'none';
            document.getElementById('video-stats').style.display = 'none';
            document.getElementById('video-buttons').style.display = 'none';
            document.getElementById('video-download').style.display = 'none';
            videoInput.value = '';
        });

        // ============= 유틸리티 함수 =============

        // 파일 크기 포맷
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
        }

        // 파일 다운로드
        function downloadFile(blob, filename) {
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // 페이지 로드시 초기화
        window.addEventListener('load', () => {
            // 언어 초기화
            initLanguage();
            
            // 저장된 설정 불러오기 및 적용
            settings.apply();
            
            console.log('OHOTORO HORIE Optimizer ready');
        });

        // 설정 리셋 버튼
        document.getElementById('reset-settings').addEventListener('click', () => {
            if (confirm(getMessage('message_reset_confirm'))) {
                localStorage.removeItem('ohotoro-settings');
                showSuccessMessage(getMessage('message_initialized'));
                setTimeout(() => {
                    location.reload();
                }, 1500);
            }
        });
    </script>
</body>
</html>
