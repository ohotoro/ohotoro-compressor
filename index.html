<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OHOTORO HORIE Optimizer</title>
    
    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@ffmpeg/ffmpeg@0.11.6/dist/ffmpeg.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@ffmpeg/core@0.11.0/dist/ffmpeg-core.js"></script>
    
    <style>
        /* Í∏∞Î≥∏ Î¶¨ÏÖã Î∞è Ìè∞Ìä∏ ÏÑ§Ï†ï */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Helvetica Neue', Arial, sans-serif;
            background: #f6f6f6;
            color: #111;
            line-height: 1.6;
            font-size: 13px;
            letter-spacing: 0.02em;
        }

        /* Î©îÏù∏ Ïª®ÌÖåÏù¥ÎÑà */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 60px 40px;
        }

        /* Ìó§Îçî */
        header {
            text-align: center;
            margin-bottom: 60px;
            position: relative;
        }

        h1 {
            font-size: 11px;
            font-weight: 400;
            letter-spacing: 0.3em;
            text-transform: uppercase;
            margin-bottom: 8px;
        }

        .subtitle {
            font-size: 10px;
            color: #666;
            letter-spacing: 0.15em;
        }

        /* Ïñ∏Ïñ¥ Ï†ÑÌôò Î≤ÑÌäº */
        .language-switch {
            position: absolute;
            top: 20px;
            left: 40px;
            display: flex;
            gap: 8px;
        }

        .lang-btn {
            padding: 6px 12px;
            background: none;
            border: 1px solid #e6e6e6;
            font-size: 10px;
            letter-spacing: 0.1em;
            cursor: pointer;
            color: #999;
            transition: all 0.3s ease;
        }

        .lang-btn:hover {
            border-color: #999;
            color: #111;
        }

        .lang-btn.active {
            background: #111;
            color: #fff;
            border-color: #111;
        }

        /* ÌÉ≠ ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò */
        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 50px;
            border-bottom: 1px solid #e6e6e6;
        }

        .tab {
            padding: 12px 40px;
            background: none;
            border: none;
            font-size: 11px;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            cursor: pointer;
            color: #999;
            transition: color 0.3s ease;
            position: relative;
        }

        .tab:hover {
            color: #111;
        }

        .tab.active {
            color: #111;
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            right: 0;
            height: 1px;
            background: #111;
        }

        /* ÌÉ≠ ÏΩòÌÖêÏ∏† */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* ÏóÖÎ°úÎìú ÏòÅÏó≠ */
        .upload-area {
            border: 1px dashed #e6e6e6;
            border-radius: 0;
            padding: 80px 40px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            background: #fff;
            margin-bottom: 40px;
        }

        .upload-area:hover {
            border-color: #999;
            background: #fafafa;
        }

        .upload-area.dragover {
            border-color: #111;
            background: #f5f5f5;
        }

        .upload-icon {
            font-size: 32px;
            margin-bottom: 16px;
            color: #999;
        }

        .upload-text {
            font-size: 11px;
            letter-spacing: 0.1em;
            color: #666;
            text-transform: uppercase;
            margin-bottom: 8px;
        }

        .upload-subtext {
            font-size: 10px;
            color: #999;
        }

        input[type="file"] {
            display: none;
        }

        /* ÏÑ§Ï†ï Ìå®ÎÑê */
        .settings-panel {
            background: #fff;
            padding: 40px;
            margin-bottom: 30px;
            border: 1px solid #e6e6e6;
        }

        .settings-group {
            margin-bottom: 30px;
        }

        .settings-group:last-child {
            margin-bottom: 0;
        }

        .settings-label {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: #666;
            margin-bottom: 12px;
            display: block;
        }

        /* ÎùºÎîîÏò§ Î≤ÑÌäº Í∑∏Î£π */
        .radio-group {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .radio-option {
            position: relative;
            cursor: pointer;
            padding: 8px 16px;
            border: 1px solid #e6e6e6;
            font-size: 11px;
            transition: all 0.3s ease;
            background: #fff;
        }

        .radio-option:hover {
            border-color: #999;
        }

        .radio-option input {
            position: absolute;
            opacity: 0;
        }

        .radio-option.selected {
            background: #111;
            color: #fff;
            border-color: #111;
        }

        /* Ïª§Ïä§ÌÖÄ ÏûÖÎ†• */
        .custom-input {
            display: none;
            margin-top: 12px;
        }

        .custom-input.active {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .custom-input input {
            width: 100px;
            padding: 8px 12px;
            border: 1px solid #e6e6e6;
            font-size: 11px;
            background: #fff;
            transition: border-color 0.3s ease;
        }

        .custom-input input:focus {
            outline: none;
            border-color: #111;
        }

        .custom-input span {
            font-size: 11px;
            color: #666;
        }

        /* Ï≤¥ÌÅ¨Î∞ïÏä§ */
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-top: 8px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
        }

        .checkbox-item input[type="checkbox"] {
            width: 14px;
            height: 14px;
            cursor: pointer;
        }

        .checkbox-item label {
            font-size: 11px;
            color: #666;
            cursor: pointer;
        }

        /* ÌååÏùº Î¶¨Ïä§Ìä∏ */
        .file-list {
            display: none;
            margin-bottom: 30px;
            background: #fff;
            border: 1px solid #e6e6e6;
        }

        .file-item {
            padding: 16px 20px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.3s ease;
        }

        .file-item:last-child {
            border-bottom: none;
        }

        .file-item:hover {
            background: #fafafa;
        }

        .file-info {
            flex: 1;
        }

        .file-name {
            font-size: 11px;
            color: #111;
            margin-bottom: 4px;
        }

        .file-size {
            font-size: 10px;
            color: #999;
        }

        .file-status {
            font-size: 10px;
            color: #999;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .file-status.processing {
            color: #f5a623;
        }

        .file-status.complete {
            color: #4caf50;
        }

        .file-status.error {
            color: #f44336;
        }

        /* Î≤ÑÌäº */
        .buttons {
            display: none;
            gap: 16px;
            justify-content: center;
            margin-bottom: 30px;
        }

        .btn {
            padding: 12px 32px;
            background: #111;
            color: #fff;
            border: none;
            font-size: 10px;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn:hover {
            background: #333;
            transform: translateY(-1px);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: #fff;
            color: #111;
            border: 1px solid #e6e6e6;
        }

        .btn-secondary:hover {
            background: #f5f5f5;
            border-color: #999;
        }

        /* ÌÜµÍ≥Ñ */
        .stats {
            display: none;
            background: #fff;
            padding: 30px;
            border: 1px solid #e6e6e6;
            margin-bottom: 30px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 30px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-label {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: #999;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 300;
            color: #111;
        }

        /* Î°úÎî© */
        .loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.98);
            padding: 40px;
            border: 1px solid #e6e6e6;
            text-align: center;
            z-index: 1000;
            display: none;
        }

        .loading.active {
            display: block;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #111;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 11px;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            color: #666;
        }

        /* ÏßÑÌñâÎ•† Î∞î */
        .progress-bar {
            width: 100%;
            height: 2px;
            background: #f0f0f0;
            margin: 30px 0;
            position: relative;
            display: none;
        }

        .progress-bar.active {
            display: block;
        }

        .progress-fill {
            height: 100%;
            background: #111;
            width: 0;
            transition: width 0.5s ease;
        }

        /* Î©îÏãúÏßÄ */
        .success-message {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: #111;
            color: #fff;
            padding: 12px 20px;
            font-size: 11px;
            letter-spacing: 0.1em;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s ease;
            z-index: 1001;
        }

        .success-message.active {
            opacity: 1;
            transform: translateY(0);
        }

        /* ÌÅ¨Î°≠ ÏóêÎîîÌÑ∞ Ïä§ÌÉÄÏùº Ï∂îÍ∞Ä */
        .crop-editor {
            display: none;
            background: #fff;
            border: 1px solid #e6e6e6;
            padding: 30px;
            margin-bottom: 30px;
        }

        .crop-editor.active {
            display: block;
        }

        .crop-container {
            position: relative;
            max-width: 800px;
            margin: 0 auto 30px;
            background: #f9f9f9;
            border: 1px solid #e6e6e6;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 400px;
        }

        .crop-canvas {
            max-width: 100%;
            max-height: 600px;
            display: block;
            cursor: crosshair;
        }

        .crop-overlay {
            position: absolute;
            border: 2px dashed #111;
            background: rgba(255, 255, 255, 0.3);
            pointer-events: none;
        }

        .crop-handle {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #111;
            border: 2px solid #fff;
            pointer-events: all;
            cursor: move;
        }

        .crop-handle.nw { top: -5px; left: -5px; cursor: nw-resize; }
        .crop-handle.ne { top: -5px; right: -5px; cursor: ne-resize; }
        .crop-handle.sw { bottom: -5px; left: -5px; cursor: sw-resize; }
        .crop-handle.se { bottom: -5px; right: -5px; cursor: se-resize; }

        .crop-controls {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 20px;
        }

        .crop-ratio-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .crop-ratio-btn {
            padding: 8px 16px;
            background: #fff;
            border: 1px solid #e6e6e6;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .crop-ratio-btn:hover {
            border-color: #999;
        }

        .crop-ratio-btn.active {
            background: #111;
            color: #fff;
            border-color: #111;
        }

        .crop-info {
            text-align: center;
            font-size: 10px;
            color: #999;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            margin-top: 10px;
        }

        /* ÎØ∏Î¶¨Î≥¥Í∏∞ Î™®Îã¨ */
        .preview-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .preview-modal.active {
            display: flex;
        }

        .preview-content {
            max-width: 90%;
            max-height: 90%;
            position: relative;
        }

        .preview-image {
            max-width: 100%;
            max-height: 80vh;
            display: block;
        }

        .preview-close {
            position: absolute;
            top: -40px;
            right: 0;
            background: none;
            border: none;
            color: #fff;
            font-size: 30px;
            cursor: pointer;
            line-height: 1;
        }

        .preview-info {
            color: #fff;
            text-align: center;
            margin-top: 20px;
            font-size: 11px;
            letter-spacing: 0.1em;
        }

        /* Settings Î≤ÑÌäº Ïä§ÌÉÄÏùº */
        .settings-btn {
            position: fixed;
            bottom: 30px;
            left: 30px;
            padding: 10px 20px;
            background: #fff;
            border: 1px solid #e6e6e6;
            font-size: 10px;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .settings-btn:hover {
            background: #111;
            color: #fff;
            border-color: #111;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Ìó§Îçî -->
        <header>
            <div class="language-switch">
                <button class="lang-btn" data-lang="ko">ÌïúÍµ≠Ïñ¥</button>
                <button class="lang-btn active" data-lang="en">English</button>
            </div>
            <h1 id="main-title">OHOTORO HORIE Optimizer</h1>
            <div class="subtitle" id="main-subtitle">Professional Media Optimization Suite</div>
        </header>

        <!-- ÌÉ≠ ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò -->
        <div class="tabs">
            <button class="tab active" data-tab="image">Image</button>
            <button class="tab" data-tab="video">Video</button>
        </div>

        <!-- Ïù¥ÎØ∏ÏßÄ ÌÉ≠ -->
        <div class="tab-content active" id="image-tab">
            <!-- ÏóÖÎ°úÎìú ÏòÅÏó≠ -->
            <div class="upload-area" id="image-upload-area">
                <div class="upload-icon">üì∑</div>
                <div class="upload-text" id="image-upload-text">Drop images here</div>
                <div class="upload-subtext" id="image-upload-subtext">or click to select</div>
            </div>
            <input type="file" id="image-input" accept="image/*" multiple>

            <!-- ÌÅ¨Î°≠ ÏóêÎîîÌÑ∞ -->
            <div class="crop-editor" id="crop-editor">
                <div class="settings-label" id="crop-label">CROP SETTINGS</div>
                
                <div class="crop-controls">
                    <div class="crop-ratio-group">
                        <button class="crop-ratio-btn active" data-ratio="5:7">5:7 (Default)</button>
                        <button class="crop-ratio-btn" data-ratio="free">Free</button>
                        <button class="crop-ratio-btn" data-ratio="1:1">1:1</button>
                        <button class="crop-ratio-btn" data-ratio="4:3">4:3</button>
                        <button class="crop-ratio-btn" data-ratio="16:9">16:9</button>
                        <button class="crop-ratio-btn" data-ratio="3:2">3:2</button>
                        <button class="crop-ratio-btn" data-ratio="9:16">9:16</button>
                    </div>
                </div>

                <div class="crop-container">
                    <canvas class="crop-canvas" id="crop-canvas"></canvas>
                    <div class="crop-overlay" id="crop-overlay">
                        <div class="crop-handle nw"></div>
                        <div class="crop-handle ne"></div>
                        <div class="crop-handle sw"></div>
                        <div class="crop-handle se"></div>
                    </div>
                </div>

                <div class="crop-info" id="crop-info">
                    <span id="crop-dimensions">0 x 0</span>
                </div>

                <div class="buttons" style="display: flex; margin-top: 20px;">
                    <button class="btn btn-secondary" id="crop-preview">Preview</button>
                    <button class="btn btn-secondary" id="crop-reset">Reset</button>
                    <button class="btn" id="crop-apply">Apply Crop</button>
                    <button class="btn btn-secondary" id="crop-skip">Skip Crop</button>
                </div>
            </div>

            <!-- ÏÑ§Ï†ï Ìå®ÎÑê -->
            <div class="settings-panel" id="image-settings" style="display: none;">
                <!-- ÌíàÏßà ÏÑ§Ï†ï -->
                <div class="settings-group">
                    <label class="settings-label" id="quality-label">Quality</label>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="quality" value="low">
                            <span id="quality-low">Low (60)</span>
                        </label>
                        <label class="radio-option selected">
                            <input type="radio" name="quality" value="medium" checked>
                            <span id="quality-medium">Medium (80)</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="quality" value="high">
                            <span id="quality-high">High (92)</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="quality" value="custom">
                            <span id="quality-custom">Custom</span>
                        </label>
                    </div>
                    <div class="custom-input" id="quality-custom-input">
                        <input type="number" id="quality-custom-value" min="1" max="100" value="85">
                        <span>(1-100)</span>
                    </div>
                </div>

                <!-- ÌÅ¨Í∏∞ Ï°∞Ï†ï -->
                <div class="settings-group">
                    <label class="settings-label" id="size-label">Max Width</label>
                    <div class="radio-group">
                        <label class="radio-option selected">
                            <input type="radio" name="size" value="original" checked>
                            <span id="size-original">Original</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="size" value="1920">
                            <span>1920px</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="size" value="1280">
                            <span>1280px</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="size" value="800">
                            <span>800px</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="size" value="custom">
                            <span id="size-custom">Custom</span>
                        </label>
                    </div>
                    <div class="custom-input" id="size-custom-input">
                        <input type="number" id="size-custom-value" min="100" max="5000" value="1600">
                        <span>px</span>
                    </div>
                </div>

                <!-- Ìè¨Îß∑ Î≥ÄÌôò -->
                <div class="settings-group">
                    <label class="settings-label" id="format-label">Output Format</label>
                    <div class="radio-group">
                        <label class="radio-option selected">
                            <input type="radio" name="format" value="original" checked>
                            <span id="format-original">Keep Original</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="format" value="jpeg">
                            <span>JPEG</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="format" value="png">
                            <span>PNG</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="format" value="webp">
                            <span>WebP</span>
                        </label>
                    </div>
                </div>

                <!-- Ï∂îÍ∞Ä ÏòµÏÖò -->
                <div class="settings-group">
                    <label class="settings-label" id="options-label">Additional Options</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="remove-metadata">
                            <label for="remove-metadata" id="metadata-label">Remove metadata</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="progressive" checked>
                            <label for="progressive" id="progressive-label">Progressive encoding</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ÌååÏùº Î¶¨Ïä§Ìä∏ -->
            <div class="file-list" id="image-file-list"></div>

            <!-- Î≤ÑÌäºÎì§ -->
            <div class="buttons" id="image-buttons">
                <button class="btn" id="image-process">Process Images</button>
                <button class="btn btn-secondary" id="image-clear">Clear All</button>
                <button class="btn" id="image-download" style="display: none;">Download All</button>
            </div>

            <!-- ÏßÑÌñâÎ•† Î∞î -->
            <div class="progress-bar" id="image-progress">
                <div class="progress-fill"></div>
            </div>

            <!-- ÌÜµÍ≥Ñ -->
            <div class="stats" id="image-stats">
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-label" id="stat-files">Total Files</div>
                        <div class="stat-value" id="image-total-files">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label" id="stat-original">Original Size</div>
                        <div class="stat-value" id="image-original-size">0 MB</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label" id="stat-compressed">Compressed Size</div>
                        <div class="stat-value" id="image-compressed-size">0 MB</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label" id="stat-saved">Space Saved</div>
                        <div class="stat-value" id="image-saved">0%</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ÎπÑÎîîÏò§ ÌÉ≠ -->
        <div class="tab-content" id="video-tab">
            <!-- ÏóÖÎ°úÎìú ÏòÅÏó≠ -->
            <div class="upload-area" id="video-upload-area">
                <div class="upload-icon">üé¨</div>
                <div class="upload-text" id="video-upload-text">Drop videos here</div>
                <div class="upload-subtext" id="video-upload-subtext">or click to select</div>
            </div>
            <input type="file" id="video-input" accept="video/*" multiple>

            <!-- ÏÑ§Ï†ï Ìå®ÎÑê -->
            <div class="settings-panel" id="video-settings" style="display: none;">
                <!-- ÌíàÏßà ÏÑ§Ï†ï -->
                <div class="settings-group">
                    <label class="settings-label" id="video-quality-label">Video Quality</label>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="video-quality" value="low">
                            <span id="video-quality-low">Low</span>
                        </label>
                        <label class="radio-option selected">
                            <input type="radio" name="video-quality" value="medium" checked>
                            <span id="video-quality-medium">Medium</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="video-quality" value="high">
                            <span id="video-quality-high">High</span>
                        </label>
                    </div>
                </div>

                <!-- Ìï¥ÏÉÅÎèÑ ÏÑ§Ï†ï -->
                <div class="settings-group">
                    <label class="settings-label" id="video-resolution-label">Resolution</label>
                    <div class="radio-group">
                        <label class="radio-option selected">
                            <input type="radio" name="video-resolution" value="original" checked>
                            <span id="video-resolution-original">Keep Original</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="video-resolution" value="1080">
                            <span>1080p</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="video-resolution" value="720">
                            <span>720p</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="video-resolution" value="480">
                            <span>480p</span>
                        </label>
                    </div>
                </div>

                <!-- Ï∂îÍ∞Ä ÏòµÏÖò -->
                <div class="settings-group">
                    <label class="settings-label" id="video-options-label">Options</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="remove-audio">
                            <label for="remove-audio" id="audio-label">Remove audio</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ÌååÏùº Î¶¨Ïä§Ìä∏ -->
            <div class="file-list" id="video-file-list"></div>

            <!-- Î≤ÑÌäºÎì§ -->
            <div class="buttons" id="video-buttons">
                <button class="btn" id="video-process">Process Videos</button>
                <button class="btn btn-secondary" id="video-clear">Clear All</button>
                <button class="btn" id="video-download" style="display: none;">Download All</button>
            </div>

            <!-- ÏßÑÌñâÎ•† Î∞î -->
            <div class="progress-bar" id="video-progress">
                <div class="progress-fill"></div>
            </div>

            <!-- ÌÜµÍ≥Ñ -->
            <div class="stats" id="video-stats">
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-label">Total Files</div>
                        <div class="stat-value" id="video-total-files">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Original Size</div>
                        <div class="stat-value" id="video-original-size">0 MB</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Compressed Size</div>
                        <div class="stat-value" id="video-compressed-size">0 MB</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Space Saved</div>
                        <div class="stat-value" id="video-saved">0%</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Î°úÎî© ÌëúÏãú -->
    <div class="loading" id="image-loading">
        <div class="loading-spinner"></div>
        <div class="loading-text">Processing...</div>
    </div>

    <div class="loading" id="video-loading">
        <div class="loading-spinner"></div>
        <div class="loading-text">Processing...</div>
    </div>

    <!-- ÏÑ±Í≥µ Î©îÏãúÏßÄ -->
    <div class="success-message" id="success-message"></div>

    <!-- ÎØ∏Î¶¨Î≥¥Í∏∞ Î™®Îã¨ -->
    <div class="preview-modal" id="preview-modal">
        <div class="preview-content">
            <button class="preview-close" id="preview-close">√ó</button>
            <img class="preview-image" id="preview-image">
            <div class="preview-info" id="preview-info"></div>
        </div>
    </div>

    <!-- Settings Î≤ÑÌäº -->
    <button class="settings-btn" id="reset-settings">Reset Settings</button>

    <script>
        // ============= Ï†ÑÏó≠ Î≥ÄÏàò =============
        let imageFiles = [];
        let processedImages = [];
        let videoFiles = [];
        let processedVideos = [];
        let ffmpeg = null;
        let ffmpegLoaded = false;
        let currentLanguage = 'en';
        
        // ÌÅ¨Î°≠ Í¥ÄÎ†® Î≥ÄÏàò
        let cropEditor = {
            canvas: null,
            ctx: null,
            image: null,
            currentImageIndex: 0,
            cropData: [],
            isDragging: false,
            isResizing: false,
            resizeHandle: null,
            startX: 0,
            startY: 0,
            cropX: 0,
            cropY: 0,
            cropWidth: 0,
            cropHeight: 0,
            aspectRatio: 5/7,
            currentRatio: '5:7'
        };

        // ============= Îã§Íµ≠Ïñ¥ ÏßÄÏõê =============
        const messages = {
            ko: {
                // Ìó§Îçî
                main_title: 'OHOTORO HORIE ÏµúÏ†ÅÌôî ÎèÑÍµ¨',
                main_subtitle: 'Ï†ÑÎ¨∏ ÎØ∏ÎîîÏñ¥ ÏµúÏ†ÅÌôî Ïä§ÏúÑÌä∏',
                
                // ÌÉ≠
                tab_image: 'Ïù¥ÎØ∏ÏßÄ',
                tab_video: 'ÎπÑÎîîÏò§',
                
                // ÏóÖÎ°úÎìú
                image_upload_text: 'Ïù¥ÎØ∏ÏßÄÎ•º Ïó¨Í∏∞Ïóê ÎÜìÏúºÏÑ∏Ïöî',
                image_upload_subtext: 'ÎòêÎäî ÌÅ¥Î¶≠ÌïòÏó¨ ÏÑ†ÌÉù',
                video_upload_text: 'ÎπÑÎîîÏò§Î•º Ïó¨Í∏∞Ïóê ÎÜìÏúºÏÑ∏Ïöî',
                video_upload_subtext: 'ÎòêÎäî ÌÅ¥Î¶≠ÌïòÏó¨ ÏÑ†ÌÉù',
                
                // ÌÅ¨Î°≠
                crop_label: 'ÌÅ¨Î°≠ ÏÑ§Ï†ï',
                crop_preview: 'ÎØ∏Î¶¨Î≥¥Í∏∞',
                crop_reset: 'Ï¥àÍ∏∞Ìôî',
                crop_apply: 'ÌÅ¨Î°≠ Ï†ÅÏö©',
                crop_skip: 'ÌÅ¨Î°≠ Í±¥ÎÑàÎõ∞Í∏∞',
                
                // ÏÑ§Ï†ï ÎùºÎ≤®
                quality_label: 'ÌíàÏßà',
                size_label: 'ÏµúÎåÄ ÎÑàÎπÑ',
                format_label: 'Ï∂úÎ†• ÌòïÏãù',
                options_label: 'Ï∂îÍ∞Ä ÏòµÏÖò',
                video_quality_label: 'ÎπÑÎîîÏò§ ÌíàÏßà',
                video_resolution_label: 'Ìï¥ÏÉÅÎèÑ',
                video_options_label: 'ÏòµÏÖò',
                
                // ÌíàÏßà ÏòµÏÖò
                quality_low: 'ÎÇÆÏùå (60)',
                quality_medium: 'Ï§ëÍ∞Ñ (80)',
                quality_high: 'ÎÜíÏùå (92)',
                quality_custom: 'ÏÇ¨Ïö©Ïûê ÏßÄÏ†ï',
                video_quality_low: 'ÎÇÆÏùå',
                video_quality_medium: 'Ï§ëÍ∞Ñ',
                video_quality_high: 'ÎÜíÏùå',
                
                // ÌÅ¨Í∏∞ ÏòµÏÖò
                size_original: 'ÏõêÎ≥∏',
                size_custom: 'ÏÇ¨Ïö©Ïûê ÏßÄÏ†ï',
                
                // Ìè¨Îß∑ ÏòµÏÖò
                format_original: 'ÏõêÎ≥∏ Ïú†ÏßÄ',
                
                // Ìï¥ÏÉÅÎèÑ ÏòµÏÖò
                video_resolution_original: 'ÏõêÎ≥∏ Ïú†ÏßÄ',
                
                // Ï≤¥ÌÅ¨Î∞ïÏä§
                metadata_label: 'Î©îÌÉÄÎç∞Ïù¥ÌÑ∞ Ï†úÍ±∞',
                progressive_label: 'ÌîÑÎ°úÍ∑∏Î†àÏãúÎ∏å Ïù∏ÏΩîÎî©',
                audio_label: 'Ïò§ÎîîÏò§ Ï†úÍ±∞',
                
                // Î≤ÑÌäº
                process_images: 'Ïù¥ÎØ∏ÏßÄ Ï≤òÎ¶¨',
                process_videos: 'ÎπÑÎîîÏò§ Ï≤òÎ¶¨',
                clear_all: 'Î™®Îëê ÏßÄÏö∞Í∏∞',
                download_all: 'Î™®Îëê Îã§Ïö¥Î°úÎìú',
                
                // ÌÜµÍ≥Ñ
                stat_files: 'Ï†ÑÏ≤¥ ÌååÏùº',
                stat_original: 'ÏõêÎ≥∏ ÌÅ¨Í∏∞',
                stat_compressed: 'ÏïïÏ∂ï ÌÅ¨Í∏∞',
                stat_saved: 'Ï†àÏïΩÎêú Í≥µÍ∞Ñ',
                
                // ÏÉÅÌÉú
                status_waiting: 'ÎåÄÍ∏∞ Ï§ë',
                status_processing: 'Ï≤òÎ¶¨ Ï§ë',
                status_complete: 'ÏôÑÎ£å',
                status_error: 'Ïò§Î•ò',
                
                // Î©îÏãúÏßÄ
                message_ready: 'FFmpeg Î°úÎî© Ï§ëÏûÖÎãàÎã§. Ïû†ÏãúÎßå Í∏∞Îã§Î†§Ï£ºÏÑ∏Ïöî.',
                message_preparing: 'Îã§Ïö¥Î°úÎìú Ï§ÄÎπÑ Ï§ë...',
                message_complete: 'Îã§Ïö¥Î°úÎìú Ï§ÄÎπÑ ÏôÑÎ£å!',
                message_compressed_image: 'Í∞ú Ïù¥ÎØ∏ÏßÄÍ∞Ä ÏïïÏ∂ïÎêòÏóàÏäµÎãàÎã§!',
                message_compressed_video: 'Í∞ú ÎπÑÎîîÏò§Í∞Ä ÏïïÏ∂ïÎêòÏóàÏäµÎãàÎã§!',
                message_initialized: 'ÏÑ§Ï†ïÏù¥ Ï¥àÍ∏∞ÌôîÎêòÏóàÏäµÎãàÎã§.',
                message_reset_confirm: 'Î™®Îì† ÏÑ§Ï†ïÏùÑ Ï¥àÍ∏∞ÌôîÌïòÏãúÍ≤†ÏäµÎãàÍπå?'
            },
            en: {
                // Ìó§Îçî
                main_title: 'OHOTORO HORIE Optimizer',
                main_subtitle: 'Professional Media Optimization Suite',
                
                // ÌÉ≠
                tab_image: 'Image',
                tab_video: 'Video',
                
                // ÏóÖÎ°úÎìú
                image_upload_text: 'Drop images here',
                image_upload_subtext: 'or click to select',
                video_upload_text: 'Drop videos here',
                video_upload_subtext: 'or click to select',
                
                // ÌÅ¨Î°≠
                crop_label: 'CROP SETTINGS',
                crop_preview: 'Preview',
                crop_reset: 'Reset',
                crop_apply: 'Apply Crop',
                crop_skip: 'Skip Crop',
                
                // ÏÑ§Ï†ï ÎùºÎ≤®
                quality_label: 'Quality',
                size_label: 'Max Width',
                format_label: 'Output Format',
                options_label: 'Additional Options',
                video_quality_label: 'Video Quality',
                video_resolution_label: 'Resolution',
                video_options_label: 'Options',
                
                // ÌíàÏßà ÏòµÏÖò
                quality_low: 'Low (60)',
                quality_medium: 'Medium (80)',
                quality_high: 'High (92)',
                quality_custom: 'Custom',
                video_quality_low: 'Low',
                video_quality_medium: 'Medium',
                video_quality_high: 'High',
                
                // ÌÅ¨Í∏∞ ÏòµÏÖò
                size_original: 'Original',
                size_custom: 'Custom',
                
                // Ìè¨Îß∑ ÏòµÏÖò
                format_original: 'Keep Original',
                
                // Ìï¥ÏÉÅÎèÑ ÏòµÏÖò
                video_resolution_original: 'Keep Original',
                
                // Ï≤¥ÌÅ¨Î∞ïÏä§
                metadata_label: 'Remove metadata',
                progressive_label: 'Progressive encoding',
                audio_label: 'Remove audio',
                
                // Î≤ÑÌäº
                process_images: 'Process Images',
                process_videos: 'Process Videos',
                clear_all: 'Clear All',
                download_all: 'Download All',
                
                // ÌÜµÍ≥Ñ
                stat_files: 'Total Files',
                stat_original: 'Original Size',
                stat_compressed: 'Compressed Size',
                stat_saved: 'Space Saved',
                
                // ÏÉÅÌÉú
                status_waiting: 'Waiting',
                status_processing: 'Processing',
                status_complete: 'Complete',
                status_error: 'Error',
                
                // Î©îÏãúÏßÄ
                message_ready: 'FFmpeg is loading. Please wait.',
                message_preparing: 'Preparing download...',
                message_complete: 'Download ready!',
                message_compressed_image: ' images compressed!',
                message_compressed_video: ' videos compressed!',
                message_initialized: 'Settings have been reset.',
                message_reset_confirm: 'Reset all settings?'
            }
        };

        // Î©îÏãúÏßÄ Í∞ÄÏ†∏Ïò§Í∏∞
        function getMessage(key) {
            return messages[currentLanguage][key] || messages.en[key] || key;
        }

        // Ïñ∏Ïñ¥ Ï†ÑÌôò
        function setLanguage(lang) {
            currentLanguage = lang;
            localStorage.setItem('ohotoro-language', lang);
            
            // Ïñ∏Ïñ¥ Î≤ÑÌäº ÏóÖÎç∞Ïù¥Ìä∏
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.lang === lang);
            });
            
            // UI ÌÖçÏä§Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏
            updateUIText();
        }

        // UI ÌÖçÏä§Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏
        function updateUIText() {
            // Î™®Îì† idÍ∞Ä ÏûàÎäî ÏöîÏÜåÏùò ÌÖçÏä§Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏
            const textElements = [
                'main-title', 'main-subtitle',
                'image-upload-text', 'image-upload-subtext',
                'video-upload-text', 'video-upload-subtext',
                'crop-label', 'quality-label', 'size-label', 'format-label', 'options-label',
                'video-quality-label', 'video-resolution-label', 'video-options-label',
                'quality-low', 'quality-medium', 'quality-high', 'quality-custom',
                'video-quality-low', 'video-quality-medium', 'video-quality-high',
                'size-original', 'size-custom', 'format-original',
                'video-resolution-original', 'metadata-label', 'progressive-label', 'audio-label',
                'stat-files', 'stat-original', 'stat-compressed', 'stat-saved'
            ];
            
            textElements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    const key = id.replace(/-/g, '_');
                    const text = getMessage(key);
                    if (text) element.textContent = text;
                }
            });
            
            // ÌÉ≠ ÌÖçÏä§Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏
            document.querySelectorAll('.tab').forEach(tab => {
                const tabName = tab.dataset.tab;
                tab.textContent = getMessage(`tab_${tabName}`);
            });
            
            // Î≤ÑÌäº ÌÖçÏä§Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏
            document.getElementById('image-process').textContent = getMessage('process_images');
            document.getElementById('video-process').textContent = getMessage('process_videos');
            document.querySelectorAll('#image-clear, #video-clear').forEach(btn => {
                btn.textContent = getMessage('clear_all');
            });
            document.querySelectorAll('#image-download, #video-download').forEach(btn => {
                btn.textContent = getMessage('download_all');
            });
            
            // ÌÅ¨Î°≠ Î≤ÑÌäº ÌÖçÏä§Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏
            document.getElementById('crop-preview').textContent = getMessage('crop_preview');
            document.getElementById('crop-reset').textContent = getMessage('crop_reset');
            document.getElementById('crop-apply').textContent = getMessage('crop_apply');
            document.getElementById('crop-skip').textContent = getMessage('crop_skip');
        }

        // Ïñ∏Ïñ¥ Ï¥àÍ∏∞Ìôî
        function initLanguage() {
            const savedLang = localStorage.getItem('ohotoro-language') || 'en';
            setLanguage(savedLang);
        }

        // Ïñ∏Ïñ¥ Î≤ÑÌäº Ïù¥Î≤§Ìä∏
        document.querySelectorAll('.lang-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                setLanguage(btn.dataset.lang);
            });
        });

        // ============= ÏÑ§Ï†ï Í¥ÄÎ¶¨ =============
        const settings = {
            save: function() {
                const data = {
                    quality: document.querySelector('input[name="quality"]:checked').value,
                    qualityCustom: document.getElementById('quality-custom-value').value,
                    size: document.querySelector('input[name="size"]:checked').value,
                    sizeCustom: document.getElementById('size-custom-value').value,
                    format: document.querySelector('input[name="format"]:checked').value,
                    removeMetadata: document.getElementById('remove-metadata').checked,
                    progressive: document.getElementById('progressive').checked,
                    videoQuality: document.querySelector('input[name="video-quality"]:checked')?.value,
                    videoResolution: document.querySelector('input[name="video-resolution"]:checked')?.value,
                    removeAudio: document.getElementById('remove-audio').checked
                };
                localStorage.setItem('ohotoro-settings', JSON.stringify(data));
            },
            
            load: function() {
                const saved = localStorage.getItem('ohotoro-settings');
                if (!saved) return null;
                
                try {
                    return JSON.parse(saved);
                } catch {
                    return null;
                }
            },
            
            apply: function() {
                const data = this.load();
                if (!data) return;
                
                // Ïù¥ÎØ∏ÏßÄ ÏÑ§Ï†ï
                if (data.quality) {
                    document.querySelector(`input[name="quality"][value="${data.quality}"]`).checked = true;
                    document.querySelectorAll('.radio-option').forEach(opt => {
                        const radio = opt.querySelector('input[name="quality"]');
                        opt.classList.toggle('selected', radio && radio.checked);
                    });
                }
                
                if (data.qualityCustom) {
                    document.getElementById('quality-custom-value').value = data.qualityCustom;
                }
                
                if (data.size) {
                    document.querySelector(`input[name="size"][value="${data.size}"]`).checked = true;
                    document.querySelectorAll('.radio-option').forEach(opt => {
                        const radio = opt.querySelector('input[name="size"]');
                        opt.classList.toggle('selected', radio && radio.checked);
                    });
                }
                
                if (data.sizeCustom) {
                    document.getElementById('size-custom-value').value = data.sizeCustom;
                }
                
                if (data.format) {
                    document.querySelector(`input[name="format"][value="${data.format}"]`).checked = true;
                    document.querySelectorAll('.radio-option').forEach(opt => {
                        const radio = opt.querySelector('input[name="format"]');
                        opt.classList.toggle('selected', radio && radio.checked);
                    });
                }
                
                document.getElementById('remove-metadata').checked = data.removeMetadata || false;
                document.getElementById('progressive').checked = data.progressive !== false;
                
                // ÎπÑÎîîÏò§ ÏÑ§Ï†ï
                if (data.videoQuality) {
                    const videoQuality = document.querySelector(`input[name="video-quality"][value="${data.videoQuality}"]`);
                    if (videoQuality) {
                        videoQuality.checked = true;
                        document.querySelectorAll('.radio-option').forEach(opt => {
                            const radio = opt.querySelector('input[name="video-quality"]');
                            opt.classList.toggle('selected', radio && radio.checked);
                        });
                    }
                }
                
                if (data.videoResolution) {
                    const videoRes = document.querySelector(`input[name="video-resolution"][value="${data.videoResolution}"]`);
                    if (videoRes) {
                        videoRes.checked = true;
                        document.querySelectorAll('.radio-option').forEach(opt => {
                            const radio = opt.querySelector('input[name="video-resolution"]');
                            opt.classList.toggle('selected', radio && radio.checked);
                        });
                    }
                }
                
                document.getElementById('remove-audio').checked = data.removeAudio || false;
            }
        };

        // ============= FFmpeg Ï¥àÍ∏∞Ìôî =============
        async function initFFmpeg() {
            if (typeof FFmpeg === 'undefined') {
                console.warn('FFmpeg not loaded');
                return;
            }
            
            const { createFFmpeg } = FFmpeg;
            ffmpeg = createFFmpeg({ log: false });
            
            try {
                await ffmpeg.load();
                ffmpegLoaded = true;
                console.log('FFmpeg loaded successfully');
            } catch (error) {
                console.error('Failed to load FFmpeg:', error);
            }
        }

        // FFmpeg Ï¥àÍ∏∞Ìôî ÏãúÏûë
        initFFmpeg();

        // ============= ÌÉ≠ Ï†ÑÌôò =============
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                // Î™®Îì† ÌÉ≠ ÎπÑÌôúÏÑ±Ìôî
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                // ÏÑ†ÌÉùÎêú ÌÉ≠ ÌôúÏÑ±Ìôî
                tab.classList.add('active');
                document.getElementById(`${tab.dataset.tab}-tab`).classList.add('active');
            });
        });

        // ============= ÎùºÎîîÏò§ Î≤ÑÌäº Ïä§ÌÉÄÏùº =============
        document.querySelectorAll('.radio-option').forEach(option => {
            option.addEventListener('click', function() {
                const input = this.querySelector('input[type="radio"]');
                if (input) {
                    // Í∞ôÏùÄ Í∑∏Î£πÏùò Îã§Î•∏ ÏòµÏÖòÎì§ ÎπÑÌôúÏÑ±Ìôî
                    const groupName = input.name;
                    document.querySelectorAll(`input[name="${groupName}"]`).forEach(radio => {
                        radio.closest('.radio-option').classList.remove('selected');
                    });
                    
                    // ÌòÑÏû¨ ÏòµÏÖò ÌôúÏÑ±Ìôî
                    input.checked = true;
                    this.classList.add('selected');
                    
                    // Ïª§Ïä§ÌÖÄ ÏûÖÎ†• ÌëúÏãú/Ïà®Í∏∞Í∏∞
                    if (input.value === 'custom') {
                        const customInput = document.getElementById(`${groupName.replace('-', '')}-custom-input`);
                        if (customInput) customInput.classList.add('active');
                    } else {
                        const customInput = document.getElementById(`${groupName.replace('-', '')}-custom-input`);
                        if (customInput) customInput.classList.remove('active');
                    }
                    
                    // ÏÑ§Ï†ï Ï†ÄÏû•
                    settings.save();
                }
            });
        });

        // Ï≤¥ÌÅ¨Î∞ïÏä§ Î≥ÄÍ≤Ω Ïãú ÏÑ§Ï†ï Ï†ÄÏû•
        document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
            checkbox.addEventListener('change', () => settings.save());
        });

        // Ïª§Ïä§ÌÖÄ Í∞í Î≥ÄÍ≤Ω Ïãú ÏÑ§Ï†ï Ï†ÄÏû•
        document.querySelectorAll('.custom-input input').forEach(input => {
            input.addEventListener('input', () => settings.save());
        });

        // ============= ÏÑ±Í≥µ Î©îÏãúÏßÄ ÌëúÏãú =============
        function showSuccessMessage(text) {
            const message = document.getElementById('success-message');
            message.textContent = text;
            message.classList.add('active');
            
            setTimeout(() => {
                message.classList.remove('active');
            }, 3000);
        }

        // ============= Ïù¥ÎØ∏ÏßÄ Ï≤òÎ¶¨ =============
        
        // Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú ÏòÅÏó≠
        const imageUploadArea = document.getElementById('image-upload-area');
        const imageInput = document.getElementById('image-input');

        // Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú ÏòÅÏó≠ ÌÅ¥Î¶≠
        imageUploadArea.addEventListener('click', () => {
            imageInput.click();
        });

        // ÎìúÎûòÍ∑∏ Ïï§ ÎìúÎ°≠
        imageUploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            imageUploadArea.classList.add('dragover');
        });

        imageUploadArea.addEventListener('dragleave', () => {
            imageUploadArea.classList.remove('dragover');
        });

        imageUploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            imageUploadArea.classList.remove('dragover');
            
            const files = Array.from(e.dataTransfer.files).filter(file => file.type.startsWith('image/'));
            if (files.length > 0) {
                handleImageFiles(files);
            }
        });

        // ÌååÏùº ÏÑ†ÌÉù
        imageInput.addEventListener('change', (e) => {
            const files = Array.from(e.target.files);
            handleImageFiles(files);
        });

        // Ïù¥ÎØ∏ÏßÄ ÌååÏùº Ï≤òÎ¶¨
        function handleImageFiles(files) {
            imageFiles = files;
            
            // ÌÅ¨Î°≠ Îç∞Ïù¥ÌÑ∞ Ï¥àÍ∏∞Ìôî
            cropEditor.cropData = new Array(files.length).fill(null);
            cropEditor.currentImageIndex = 0;
            
            // ÌÅ¨Î°≠ ÏóêÎîîÌÑ∞ ÌëúÏãú
            document.getElementById('crop-editor').classList.add('active');
            
            // Ï≤´ Î≤àÏß∏ Ïù¥ÎØ∏ÏßÄ Î°úÎìú
            loadImageForCrop(0);
        }

        // ÌÅ¨Î°≠ÏùÑ ÏúÑÌïú Ïù¥ÎØ∏ÏßÄ Î°úÎìú
        function loadImageForCrop(index) {
            if (index >= imageFiles.length) {
                // Î™®Îì† Ïù¥ÎØ∏ÏßÄ ÌÅ¨Î°≠ ÏôÑÎ£å
                finalizeCroppedImages();
                return;
            }

            const file = imageFiles[index];
            const reader = new FileReader();

            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    cropEditor.image = img;
                    cropEditor.currentImageIndex = index;
                    initializeCropCanvas();
                };
                img.src = e.target.result;
            };

            reader.readAsDataURL(file);
        }

        // ÌÅ¨Î°≠ Ï∫îÎ≤ÑÏä§ Ï¥àÍ∏∞Ìôî
        function initializeCropCanvas() {
            cropEditor.canvas = document.getElementById('crop-canvas');
            cropEditor.ctx = cropEditor.canvas.getContext('2d');

            const container = document.querySelector('.crop-container');
            const maxWidth = container.clientWidth - 60;
            const maxHeight = 600;

            let scale = 1;
            if (cropEditor.image.width > maxWidth) {
                scale = maxWidth / cropEditor.image.width;
            }
            if (cropEditor.image.height * scale > maxHeight) {
                scale = maxHeight / cropEditor.image.height;
            }

            cropEditor.canvas.width = cropEditor.image.width * scale;
            cropEditor.canvas.height = cropEditor.image.height * scale;

            // Ïù¥ÎØ∏ÏßÄ Í∑∏Î¶¨Í∏∞
            cropEditor.ctx.drawImage(cropEditor.image, 0, 0, cropEditor.canvas.width, cropEditor.canvas.height);

            // Í∏∞Î≥∏ ÌÅ¨Î°≠ ÏòÅÏó≠ ÏÑ§Ï†ï (5:7 ÎπÑÏú®)
            if (!cropEditor.cropData[cropEditor.currentImageIndex]) {
                setCropAreaByRatio();
            } else {
                // Ï†ÄÏû•Îêú ÌÅ¨Î°≠ Îç∞Ïù¥ÌÑ∞ Ï†ÅÏö©
                const data = cropEditor.cropData[cropEditor.currentImageIndex];
                cropEditor.cropX = data.x * (cropEditor.canvas.width / cropEditor.image.width);
                cropEditor.cropY = data.y * (cropEditor.canvas.height / cropEditor.image.height);
                cropEditor.cropWidth = data.width * (cropEditor.canvas.width / cropEditor.image.width);
                cropEditor.cropHeight = data.height * (cropEditor.canvas.height / cropEditor.image.height);
            }

            updateCropOverlay();
            updateCropInfo();
        }

        // ÎπÑÏú®Ïóê Îî∞Î•∏ ÌÅ¨Î°≠ ÏòÅÏó≠ ÏÑ§Ï†ï
        function setCropAreaByRatio() {
            const canvasWidth = cropEditor.canvas.width;
            const canvasHeight = cropEditor.canvas.height;

            if (cropEditor.currentRatio === 'free') {
                cropEditor.cropWidth = canvasWidth * 0.8;
                cropEditor.cropHeight = canvasHeight * 0.8;
            } else {
                if (canvasWidth / canvasHeight > cropEditor.aspectRatio) {
                    cropEditor.cropHeight = canvasHeight * 0.8;
                    cropEditor.cropWidth = cropEditor.cropHeight * cropEditor.aspectRatio;
                } else {
                    cropEditor.cropWidth = canvasWidth * 0.8;
                    cropEditor.cropHeight = cropEditor.cropWidth / cropEditor.aspectRatio;
                }
            }

            cropEditor.cropX = (canvasWidth - cropEditor.cropWidth) / 2;
            cropEditor.cropY = (canvasHeight - cropEditor.cropHeight) / 2;
        }

        // ÌÅ¨Î°≠ Ïò§Î≤ÑÎ†àÏù¥ ÏóÖÎç∞Ïù¥Ìä∏
        function updateCropOverlay() {
            const overlay = document.getElementById('crop-overlay');
            overlay.style.left = cropEditor.cropX + 'px';
            overlay.style.top = cropEditor.cropY + 'px';
            overlay.style.width = cropEditor.cropWidth + 'px';
            overlay.style.height = cropEditor.cropHeight + 'px';
        }

        // ÌÅ¨Î°≠ Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
        function updateCropInfo() {
            const scale = cropEditor.image.width / cropEditor.canvas.width;
            const actualWidth = Math.round(cropEditor.cropWidth * scale);
            const actualHeight = Math.round(cropEditor.cropHeight * scale);
            document.getElementById('crop-dimensions').textContent = `${actualWidth} x ${actualHeight}`;
        }

        // ÌÅ¨Î°≠ ÎπÑÏú® Î≤ÑÌäº Ïù¥Î≤§Ìä∏
        document.querySelectorAll('.crop-ratio-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.crop-ratio-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');

                cropEditor.currentRatio = this.dataset.ratio;

                switch (this.dataset.ratio) {
                    case 'free':
                        cropEditor.aspectRatio = null;
                        break;
                    case '1:1':
                        cropEditor.aspectRatio = 1;
                        break;
                    case '4:3':
                        cropEditor.aspectRatio = 4/3;
                        break;
                    case '16:9':
                        cropEditor.aspectRatio = 16/9;
                        break;
                    case '3:2':
                        cropEditor.aspectRatio = 3/2;
                        break;
                    case '9:16':
                        cropEditor.aspectRatio = 9/16;
                        break;
                    case '5:7':
                    default:
                        cropEditor.aspectRatio = 5/7;
                        break;
                }

                if (cropEditor.aspectRatio) {
                    // ÌòÑÏû¨ Ï§ëÏã¨Ï†ê Ïú†ÏßÄÌïòÎ©∞ ÎπÑÏú® Ï°∞Ï†ï
                    const centerX = cropEditor.cropX + cropEditor.cropWidth / 2;
                    const centerY = cropEditor.cropY + cropEditor.cropHeight / 2;

                    if (cropEditor.cropWidth / cropEditor.cropHeight > cropEditor.aspectRatio) {
                        cropEditor.cropWidth = cropEditor.cropHeight * cropEditor.aspectRatio;
                    } else {
                        cropEditor.cropHeight = cropEditor.cropWidth / cropEditor.aspectRatio;
                    }

                    cropEditor.cropX = centerX - cropEditor.cropWidth / 2;
                    cropEditor.cropY = centerY - cropEditor.cropHeight / 2;

                    // Í≤ΩÍ≥Ñ Ï≤¥ÌÅ¨
                    if (cropEditor.cropX < 0) cropEditor.cropX = 0;
                    if (cropEditor.cropY < 0) cropEditor.cropY = 0;
                    if (cropEditor.cropX + cropEditor.cropWidth > cropEditor.canvas.width) {
                        cropEditor.cropX = cropEditor.canvas.width - cropEditor.cropWidth;
                    }
                    if (cropEditor.cropY + cropEditor.cropHeight > cropEditor.canvas.height) {
                        cropEditor.cropY = cropEditor.canvas.height - cropEditor.cropHeight;
                    }

                    updateCropOverlay();
                    updateCropInfo();
                }
            });
        });

        // ÌÅ¨Î°≠ ÏòÅÏó≠ ÎìúÎûòÍ∑∏ Ïù¥Î≤§Ìä∏
        document.getElementById('crop-canvas').addEventListener('mousedown', function(e) {
            const rect = this.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            // ÌÅ¨Î°≠ ÏòÅÏó≠ ÎÇ¥Î∂Ä ÌÅ¥Î¶≠ ÌôïÏù∏
            if (x >= cropEditor.cropX && x <= cropEditor.cropX + cropEditor.cropWidth &&
                y >= cropEditor.cropY && y <= cropEditor.cropY + cropEditor.cropHeight) {
                cropEditor.isDragging = true;
                cropEditor.startX = x - cropEditor.cropX;
                cropEditor.startY = y - cropEditor.cropY;
                e.preventDefault();
            }
        });

        document.addEventListener('mousemove', function(e) {
            if (cropEditor.isDragging) {
                const canvas = cropEditor.canvas;
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;

                cropEditor.cropX = x - cropEditor.startX;
                cropEditor.cropY = y - cropEditor.startY;

                // Í≤ΩÍ≥Ñ Ï≤¥ÌÅ¨
                if (cropEditor.cropX < 0) cropEditor.cropX = 0;
                if (cropEditor.cropY < 0) cropEditor.cropY = 0;
                if (cropEditor.cropX + cropEditor.cropWidth > canvas.width) {
                    cropEditor.cropX = canvas.width - cropEditor.cropWidth;
                }
                if (cropEditor.cropY + cropEditor.cropHeight > canvas.height) {
                    cropEditor.cropY = canvas.height - cropEditor.cropHeight;
                }

                updateCropOverlay();
                updateCropInfo();
            }
        });

        document.addEventListener('mouseup', function() {
            cropEditor.isDragging = false;
        });

        // ÌÅ¨Î°≠ Ìï∏Îì§ Î¶¨ÏÇ¨Ïù¥Ï¶à Ïù¥Î≤§Ìä∏
        document.querySelectorAll('.crop-handle').forEach(handle => {
            handle.addEventListener('mousedown', function(e) {
                e.stopPropagation();
                cropEditor.isResizing = true;
                cropEditor.resizeHandle = this.className.split(' ')[1];
                cropEditor.startX = e.clientX;
                cropEditor.startY = e.clientY;
                cropEditor.startWidth = cropEditor.cropWidth;
                cropEditor.startHeight = cropEditor.cropHeight;
                cropEditor.startCropX = cropEditor.cropX;
                cropEditor.startCropY = cropEditor.cropY;
                e.preventDefault();
            });
        });

        document.addEventListener('mousemove', function(e) {
            if (cropEditor.isResizing) {
                const dx = e.clientX - cropEditor.startX;
                const dy = e.clientY - cropEditor.startY;

                switch (cropEditor.resizeHandle) {
                    case 'se':
                        if (cropEditor.currentRatio === 'free') {
                            cropEditor.cropWidth = Math.max(50, cropEditor.startWidth + dx);
                            cropEditor.cropHeight = Math.max(50, cropEditor.startHeight + dy);
                        } else {
                            const newWidth = Math.max(50, cropEditor.startWidth + dx);
                            const newHeight = Math.max(50, cropEditor.startHeight + dy);
                            
                            if (Math.abs(dx) > Math.abs(dy)) {
                                cropEditor.cropWidth = newWidth;
                                cropEditor.cropHeight = newWidth / cropEditor.aspectRatio;
                            } else {
                                cropEditor.cropHeight = newHeight;
                                cropEditor.cropWidth = newHeight * cropEditor.aspectRatio;
                            }
                        }
                        break;
                    case 'sw':
                        if (cropEditor.currentRatio === 'free') {
                            cropEditor.cropWidth = Math.max(50, cropEditor.startWidth - dx);
                            cropEditor.cropHeight = Math.max(50, cropEditor.startHeight + dy);
                            cropEditor.cropX = cropEditor.startCropX + dx;
                        } else {
                            const newWidth = Math.max(50, cropEditor.startWidth - dx);
                            const newHeight = Math.max(50, cropEditor.startHeight + dy);
                            
                            if (Math.abs(dx) > Math.abs(dy)) {
                                cropEditor.cropWidth = newWidth;
                                cropEditor.cropHeight = newWidth / cropEditor.aspectRatio;
                            } else {
                                cropEditor.cropHeight = newHeight;
                                cropEditor.cropWidth = newHeight * cropEditor.aspectRatio;
                            }
                            cropEditor.cropX = cropEditor.startCropX + cropEditor.startWidth - cropEditor.cropWidth;
                        }
                        break;
                    case 'ne':
                        if (cropEditor.currentRatio === 'free') {
                            cropEditor.cropWidth = Math.max(50, cropEditor.startWidth + dx);
                            cropEditor.cropHeight = Math.max(50, cropEditor.startHeight - dy);
                            cropEditor.cropY = cropEditor.startCropY + dy;
                        } else {
                            const newWidth = Math.max(50, cropEditor.startWidth + dx);
                            const newHeight = Math.max(50, cropEditor.startHeight - dy);
                            
                            if (Math.abs(dx) > Math.abs(dy)) {
                                cropEditor.cropWidth = newWidth;
                                cropEditor.cropHeight = newWidth / cropEditor.aspectRatio;
                            } else {
                                cropEditor.cropHeight = newHeight;
                                cropEditor.cropWidth = newHeight * cropEditor.aspectRatio;
                            }
                            cropEditor.cropY = cropEditor.startCropY + cropEditor.startHeight - cropEditor.cropHeight;
                        }
                        break;
                    case 'nw':
                        if (cropEditor.currentRatio === 'free') {
                            cropEditor.cropWidth = Math.max(50, cropEditor.startWidth - dx);
                            cropEditor.cropHeight = Math.max(50, cropEditor.startHeight - dy);
                            cropEditor.cropX = cropEditor.startCropX + dx;
                            cropEditor.cropY = cropEditor.startCropY + dy;
                        } else {
                            const newWidth = Math.max(50, cropEditor.startWidth - dx);
                            const newHeight = Math.max(50, cropEditor.startHeight - dy);
                            
                            if (Math.abs(dx) > Math.abs(dy)) {
                                cropEditor.cropWidth = newWidth;
                                cropEditor.cropHeight = newWidth / cropEditor.aspectRatio;
                            } else {
                                cropEditor.cropHeight = newHeight;
                                cropEditor.cropWidth = newHeight * cropEditor.aspectRatio;
                            }
                            cropEditor.cropX = cropEditor.startCropX + cropEditor.startWidth - cropEditor.cropWidth;
                            cropEditor.cropY = cropEditor.startCropY + cropEditor.startHeight - cropEditor.cropHeight;
                        }
                        break;
                }

                // Í≤ΩÍ≥Ñ Ï≤¥ÌÅ¨
                if (cropEditor.cropX < 0) cropEditor.cropX = 0;
                if (cropEditor.cropY < 0) cropEditor.cropY = 0;
                if (cropEditor.cropX + cropEditor.cropWidth > cropEditor.canvas.width) {
                    cropEditor.cropWidth = cropEditor.canvas.width - cropEditor.cropX;
                    if (cropEditor.aspectRatio) {
                        cropEditor.cropHeight = cropEditor.cropWidth / cropEditor.aspectRatio;
                    }
                }
                if (cropEditor.cropY + cropEditor.cropHeight > cropEditor.canvas.height) {
                    cropEditor.cropHeight = cropEditor.canvas.height - cropEditor.cropY;
                    if (cropEditor.aspectRatio) {
                        cropEditor.cropWidth = cropEditor.cropHeight * cropEditor.aspectRatio;
                    }
                }

                updateCropOverlay();
                updateCropInfo();
            }
        });

        document.addEventListener('mouseup', function() {
            cropEditor.isResizing = false;
            cropEditor.resizeHandle = null;
        });

        // ÌÅ¨Î°≠ ÎØ∏Î¶¨Î≥¥Í∏∞
        document.getElementById('crop-preview').addEventListener('click', function() {
            const scale = cropEditor.image.width / cropEditor.canvas.width;
            const cropX = cropEditor.cropX * scale;
            const cropY = cropEditor.cropY * scale;
            const cropWidth = cropEditor.cropWidth * scale;
            const cropHeight = cropEditor.cropHeight * scale;

            const tempCanvas = document.createElement('canvas');
            tempCanvas.width = cropWidth;
            tempCanvas.height = cropHeight;
            const tempCtx = tempCanvas.getContext('2d');

            tempCtx.drawImage(cropEditor.image, cropX, cropY, cropWidth, cropHeight, 0, 0, cropWidth, cropHeight);

            const modal = document.getElementById('preview-modal');
            const previewImage = document.getElementById('preview-image');
            const previewInfo = document.getElementById('preview-info');

            previewImage.src = tempCanvas.toDataURL('image/png');
            previewInfo.textContent = `${Math.round(cropWidth)} x ${Math.round(cropHeight)} pixels`;
            modal.classList.add('active');
        });

        // ÎØ∏Î¶¨Î≥¥Í∏∞ Î™®Îã¨ Îã´Í∏∞
        document.getElementById('preview-close').addEventListener('click', function() {
            document.getElementById('preview-modal').classList.remove('active');
        });

        document.getElementById('preview-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                this.classList.remove('active');
            }
        });

        // ÌÅ¨Î°≠ Î¶¨ÏÖã
        document.getElementById('crop-reset').addEventListener('click', function() {
            setCropAreaByRatio();
            updateCropOverlay();
            updateCropInfo();
        });

        // ÌÅ¨Î°≠ Ï†ÅÏö©
        document.getElementById('crop-apply').addEventListener('click', function() {
            // ÌòÑÏû¨ Ïù¥ÎØ∏ÏßÄÏùò ÌÅ¨Î°≠ Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•
            const scale = cropEditor.image.width / cropEditor.canvas.width;
            cropEditor.cropData[cropEditor.currentImageIndex] = {
                x: cropEditor.cropX * scale,
                y: cropEditor.cropY * scale,
                width: cropEditor.cropWidth * scale,
                height: cropEditor.cropHeight * scale
            };

            // Îã§Ïùå Ïù¥ÎØ∏ÏßÄÎ°ú
            cropEditor.currentImageIndex++;
            loadImageForCrop(cropEditor.currentImageIndex);
        });

        // ÌÅ¨Î°≠ Í±¥ÎÑàÎõ∞Í∏∞
        document.getElementById('crop-skip').addEventListener('click', function() {
            // ÌÅ¨Î°≠ Îç∞Ïù¥ÌÑ∞ ÏóÜÏù¥ Îã§Ïùå Ïù¥ÎØ∏ÏßÄÎ°ú
            cropEditor.cropData[cropEditor.currentImageIndex] = null;
            
            // Îã§Ïùå Ïù¥ÎØ∏ÏßÄÎ°ú
            cropEditor.currentImageIndex++;
            loadImageForCrop(cropEditor.currentImageIndex);
        });

        // ÌÅ¨Î°≠ ÏôÑÎ£å ÌõÑ Ïù¥ÎØ∏ÏßÄ Ï≤òÎ¶¨
        function finalizeCroppedImages() {
            document.getElementById('crop-editor').classList.remove('active');
            
            // UI ÏóÖÎç∞Ïù¥Ìä∏
            document.getElementById('image-settings').style.display = 'block';
            document.getElementById('image-file-list').style.display = 'block';
            document.getElementById('image-buttons').style.display = 'flex';
            
            // ÌååÏùº Î¶¨Ïä§Ìä∏ ÌëúÏãú
            displayImageFiles();
        }

        // Ïù¥ÎØ∏ÏßÄ ÌååÏùº Î¶¨Ïä§Ìä∏ ÌëúÏãú
        function displayImageFiles() {
            const fileList = document.getElementById('image-file-list');
            fileList.innerHTML = '';
            
            imageFiles.forEach((file, index) => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.innerHTML = `
                    <div class="file-info">
                        <div class="file-name">${file.name}</div>
                        <div class="file-size">${formatFileSize(file.size)}</div>
                    </div>
                    <div class="file-status" id="status-${index}">${getMessage('status_waiting')}</div>
                `;
                fileList.appendChild(fileItem);
            });
        }

        // Ïù¥ÎØ∏ÏßÄ Ï≤òÎ¶¨ Î≤ÑÌäº
        document.getElementById('image-process').addEventListener('click', async () => {
            const quality = document.querySelector('input[name="quality"]:checked').value;
            const size = document.querySelector('input[name="size"]:checked').value;
            const format = document.querySelector('input[name="format"]:checked').value;
            const removeMetadata = document.getElementById('remove-metadata').checked;
            const progressive = document.getElementById('progressive').checked;
            
            // Î°úÎî© ÌëúÏãú
            const loading = document.getElementById('image-loading');
            const progressBar = document.getElementById('image-progress');
            progressBar.classList.add('active');
            
            processedImages = [];
            let totalOriginalSize = 0;
            let totalCompressedSize = 0;

            for (let i = 0; i < imageFiles.length; i++) {
                const file = imageFiles[i];
                const statusElement = document.getElementById(`status-${i}`);
                statusElement.textContent = getMessage('status_processing');
                statusElement.className = 'file-status processing';
                
                loading.classList.add('active');
                loading.querySelector('.loading-text').textContent = `${getMessage('status_processing')}: ${file.name}`;

                try {
                    const processed = await processImage(file, i, quality, size, format, removeMetadata, progressive);
                    processedImages.push(processed);
                    
                    totalOriginalSize += file.size;
                    totalCompressedSize += processed.blob.size;
                    
                    statusElement.textContent = getMessage('status_complete');
                    statusElement.className = 'file-status complete';
                } catch (error) {
                    console.error('Error processing image:', error);
                    statusElement.textContent = getMessage('status_error');
                    statusElement.className = 'file-status error';
                }

                // ÏßÑÌñâÎ•† ÏóÖÎç∞Ïù¥Ìä∏
                const progress = ((i + 1) / imageFiles.length) * 100;
                progressBar.querySelector('.progress-fill').style.width = progress + '%';
            }

            loading.classList.remove('active');
            
            // ÌÜµÍ≥Ñ ÌëúÏãú
            displayImageStats(totalOriginalSize, totalCompressedSize);
            
            // ÏÑ±Í≥µ Î©îÏãúÏßÄ ÌëúÏãú
            showSuccessMessage(`${imageFiles.length}${getMessage('message_compressed_image')}`);
            
            // Îã§Ïö¥Î°úÎìú Î≤ÑÌäº ÌëúÏãú
            document.getElementById('image-download').style.display = 'inline-block';
            progressBar.classList.remove('active');
        });

        // Ïù¥ÎØ∏ÏßÄ Ï≤òÎ¶¨ Ìï®Ïàò
        async function processImage(file, index, quality, size, format, removeMetadata, progressive) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const img = new Image();
                    
                    img.onload = function() {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        
                        let width = img.width;
                        let height = img.height;
                        
                        // ÌÅ¨Î°≠ Ï†ÅÏö©
                        const cropData = cropEditor.cropData[index];
                        if (cropData) {
                            canvas.width = cropData.width;
                            canvas.height = cropData.height;
                            ctx.drawImage(img, cropData.x, cropData.y, cropData.width, cropData.height, 0, 0, cropData.width, cropData.height);
                            
                            // ÌÅ¨Î°≠ ÌõÑ Ïù¥ÎØ∏ÏßÄÎ°ú ÏóÖÎç∞Ïù¥Ìä∏
                            const tempImg = new Image();
                            tempImg.onload = function() {
                                width = tempImg.width;
                                height = tempImg.height;
                                
                                // ÌÅ¨Í∏∞ Ï°∞Ï†ï Ï†ÅÏö©
                                applyResize();
                            };
                            tempImg.src = canvas.toDataURL('image/png');
                        } else {
                            // ÌÅ¨Í∏∞ Ï°∞Ï†ï Ï†ÅÏö©
                            applyResize();
                        }
                        
                        function applyResize() {
                            // ÌÅ¨Í∏∞ Ï°∞Ï†ï
                            let maxWidth = size === 'original' ? width : parseInt(size);
                            if (size === 'custom') {
                                maxWidth = parseInt(document.getElementById('size-custom-value').value);
                            }
                            
                            if (width > maxWidth) {
                                const ratio = maxWidth / width;
                                width = maxWidth;
                                height = Math.round(height * ratio);
                            }
                            
                            canvas.width = width;
                            canvas.height = height;
                            
                            // Ïù¥ÎØ∏ÏßÄ Í∑∏Î¶¨Í∏∞
                            if (cropData) {
                                // ÌÅ¨Î°≠Îêú Ïù¥ÎØ∏ÏßÄ Îã§Ïãú Í∑∏Î¶¨Í∏∞
                                const tempCanvas = document.createElement('canvas');
                                tempCanvas.width = cropData.width;
                                tempCanvas.height = cropData.height;
                                const tempCtx = tempCanvas.getContext('2d');
                                tempCtx.drawImage(img, cropData.x, cropData.y, cropData.width, cropData.height, 0, 0, cropData.width, cropData.height);
                                
                                ctx.drawImage(tempCanvas, 0, 0, tempCanvas.width, tempCanvas.height, 0, 0, width, height);
                            } else {
                                ctx.drawImage(img, 0, 0, width, height);
                            }
                            
                            // ÌíàÏßà ÏÑ§Ï†ï
                            let qualityValue = 0.8;
                            if (quality === 'low') qualityValue = 0.6;
                            else if (quality === 'high') qualityValue = 0.92;
                            else if (quality === 'custom') {
                                qualityValue = parseInt(document.getElementById('quality-custom-value').value) / 100;
                            }
                            
                            // Ìè¨Îß∑ Í≤∞Ï†ï
                            let outputFormat = format;
                            if (format === 'original') {
                                outputFormat = file.type.includes('png') ? 'png' : 
                                              file.type.includes('webp') ? 'webp' : 'jpeg';
                            }
                            
                            // Î∏îÎ°≠ ÏÉùÏÑ±
                            canvas.toBlob(function(blob) {
                                if (blob) {
                                    // ÌååÏùºÎ™Ö ÏÉùÏÑ±
                                    const extension = outputFormat === 'jpeg' ? 'jpg' : outputFormat;
                                    const baseName = file.name.substring(0, file.name.lastIndexOf('.')) || file.name;
                                    const fileName = `${baseName}.${extension}`;
                                    
                                    resolve({
                                        blob: blob,
                                        name: fileName,
                                        originalName: file.name
                                    });
                                } else {
                                    reject(new Error('Failed to create blob'));
                                }
                            }, `image/${outputFormat}`, qualityValue);
                        }
                    };
                    
                    img.onerror = function() {
                        reject(new Error('Failed to load image'));
                    };
                    
                    img.src = e.target.result;
                };
                
                reader.onerror = function() {
                    reject(new Error('Failed to read file'));
                };
                
                reader.readAsDataURL(file);
            });
        }

        // Ïù¥ÎØ∏ÏßÄ ÌÜµÍ≥Ñ ÌëúÏãú
        function displayImageStats(originalSize, compressedSize) {
            document.getElementById('image-stats').style.display = 'flex';
            document.getElementById('image-total-files').textContent = imageFiles.length;
            document.getElementById('image-original-size').textContent = formatFileSize(originalSize);
            document.getElementById('image-compressed-size').textContent = formatFileSize(compressedSize);
            
            const savedPercentage = Math.round((1 - compressedSize / originalSize) * 100);
            document.getElementById('image-saved').textContent = savedPercentage + '%';
        }

        // Ïù¥ÎØ∏ÏßÄ Îã§Ïö¥Î°úÎìú
        document.getElementById('image-download').addEventListener('click', async () => {
            if (processedImages.length === 0) return;
            
            showSuccessMessage(getMessage('message_preparing'));
            
            if (processedImages.length === 1) {
                // Îã®Ïùº ÌååÏùº Îã§Ïö¥Î°úÎìú
                downloadFile(processedImages[0].blob, processedImages[0].name);
            } else {
                // ZIPÏúºÎ°ú Îã§Ïö¥Î°úÎìú
                const zip = new JSZip();
                processedImages.forEach(img => {
                    zip.file(img.name, img.blob);
                });
                
                const zipBlob = await zip.generateAsync({type: 'blob'});
                downloadFile(zipBlob, 'images.zip');
            }
            
            setTimeout(() => {
                showSuccessMessage(getMessage('message_complete'));
            }, 1000);
        });

        // Ïù¥ÎØ∏ÏßÄ Ï¥àÍ∏∞Ìôî
        document.getElementById('image-clear').addEventListener('click', () => {
            imageFiles = [];
            processedImages = [];
            cropEditor.cropData = [];
            cropEditor.currentImageIndex = 0;
            document.getElementById('crop-editor').classList.remove('active');
            document.getElementById('image-settings').style.display = 'none';
            document.getElementById('image-file-list').style.display = 'none';
            document.getElementById('image-stats').style.display = 'none';
            document.getElementById('image-buttons').style.display = 'none';
            document.getElementById('image-download').style.display = 'none';
            imageInput.value = '';
        });

        // ============= ÎπÑÎîîÏò§ Ï≤òÎ¶¨ =============
        
        // ÎπÑÎîîÏò§ ÏóÖÎ°úÎìú ÏòÅÏó≠
        const videoUploadArea = document.getElementById('video-upload-area');
        const videoInput = document.getElementById('video-input');

        // ÎπÑÎîîÏò§ ÏóÖÎ°úÎìú ÏòÅÏó≠ ÌÅ¥Î¶≠
        videoUploadArea.addEventListener('click', () => {
            videoInput.click();
        });

        // ÎìúÎûòÍ∑∏ Ïï§ ÎìúÎ°≠
        videoUploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            videoUploadArea.classList.add('dragover');
        });

        videoUploadArea.addEventListener('dragleave', () => {
            videoUploadArea.classList.remove('dragover');
        });

        videoUploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            videoUploadArea.classList.remove('dragover');
            
            const files = Array.from(e.dataTransfer.files).filter(file => file.type.startsWith('video/'));
            if (files.length > 0) {
                handleVideoFiles(files);
            }
        });

        // ÌååÏùº ÏÑ†ÌÉù
        videoInput.addEventListener('change', (e) => {
            const files = Array.from(e.target.files);
            handleVideoFiles(files);
        });

        // ÎπÑÎîîÏò§ ÌååÏùº Ï≤òÎ¶¨
        function handleVideoFiles(files) {
            videoFiles = files;
            
            // UI ÏóÖÎç∞Ïù¥Ìä∏
            document.getElementById('video-settings').style.display = 'block';
            document.getElementById('video-file-list').style.display = 'block';
            document.getElementById('video-buttons').style.display = 'flex';
            
            // ÌååÏùº Î¶¨Ïä§Ìä∏ ÌëúÏãú
            displayVideoFiles();
        }

        // Video ÌååÏùº Î¶¨Ïä§Ìä∏ ÌëúÏãú
        function displayVideoFiles() {
            const fileList = document.getElementById('video-file-list');
            fileList.innerHTML = '';
            
            videoFiles.forEach((file, index) => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.innerHTML = `
                    <div class="file-info">
                        <div class="file-name">${file.name}</div>
                        <div class="file-size">${formatFileSize(file.size)}</div>
                    </div>
                    <div class="file-status" id="video-status-${index}">${getMessage('status_waiting')}</div>
                `;
                fileList.appendChild(fileItem);
            });
        }

        // Video Ï≤òÎ¶¨ Î≤ÑÌäº
        document.getElementById('video-process').addEventListener('click', async () => {
            if (!ffmpegLoaded) {
                alert(getMessage('message_ready'));
                return;
            }

            const quality = document.querySelector('input[name="video-quality"]:checked').value;
            const resolution = document.querySelector('input[name="video-resolution"]:checked').value;
            const removeAudio = document.getElementById('remove-audio').checked;

            // Î°úÎî© ÌëúÏãú
            const loading = document.getElementById('video-loading');
            const progressBar = document.getElementById('video-progress');
            progressBar.classList.add('active');
            
            processedVideos = [];
            let totalOriginalSize = 0;
            let totalCompressedSize = 0;

            for (let i = 0; i < videoFiles.length; i++) {
                const file = videoFiles[i];
                const statusElement = document.getElementById(`video-status-${i}`);
                statusElement.textContent = getMessage('status_processing');
                statusElement.className = 'file-status processing';
                
                loading.classList.add('active');
                loading.querySelector('.loading-text').textContent = `${getMessage('status_processing')}: ${file.name}`;

                try {
                    const processed = await processVideo(file, quality, resolution, removeAudio);
                    processedVideos.push(processed);
                    
                    totalOriginalSize += file.size;
                    totalCompressedSize += processed.blob.size;
                    
                    statusElement.textContent = getMessage('status_complete');
                    statusElement.className = 'file-status complete';
                } catch (error) {
                    console.error('Error processing video:', error);
                    statusElement.textContent = getMessage('status_error');
                    statusElement.className = 'file-status error';
                }

                // ÏßÑÌñâÎ•† ÏóÖÎç∞Ïù¥Ìä∏
                const progress = ((i + 1) / videoFiles.length) * 100;
                progressBar.querySelector('.progress-fill').style.width = progress + '%';
            }

            loading.classList.remove('active');
            
            // ÌÜµÍ≥Ñ ÌëúÏãú
            displayVideoStats(totalOriginalSize, totalCompressedSize);
            
            // ÏÑ±Í≥µ Î©îÏãúÏßÄ ÌëúÏãú
            showSuccessMessage(`${videoFiles.length}${getMessage('message_compressed_video')}`);
            
            // Îã§Ïö¥Î°úÎìú Î≤ÑÌäº ÌëúÏãú
            document.getElementById('video-download').style.display = 'inline-block';
            progressBar.classList.remove('active');
        });

        // ÎπÑÎîîÏò§ Ï≤òÎ¶¨ Ìï®Ïàò (Í∞ÑÏÜåÌôî Î≤ÑÏ†Ñ)
        async function processVideo(file, quality, resolution, removeAudio) {
            // FFmpeg.wasmÏùÑ ÏÇ¨Ïö©Ìïú Ïã§Ï†ú ÎπÑÎîîÏò§ ÏïïÏ∂ïÏùÄ Î≥µÏû°ÌïòÎØÄÎ°ú
            // Ïó¨Í∏∞ÏÑúÎäî Í∏∞Î≥∏ Íµ¨Ï°∞Îßå Ï†úÍ≥µ
            // Ïã§Ï†ú Íµ¨ÌòÑÏãú FFmpeg Î™ÖÎ†πÏñ¥Î•º Ï°∞Ìï©ÌïòÏó¨ Ï≤òÎ¶¨
            
            const inputName = 'input.mp4';
            const outputName = 'output.mp4';
            
            // ÌååÏùºÏùÑ FFmpeg ÌååÏùº ÏãúÏä§ÌÖúÏóê Ïì∞Í∏∞
            const data = new Uint8Array(await file.arrayBuffer());
            ffmpeg.FS('writeFile', inputName, data);
            
            // FFmpeg Î™ÖÎ†πÏñ¥ Íµ¨ÏÑ±
            let ffmpegCommand = ['-i', inputName];
            
            // ÌíàÏßà ÏÑ§Ï†ï
            if (quality === 'low') {
                ffmpegCommand.push('-crf', '28');
            } else if (quality === 'medium') {
                ffmpegCommand.push('-crf', '23');
            } else {
                ffmpegCommand.push('-crf', '18');
            }
            
            // Ìï¥ÏÉÅÎèÑ ÏÑ§Ï†ï - ÎπÑÏú® Ïú†ÏßÄÌïòÎ©∞ Î¶¨ÏÇ¨Ïù¥Ïßï
            if (resolution !== 'original') {
                // -1ÏùÑ ÏÇ¨Ïö©ÌïòÎ©¥ ÎπÑÏú®Ïóê ÎßûÏ∂∞ ÏûêÎèô Í≥ÑÏÇ∞
                // pad ÌïÑÌÑ∞Î°ú ÎπÑÏú®Ïù¥ ÎßûÏßÄ ÏïäÏùÑ Í≤ΩÏö∞Î•º ÎåÄÎπÑ
                if (resolution === '1080') {
                    ffmpegCommand.push('-vf', 'scale=-2:1080');
                } else if (resolution === '720') {
                    ffmpegCommand.push('-vf', 'scale=-2:720');
                } else if (resolution === '480') {
                    ffmpegCommand.push('-vf', 'scale=-2:480');
                }
            }
            
            // Ïò§ÎîîÏò§ Ï†úÍ±∞
            if (removeAudio) {
                ffmpegCommand.push('-an');
            }
            
            // Ï∂úÎ†• ÏÑ§Ï†ï
            ffmpegCommand.push('-c:v', 'libx264', '-preset', 'medium', outputName);
            
            // FFmpeg Ïã§Ìñâ
            await ffmpeg.run(...ffmpegCommand);
            
            // Í≤∞Í≥º ÏùΩÍ∏∞
            const outputData = ffmpeg.FS('readFile', outputName);
            const blob = new Blob([outputData.buffer], { type: 'video/mp4' });
            
            // ÌååÏùº ÏãúÏä§ÌÖú Ï†ïÎ¶¨
            ffmpeg.FS('unlink', inputName);
            ffmpeg.FS('unlink', outputName);
            
            // ÌååÏùºÎ™Ö ÏÉùÏÑ± - ÏõêÎ≥∏ Ïù¥Î¶Ñ Í∑∏ÎåÄÎ°ú ÏÇ¨Ïö©
            const baseName = file.name.substring(0, file.name.lastIndexOf('.')) || file.name;
            const fileName = `${baseName}.mp4`;
            
            return {
                blob: blob,
                name: fileName,
                originalName: file.name
            };
        }

        // Video ÌÜµÍ≥Ñ ÌëúÏãú
        function displayVideoStats(originalSize, compressedSize) {
            document.getElementById('video-stats').style.display = 'flex';
            document.getElementById('video-total-files').textContent = videoFiles.length;
            document.getElementById('video-original-size').textContent = formatFileSize(originalSize);
            document.getElementById('video-compressed-size').textContent = formatFileSize(compressedSize);
            
            const savedPercentage = Math.round((1 - compressedSize / originalSize) * 100);
            document.getElementById('video-saved').textContent = savedPercentage + '%';
        }

        // Video Îã§Ïö¥Î°úÎìú
        document.getElementById('video-download').addEventListener('click', async () => {
            if (processedVideos.length === 0) return;
            
            showSuccessMessage(getMessage('message_preparing'));
            
            if (processedVideos.length === 1) {
                // Îã®Ïùº ÌååÏùº Îã§Ïö¥Î°úÎìú
                downloadFile(processedVideos[0].blob, processedVideos[0].name);
            } else {
                // ZIPÏúºÎ°ú Îã§Ïö¥Î°úÎìú
                const zip = new JSZip();
                processedVideos.forEach(video => {
                    zip.file(video.name, video.blob);
                });
                
                const zipBlob = await zip.generateAsync({type: 'blob'});
                downloadFile(zipBlob, 'videos.zip');
            }
            
            setTimeout(() => {
                showSuccessMessage(getMessage('message_complete'));
            }, 1000);
        });

        // Video Ï¥àÍ∏∞Ìôî
        document.getElementById('video-clear').addEventListener('click', () => {
            videoFiles = [];
            processedVideos = [];
            document.getElementById('video-settings').style.display = 'none';
            document.getElementById('video-file-list').style.display = 'none';
            document.getElementById('video-stats').style.display = 'none';
            document.getElementById('video-buttons').style.display = 'none';
            document.getElementById('video-download').style.display = 'none';
            videoInput.value = '';
        });

        // ============= Ïú†Ìã∏Î¶¨Ìã∞ Ìï®Ïàò =============

        // ÌååÏùº ÌÅ¨Í∏∞ Ìè¨Îß∑
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
        }

        // ÌååÏùº Îã§Ïö¥Î°úÎìú
        function downloadFile(blob, filename) {
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // ÌéòÏù¥ÏßÄ Î°úÎìúÏãú Ï¥àÍ∏∞Ìôî
        window.addEventListener('load', () => {
            // Ïñ∏Ïñ¥ Ï¥àÍ∏∞Ìôî
            initLanguage();
            
            // Ï†ÄÏû•Îêú ÏÑ§Ï†ï Î∂àÎü¨Ïò§Í∏∞ Î∞è Ï†ÅÏö©
            settings.apply();
            
            console.log('OHOTORO HORIE Optimizer ready');
        });

        // ÏÑ§Ï†ï Î¶¨ÏÖã Î≤ÑÌäº
        document.getElementById('reset-settings').addEventListener('click', () => {
            if (confirm(getMessage('message_reset_confirm'))) {
                localStorage.removeItem('ohotoro-settings');
                showSuccessMessage(getMessage('message_initialized'));
                setTimeout(() => {
                    location.reload();
                }, 1500);
            }
        });
    </script>
</body>
</html>
