<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OHOTORO HORIE Optimizer</title>
    
    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@ffmpeg/ffmpeg@0.11.6/dist/ffmpeg.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@ffmpeg/core@0.11.0/dist/ffmpeg-core.js"></script>
    
    <style>
        /* Í∏∞Î≥∏ Î¶¨ÏÖã Î∞è Ìè∞Ìä∏ ÏÑ§Ï†ï */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Helvetica Neue', Arial, sans-serif;
            background: #f6f6f6;
            color: #111;
            line-height: 1.6;
            font-size: 13px;
            letter-spacing: 0.02em;
        }

        /* Î©îÏù∏ Ïª®ÌÖåÏù¥ÎÑà */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 60px 40px;
        }

        /* Ìó§Îçî */
        header {
            text-align: center;
            margin-bottom: 60px;
            position: relative;
        }

        h1 {
            font-size: 11px;
            font-weight: 400;
            letter-spacing: 0.3em;
            text-transform: uppercase;
            margin-bottom: 8px;
        }

        .subtitle {
            font-size: 10px;
            color: #666;
            letter-spacing: 0.15em;
        }

        /* Ïñ∏Ïñ¥ Ï†ÑÌôò Î≤ÑÌäº */
        .language-switch {
            position: absolute;
            top: 20px;
            left: 40px;
            display: flex;
            gap: 8px;
        }

        .lang-btn {
            padding: 6px 12px;
            background: none;
            border: 1px solid #e6e6e6;
            font-size: 10px;
            letter-spacing: 0.1em;
            cursor: pointer;
            color: #999;
            transition: all 0.3s ease;
        }

        .lang-btn:hover {
            border-color: #999;
            color: #111;
        }

        .lang-btn.active {
            background: #111;
            color: #fff;
            border-color: #111;
        }

        /* ÌÉ≠ ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò */
        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 50px;
            border-bottom: 1px solid #e6e6e6;
        }

        .tab {
            padding: 12px 40px;
            background: none;
            border: none;
            font-size: 11px;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            cursor: pointer;
            color: #999;
            transition: color 0.3s ease;
            position: relative;
        }

        .tab:hover {
            color: #111;
        }

        .tab.active {
            color: #111;
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            right: 0;
            height: 1px;
            background: #111;
        }

        /* ÌÉ≠ ÏΩòÌÖêÏ∏† */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* ÏóÖÎ°úÎìú ÏòÅÏó≠ */
        .upload-area {
            border: 1px dashed #e6e6e6;
            border-radius: 0;
            padding: 80px 40px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            background: #fff;
            margin-bottom: 40px;
        }

        .upload-area:hover {
            border-color: #999;
            background: #fafafa;
        }

        .upload-area.dragover {
            border-color: #111;
            background: #f5f5f5;
        }

        .upload-icon {
            font-size: 32px;
            margin-bottom: 16px;
            color: #999;
        }

        .upload-text {
            font-size: 11px;
            letter-spacing: 0.1em;
            color: #666;
            text-transform: uppercase;
            margin-bottom: 8px;
        }

        .upload-subtext {
            font-size: 10px;
            color: #999;
        }

        input[type="file"] {
            display: none;
        }

        /* ÌÅ¨Î°≠ ÏòÅÏó≠ */
        .crop-area {
            display: none;
            background: #fff;
            padding: 40px;
            margin-bottom: 30px;
            border: 1px solid #e6e6e6;
        }

        .crop-area.active {
            display: block;
        }

        .crop-container {
            position: relative;
            max-width: 100%;
            margin: 0 auto 30px;
            overflow: hidden;
            background: #000;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .crop-canvas {
            display: block;
            max-width: 100%;
            max-height: 600px;
        }

        .crop-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
        }

        .crop-box {
            position: absolute;
            border: 2px solid #fff;
            box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.5);
            cursor: move;
            pointer-events: auto;
        }

        .crop-handle {
            position: absolute;
            width: 12px;
            height: 12px;
            background: #fff;
            border: 2px solid #111;
            pointer-events: auto;
        }

        .crop-handle.nw { top: -6px; left: -6px; cursor: nw-resize; }
        .crop-handle.ne { top: -6px; right: -6px; cursor: ne-resize; }
        .crop-handle.sw { bottom: -6px; left: -6px; cursor: sw-resize; }
        .crop-handle.se { bottom: -6px; right: -6px; cursor: se-resize; }
        .crop-handle.n { top: -6px; left: 50%; margin-left: -6px; cursor: n-resize; }
        .crop-handle.s { bottom: -6px; left: 50%; margin-left: -6px; cursor: s-resize; }
        .crop-handle.w { top: 50%; left: -6px; margin-top: -6px; cursor: w-resize; }
        .crop-handle.e { top: 50%; right: -6px; margin-top: -6px; cursor: e-resize; }

        .crop-info {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: #fff;
            padding: 8px 12px;
            font-size: 10px;
            letter-spacing: 0.1em;
            pointer-events: none;
        }

        /* ÏÑ§Ï†ï Ìå®ÎÑê */
        .settings-panel {
            background: #fff;
            padding: 40px;
            margin-bottom: 30px;
            border: 1px solid #e6e6e6;
        }

        .settings-group {
            margin-bottom: 30px;
        }

        .settings-group:last-child {
            margin-bottom: 0;
        }

        .settings-label {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: #666;
            margin-bottom: 12px;
            display: block;
        }

        /* ÎùºÎîîÏò§ Î≤ÑÌäº Í∑∏Î£π */
        .radio-group {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .radio-option {
            position: relative;
            cursor: pointer;
            padding: 8px 16px;
            border: 1px solid #e6e6e6;
            font-size: 11px;
            transition: all 0.3s ease;
            background: #fff;
        }

        .radio-option:hover {
            border-color: #999;
        }

        .radio-option input {
            position: absolute;
            opacity: 0;
        }

        .radio-option.selected {
            background: #111;
            color: #fff;
            border-color: #111;
        }

        /* Ïª§Ïä§ÌÖÄ ÏûÖÎ†• */
        .custom-input {
            display: none;
            margin-top: 12px;
        }

        .custom-input.active {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .custom-input input {
            padding: 8px 12px;
            border: 1px solid #e6e6e6;
            font-size: 11px;
            width: 100px;
            background: #fff;
        }

        .custom-input input:focus {
            outline: none;
            border-color: #111;
        }

        /* Ï≤¥ÌÅ¨Î∞ïÏä§ */
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }

        .checkbox-group input[type="checkbox"] {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }

        /* Î≤ÑÌäº */
        .button-group {
            display: none;
            justify-content: center;
            gap: 16px;
            margin-top: 40px;
        }

        .button-group.active {
            display: flex;
        }

        .btn {
            padding: 12px 32px;
            border: 1px solid #111;
            background: #111;
            color: #fff;
            font-size: 11px;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn:hover {
            background: #333;
            border-color: #333;
        }

        .btn-secondary {
            background: #fff;
            color: #111;
        }

        .btn-secondary:hover {
            background: #f5f5f5;
        }

        /* ÌååÏùº Î¶¨Ïä§Ìä∏ */
        .file-list {
            display: none;
            margin-top: 30px;
        }

        .file-list.active {
            display: block;
        }

        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            background: #fff;
            border: 1px solid #e6e6e6;
            margin-bottom: 8px;
        }

        .file-info {
            flex: 1;
        }

        .file-name {
            font-size: 11px;
            margin-bottom: 4px;
        }

        .file-size {
            font-size: 10px;
            color: #999;
        }

        .file-status {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            padding: 4px 8px;
            background: #f5f5f5;
        }

        .file-status.processing {
            background: #fff3cd;
        }

        .file-status.complete {
            background: #d4edda;
        }

        .file-status.error {
            background: #f8d7da;
        }

        /* ÌÜµÍ≥Ñ */
        .stats {
            display: none;
            background: #fff;
            padding: 30px;
            margin-top: 30px;
            border: 1px solid #e6e6e6;
        }

        .stats.active {
            display: flex;
            justify-content: space-around;
            text-align: center;
        }

        .stat-item {
            flex: 1;
        }

        .stat-label {
            font-size: 10px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 16px;
            font-weight: 500;
        }

        /* Î°úÎî© */
        .loading {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .loading.active {
            display: flex;
        }

        .loading-content {
            text-align: center;
            color: #fff;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top-color: #fff;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 11px;
            letter-spacing: 0.15em;
            text-transform: uppercase;
        }

        /* ÏßÑÌñâÎ∞î */
        .progress-bar {
            display: none;
            width: 100%;
            height: 2px;
            background: #e6e6e6;
            margin-top: 30px;
            overflow: hidden;
        }

        .progress-bar.active {
            display: block;
        }

        .progress-fill {
            height: 100%;
            background: #111;
            transition: width 0.3s ease;
            width: 0;
        }

        /* ÏÑ±Í≥µ Î©îÏãúÏßÄ */
        .success-message {
            position: fixed;
            top: 40px;
            left: 50%;
            transform: translateX(-50%);
            background: #111;
            color: #fff;
            padding: 16px 32px;
            font-size: 11px;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1001;
        }

        .success-message.show {
            opacity: 1;
        }
    </style>
</head>
<body>
    <!-- ÏÑ±Í≥µ Î©îÏãúÏßÄ -->
    <div class="success-message" id="success-message"></div>

    <div class="container">
        <!-- Ìó§Îçî -->
        <header>
            <div class="language-switch">
                <button class="lang-btn active" data-lang="en">EN</button>
                <button class="lang-btn" data-lang="ko">KO</button>
            </div>
            <h1 data-i18n="title">OHOTORO HORIE</h1>
            <p class="subtitle" data-i18n="subtitle">Media Optimizer</p>
        </header>

        <!-- ÌÉ≠ ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò -->
        <div class="tabs">
            <button class="tab active" data-tab="image" data-i18n="tab_image">Image</button>
            <button class="tab" data-tab="video" data-i18n="tab_video">Video</button>
        </div>

        <!-- IMAGE TAB -->
        <div class="tab-content active" id="image-content">
            <!-- ÏóÖÎ°úÎìú ÏòÅÏó≠ -->
            <div class="upload-area" id="image-upload-area">
                <div class="upload-icon">üìÅ</div>
                <div class="upload-text" data-i18n="upload_image">Upload Images</div>
                <div class="upload-subtext" data-i18n="upload_image_sub">Drag & Drop or Click</div>
                <input type="file" id="image-input" accept="image/*" multiple>
            </div>

            <!-- ÌÅ¨Î°≠ ÏòÅÏó≠ -->
            <div class="crop-area" id="crop-area">
                <label class="settings-label" data-i18n="crop_title">Crop Images</label>
                
                <div class="settings-group">
                    <label class="settings-label" data-i18n="crop_ratio">Aspect Ratio</label>
                    <div class="radio-group">
                        <label class="radio-option selected">
                            <input type="radio" name="crop-ratio" value="5:7" checked>
                            <span>5:7</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="crop-ratio" value="1:1">
                            <span>1:1</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="crop-ratio" value="4:5">
                            <span>4:5</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="crop-ratio" value="16:9">
                            <span>16:9</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="crop-ratio" value="free">
                            <span data-i18n="ratio_free">Free</span>
                        </label>
                    </div>
                </div>

                <div class="crop-container">
                    <canvas id="crop-canvas" class="crop-canvas"></canvas>
                    <div class="crop-overlay">
                        <div class="crop-box" id="crop-box">
                            <div class="crop-handle nw"></div>
                            <div class="crop-handle ne"></div>
                            <div class="crop-handle sw"></div>
                            <div class="crop-handle se"></div>
                            <div class="crop-handle n"></div>
                            <div class="crop-handle s"></div>
                            <div class="crop-handle w"></div>
                            <div class="crop-handle e"></div>
                        </div>
                        <div class="crop-info" id="crop-info">1000 √ó 1400</div>
                    </div>
                </div>

                <div class="button-group active">
                    <button class="btn" id="apply-crop" data-i18n="apply_crop">Apply Crop</button>
                    <button class="btn btn-secondary" id="skip-crop" data-i18n="skip_crop">Skip Crop</button>
                </div>
            </div>

            <!-- ÏÑ§Ï†ï Ìå®ÎÑê -->
            <div class="settings-panel" id="image-settings" style="display: none;">
                <!-- ÌíàÏßà ÏÑ§Ï†ï -->
                <div class="settings-group">
                    <label class="settings-label" data-i18n="quality">Quality</label>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="quality" value="high">
                            <span data-i18n="quality_high">High</span>
                        </label>
                        <label class="radio-option selected">
                            <input type="radio" name="quality" value="medium" checked>
                            <span data-i18n="quality_medium">Medium</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="quality" value="low">
                            <span data-i18n="quality_low">Low</span>
                        </label>
                    </div>
                </div>

                <!-- Ìè¨Îß∑ ÏÑ§Ï†ï -->
                <div class="settings-group">
                    <label class="settings-label" data-i18n="format">Format</label>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="format" value="original">
                            <span data-i18n="format_original">Original</span>
                        </label>
                        <label class="radio-option selected">
                            <input type="radio" name="format" value="jpg" checked>
                            <span>JPG</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="format" value="png">
                            <span>PNG</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="format" value="webp">
                            <span>WebP</span>
                        </label>
                    </div>
                </div>

                <!-- Î¶¨ÏÇ¨Ïù¥Ï¶à ÏÑ§Ï†ï -->
                <div class="settings-group">
                    <label class="settings-label" data-i18n="resize">Resize</label>
                    <div class="radio-group">
                        <label class="radio-option selected">
                            <input type="radio" name="resize" value="none" checked>
                            <span data-i18n="resize_none">None</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="resize" value="1920">
                            <span>1920px</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="resize" value="1280">
                            <span>1280px</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="resize" value="custom">
                            <span data-i18n="resize_custom">Custom</span>
                        </label>
                    </div>
                    <div class="custom-input" id="custom-resize">
                        <input type="number" id="custom-width" placeholder="Width" min="1">
                        <span>√ó</span>
                        <input type="number" id="custom-height" placeholder="Height" min="1">
                    </div>
                </div>

                <!-- ÌååÏùºÎ™Ö ÏÑ§Ï†ï -->
                <div class="settings-group">
                    <label class="settings-label" data-i18n="filename">Filename</label>
                    <div class="radio-group">
                        <label class="radio-option selected">
                            <input type="radio" name="filename" value="original" checked>
                            <span data-i18n="filename_original">Keep Original</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="filename" value="timestamp">
                            <span data-i18n="filename_timestamp">Add Timestamp</span>
                        </label>
                    </div>
                </div>

                <!-- EXIF Îç∞Ïù¥ÌÑ∞ -->
                <div class="settings-group">
                    <label class="checkbox-group">
                        <input type="checkbox" id="remove-exif">
                        <span data-i18n="remove_exif">Remove EXIF data</span>
                    </label>
                </div>
            </div>

            <!-- ÌååÏùº Î¶¨Ïä§Ìä∏ -->
            <div class="file-list" id="image-file-list"></div>

            <!-- ÏßÑÌñâÎ∞î -->
            <div class="progress-bar" id="image-progress">
                <div class="progress-fill"></div>
            </div>

            <!-- ÌÜµÍ≥Ñ -->
            <div class="stats" id="image-stats">
                <div class="stat-item">
                    <div class="stat-label" data-i18n="stat_files">Files</div>
                    <div class="stat-value" id="total-files">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label" data-i18n="stat_original">Original</div>
                    <div class="stat-value" id="original-size">0 MB</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label" data-i18n="stat_compressed">Compressed</div>
                    <div class="stat-value" id="compressed-size">0 MB</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label" data-i18n="stat_saved">Saved</div>
                    <div class="stat-value" id="saved">0%</div>
                </div>
            </div>

            <!-- Î≤ÑÌäº -->
            <div class="button-group" id="image-buttons">
                <button class="btn" id="process" data-i18n="btn_process">Process</button>
                <button class="btn btn-secondary" id="clear" data-i18n="btn_clear">Clear</button>
            </div>

            <div class="button-group">
                <button class="btn" id="download" style="display: none;" data-i18n="btn_download">Download</button>
            </div>
        </div>

        <!-- VIDEO TAB -->
        <div class="tab-content" id="video-content">
            <!-- ÏóÖÎ°úÎìú ÏòÅÏó≠ -->
            <div class="upload-area" id="video-upload-area">
                <div class="upload-icon">üé¨</div>
                <div class="upload-text" data-i18n="upload_video">Upload Videos</div>
                <div class="upload-subtext" data-i18n="upload_video_sub">Drag & Drop or Click</div>
                <input type="file" id="video-input" accept="video/*" multiple>
            </div>

            <!-- ÏÑ§Ï†ï Ìå®ÎÑê -->
            <div class="settings-panel" id="video-settings" style="display: none;">
                <!-- ÌíàÏßà ÏÑ§Ï†ï -->
                <div class="settings-group">
                    <label class="settings-label" data-i18n="quality">Quality</label>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="video-quality" value="high">
                            <span data-i18n="quality_high">High</span>
                        </label>
                        <label class="radio-option selected">
                            <input type="radio" name="video-quality" value="medium" checked>
                            <span data-i18n="quality_medium">Medium</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="video-quality" value="low">
                            <span data-i18n="quality_low">Low</span>
                        </label>
                    </div>
                </div>

                <!-- Ìï¥ÏÉÅÎèÑ ÏÑ§Ï†ï -->
                <div class="settings-group">
                    <label class="settings-label" data-i18n="resolution">Resolution</label>
                    <div class="radio-group">
                        <label class="radio-option selected">
                            <input type="radio" name="video-resolution" value="original" checked>
                            <span data-i18n="format_original">Original</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="video-resolution" value="1080">
                            <span>1080p</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="video-resolution" value="720">
                            <span>720p</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="video-resolution" value="480">
                            <span>480p</span>
                        </label>
                    </div>
                </div>

                <!-- Ïò§ÎîîÏò§ Ï†úÍ±∞ -->
                <div class="settings-group">
                    <label class="checkbox-group">
                        <input type="checkbox" id="remove-audio">
                        <span data-i18n="remove_audio">Remove Audio</span>
                    </label>
                </div>
            </div>

            <!-- ÌååÏùº Î¶¨Ïä§Ìä∏ -->
            <div class="file-list" id="video-file-list"></div>

            <!-- ÏßÑÌñâÎ∞î -->
            <div class="progress-bar" id="video-progress">
                <div class="progress-fill"></div>
            </div>

            <!-- ÌÜµÍ≥Ñ -->
            <div class="stats" id="video-stats">
                <div class="stat-item">
                    <div class="stat-label" data-i18n="stat_files">Files</div>
                    <div class="stat-value" id="video-total-files">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label" data-i18n="stat_original">Original</div>
                    <div class="stat-value" id="video-original-size">0 MB</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label" data-i18n="stat_compressed">Compressed</div>
                    <div class="stat-value" id="video-compressed-size">0 MB</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label" data-i18n="stat_saved">Saved</div>
                    <div class="stat-value" id="video-saved">0%</div>
                </div>
            </div>

            <!-- Î≤ÑÌäº -->
            <div class="button-group" id="video-buttons">
                <button class="btn" id="video-process" data-i18n="btn_process">Process</button>
                <button class="btn btn-secondary" id="video-clear" data-i18n="btn_clear">Clear</button>
            </div>

            <div class="button-group">
                <button class="btn" id="video-download" style="display: none;" data-i18n="btn_download">Download</button>
            </div>
        </div>
    </div>

    <!-- Î°úÎî© -->
    <div class="loading" id="loading">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <div class="loading-text" data-i18n="loading">Processing...</div>
        </div>
    </div>

    <div class="loading" id="video-loading">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <div class="loading-text" data-i18n="loading">Processing...</div>
        </div>
    </div>

    <script>
        // ============= Îã§Íµ≠Ïñ¥ ÏßÄÏõê =============
        const translations = {
            en: {
                title: 'OHOTORO HORIE',
                subtitle: 'Media Optimizer',
                tab_image: 'Image',
                tab_video: 'Video',
                upload_image: 'Upload Images',
                upload_image_sub: 'Drag & Drop or Click',
                upload_video: 'Upload Videos',
                upload_video_sub: 'Drag & Drop or Click',
                crop_title: 'Crop Images',
                crop_ratio: 'Aspect Ratio',
                ratio_free: 'Free',
                apply_crop: 'Apply Crop',
                skip_crop: 'Skip Crop',
                quality: 'Quality',
                quality_high: 'High',
                quality_medium: 'Medium',
                quality_low: 'Low',
                format: 'Format',
                format_original: 'Original',
                resize: 'Resize',
                resize_none: 'None',
                resize_custom: 'Custom',
                filename: 'Filename',
                filename_original: 'Keep Original',
                filename_timestamp: 'Add Timestamp',
                remove_exif: 'Remove EXIF data',
                resolution: 'Resolution',
                remove_audio: 'Remove Audio',
                btn_process: 'Process',
                btn_clear: 'Clear',
                btn_download: 'Download',
                stat_files: 'Files',
                stat_original: 'Original',
                stat_compressed: 'Compressed',
                stat_saved: 'Saved',
                loading: 'Processing...',
                status_waiting: 'Waiting',
                status_processing: 'Processing',
                status_complete: 'Complete',
                status_error: 'Error',
                message_compressed: ' images compressed',
                message_complete: 'Download complete',
                message_preparing: 'Preparing download...',
                message_ready: 'FFmpeg is still loading. Please wait.',
                message_compressed_video: ' videos compressed'
            },
            ko: {
                title: 'OHOTORO HORIE',
                subtitle: 'ÎØ∏ÎîîÏñ¥ ÏµúÏ†ÅÌôî',
                tab_image: 'Ïù¥ÎØ∏ÏßÄ',
                tab_video: 'ÎπÑÎîîÏò§',
                upload_image: 'Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú',
                upload_image_sub: 'ÎìúÎûòÍ∑∏ & ÎìúÎ°≠ ÎòêÎäî ÌÅ¥Î¶≠',
                upload_video: 'ÎπÑÎîîÏò§ ÏóÖÎ°úÎìú',
                upload_video_sub: 'ÎìúÎûòÍ∑∏ & ÎìúÎ°≠ ÎòêÎäî ÌÅ¥Î¶≠',
                crop_title: 'Ïù¥ÎØ∏ÏßÄ ÌÅ¨Î°≠',
                crop_ratio: 'ÎπÑÏú®',
                ratio_free: 'ÏûêÏú†',
                apply_crop: 'ÌÅ¨Î°≠ Ï†ÅÏö©',
                skip_crop: 'ÌÅ¨Î°≠ Í±¥ÎÑàÎõ∞Í∏∞',
                quality: 'ÌíàÏßà',
                quality_high: 'ÎÜíÏùå',
                quality_medium: 'Ï§ëÍ∞Ñ',
                quality_low: 'ÎÇÆÏùå',
                format: 'Ìè¨Îß∑',
                format_original: 'ÏõêÎ≥∏ Ïú†ÏßÄ',
                resize: 'Î¶¨ÏÇ¨Ïù¥Ï¶à',
                resize_none: 'ÏóÜÏùå',
                resize_custom: 'ÏßÅÏ†ë ÏûÖÎ†•',
                filename: 'ÌååÏùºÎ™Ö',
                filename_original: 'ÏõêÎ≥∏ Ïú†ÏßÄ',
                filename_timestamp: 'ÌÉÄÏûÑÏä§ÌÉ¨ÌîÑ Ï∂îÍ∞Ä',
                remove_exif: 'EXIF Îç∞Ïù¥ÌÑ∞ Ï†úÍ±∞',
                resolution: 'Ìï¥ÏÉÅÎèÑ',
                remove_audio: 'Ïò§ÎîîÏò§ Ï†úÍ±∞',
                btn_process: 'Ï≤òÎ¶¨',
                btn_clear: 'Ï¥àÍ∏∞Ìôî',
                btn_download: 'Îã§Ïö¥Î°úÎìú',
                stat_files: 'ÌååÏùº',
                stat_original: 'ÏõêÎ≥∏',
                stat_compressed: 'ÏïïÏ∂ï',
                stat_saved: 'Ï†àÏïΩ',
                loading: 'Ï≤òÎ¶¨ Ï§ë...',
                status_waiting: 'ÎåÄÍ∏∞',
                status_processing: 'Ï≤òÎ¶¨ Ï§ë',
                status_complete: 'ÏôÑÎ£å',
                status_error: 'Ïò§Î•ò',
                message_compressed: 'Í∞ú Ïù¥ÎØ∏ÏßÄ ÏïïÏ∂ï ÏôÑÎ£å',
                message_complete: 'Îã§Ïö¥Î°úÎìú ÏôÑÎ£å',
                message_preparing: 'Îã§Ïö¥Î°úÎìú Ï§ÄÎπÑ Ï§ë...',
                message_ready: 'FFmpegÍ∞Ä Î°úÎî© Ï§ëÏûÖÎãàÎã§. Ïû†ÏãúÎßå Í∏∞Îã§Î†§Ï£ºÏÑ∏Ïöî.',
                message_compressed_video: 'Í∞ú ÎπÑÎîîÏò§ ÏïïÏ∂ï ÏôÑÎ£å'
            }
        };

        let currentLang = 'en';

        function getMessage(key) {
            return translations[currentLang][key] || key;
        }

        function updateLanguage() {
            document.querySelectorAll('[data-i18n]').forEach(element => {
                const key = element.getAttribute('data-i18n');
                element.textContent = getMessage(key);
            });
        }

        function initLanguage() {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentLang = btn.dataset.lang;
                    updateLanguage();
                });
            });
        }

        // ============= ÌÉ≠ Ï†ÑÌôò =============
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                const tabName = tab.dataset.tab;
                
                // ÌÉ≠ ÌôúÏÑ±Ìôî
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                // ÏΩòÌÖêÏ∏† ÌëúÏãú
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById(tabName + '-content').classList.add('active');
            });
        });

        // ============= ÎùºÎîîÏò§ Î≤ÑÌäº =============
        document.querySelectorAll('.radio-option').forEach(option => {
            option.addEventListener('click', () => {
                const radio = option.querySelector('input[type="radio"]');
                const group = radio.name;
                
                document.querySelectorAll(`input[name="${group}"]`).forEach(r => {
                    r.closest('.radio-option').classList.remove('selected');
                });
                
                radio.checked = true;
                option.classList.add('selected');
                
                // Ïª§Ïä§ÌÖÄ Î¶¨ÏÇ¨Ïù¥Ï¶à
                if (group === 'resize') {
                    const customInput = document.getElementById('custom-resize');
                    if (radio.value === 'custom') {
                        customInput.classList.add('active');
                    } else {
                        customInput.classList.remove('active');
                    }
                }

                // ÌÅ¨Î°≠ ÎπÑÏú® Î≥ÄÍ≤Ω
                if (group === 'crop-ratio' && currentImage) {
                    updateCropRatio(radio.value);
                }
            });
        });

        // ============= ÏÑ±Í≥µ Î©îÏãúÏßÄ =============
        function showSuccessMessage(message) {
            const successMsg = document.getElementById('success-message');
            successMsg.textContent = message;
            successMsg.classList.add('show');
            setTimeout(() => {
                successMsg.classList.remove('show');
            }, 3000);
        }

        // ============= IMAGE Ï≤òÎ¶¨ =============
        let imageFiles = [];
        let croppedImages = [];
        let processedImages = [];
        let currentImage = null;
        let currentImageIndex = 0;

        // ÌÅ¨Î°≠ Í¥ÄÎ†® Î≥ÄÏàò
        let cropBox = null;
        let isDragging = false;
        let isResizing = false;
        let resizeHandle = null;
        let startX, startY;
        let cropData = { x: 0, y: 0, width: 0, height: 0 };

        const imageInput = document.getElementById('image-input');
        const imageUploadArea = document.getElementById('image-upload-area');
        const cropCanvas = document.getElementById('crop-canvas');
        const ctx = cropCanvas.getContext('2d');

        // ÏóÖÎ°úÎìú ÏòÅÏó≠ ÌÅ¥Î¶≠
        imageUploadArea.addEventListener('click', () => imageInput.click());

        // ÎìúÎûòÍ∑∏ Ïï§ ÎìúÎ°≠
        imageUploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            imageUploadArea.classList.add('dragover');
        });

        imageUploadArea.addEventListener('dragleave', () => {
            imageUploadArea.classList.remove('dragover');
        });

        imageUploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            imageUploadArea.classList.remove('dragover');
            const files = Array.from(e.dataTransfer.files).filter(f => f.type.startsWith('image/'));
            handleImageFiles(files);
        });

        // ÌååÏùº ÏÑ†ÌÉù
        imageInput.addEventListener('change', (e) => {
            handleImageFiles(Array.from(e.target.files));
        });

        // ÌååÏùº Ï≤òÎ¶¨
        function handleImageFiles(files) {
            if (files.length === 0) return;
            
            imageFiles = files;
            currentImageIndex = 0;
            croppedImages = [];
            
            // Ï≤´ Ïù¥ÎØ∏ÏßÄ ÌÅ¨Î°≠ ÏãúÏûë
            loadImageForCrop(0);
        }

        // Ïù¥ÎØ∏ÏßÄ Î°úÎìú Î∞è ÌÅ¨Î°≠ UI ÌëúÏãú
        function loadImageForCrop(index) {
            if (index >= imageFiles.length) {
                // Î™®Îì† Ïù¥ÎØ∏ÏßÄ ÌÅ¨Î°≠ ÏôÑÎ£å
                finishCropping();
                return;
            }

            currentImageIndex = index;
            const file = imageFiles[index];
            
            const reader = new FileReader();
            reader.onload = (e) => {
                const img = new Image();
                img.onload = () => {
                    currentImage = img;
                    setupCropArea(img);
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        // ÌÅ¨Î°≠ ÏòÅÏó≠ ÏÑ§Ï†ï
        function setupCropArea(img) {
            const cropArea = document.getElementById('crop-area');
            cropArea.classList.add('active');
            
            // Canvas ÌÅ¨Í∏∞ ÏÑ§Ï†ï
            const maxWidth = 800;
            const maxHeight = 600;
            let width = img.width;
            let height = img.height;
            
            if (width > maxWidth || height > maxHeight) {
                const ratio = Math.min(maxWidth / width, maxHeight / height);
                width = width * ratio;
                height = height * ratio;
            }
            
            cropCanvas.width = width;
            cropCanvas.height = height;
            
            // Ïù¥ÎØ∏ÏßÄ Í∑∏Î¶¨Í∏∞
            ctx.clearRect(0, 0, width, height);
            ctx.drawImage(img, 0, 0, width, height);
            
            // ÌÅ¨Î°≠ Î∞ïÏä§ Ï¥àÍ∏∞Ìôî
            initCropBox();
        }

        // ÌÅ¨Î°≠ Î∞ïÏä§ Ï¥àÍ∏∞Ìôî
        function initCropBox() {
            cropBox = document.getElementById('crop-box');
            const ratio = document.querySelector('input[name="crop-ratio"]:checked').value;
            
            const canvasWidth = cropCanvas.width;
            const canvasHeight = cropCanvas.height;
            
            let width, height;
            
            if (ratio === 'free') {
                width = canvasWidth * 0.8;
                height = canvasHeight * 0.8;
            } else {
                const [w, h] = ratio.split(':').map(Number);
                const aspectRatio = w / h;
                
                if (canvasWidth / canvasHeight > aspectRatio) {
                    height = canvasHeight * 0.8;
                    width = height * aspectRatio;
                } else {
                    width = canvasWidth * 0.8;
                    height = width / aspectRatio;
                }
            }
            
            cropData = {
                x: (canvasWidth - width) / 2,
                y: (canvasHeight - height) / 2,
                width: width,
                height: height
            };
            
            updateCropBox();
            setupCropHandlers();
        }

        // ÌÅ¨Î°≠ Î∞ïÏä§ ÏóÖÎç∞Ïù¥Ìä∏
        function updateCropBox() {
            cropBox.style.left = cropData.x + 'px';
            cropBox.style.top = cropData.y + 'px';
            cropBox.style.width = cropData.width + 'px';
            cropBox.style.height = cropData.height + 'px';
            
            // ÌÅ¨Í∏∞ Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
            const scaleX = currentImage.width / cropCanvas.width;
            const scaleY = currentImage.height / cropCanvas.height;
            const actualWidth = Math.round(cropData.width * scaleX);
            const actualHeight = Math.round(cropData.height * scaleY);
            
            document.getElementById('crop-info').textContent = `${actualWidth} √ó ${actualHeight}`;
        }

        // ÌÅ¨Î°≠ ÎπÑÏú® Î≥ÄÍ≤Ω
        function updateCropRatio(ratio) {
            if (ratio === 'free') {
                // ÌòÑÏû¨ ÌÅ¨Í∏∞ Ïú†ÏßÄ
                updateCropBox();
                return;
            }
            
            const [w, h] = ratio.split(':').map(Number);
            const aspectRatio = w / h;
            
            // ÌòÑÏû¨ ÌÅ¨Î°≠ Î∞ïÏä§Ïùò Ï§ëÏã¨ÏùÑ Ïú†ÏßÄÌïòÎ©¥ÏÑú ÎπÑÏú® Ï°∞Ï†ï
            const centerX = cropData.x + cropData.width / 2;
            const centerY = cropData.y + cropData.height / 2;
            
            let newWidth = cropData.width;
            let newHeight = newWidth / aspectRatio;
            
            // Canvas ÌÅ¨Í∏∞Î•º Î≤óÏñ¥ÎÇòÏßÄ ÏïäÎèÑÎ°ù Ï°∞Ï†ï
            if (newHeight > cropCanvas.height * 0.9) {
                newHeight = cropCanvas.height * 0.9;
                newWidth = newHeight * aspectRatio;
            }
            
            if (newWidth > cropCanvas.width * 0.9) {
                newWidth = cropCanvas.width * 0.9;
                newHeight = newWidth / aspectRatio;
            }
            
            cropData.width = newWidth;
            cropData.height = newHeight;
            cropData.x = centerX - newWidth / 2;
            cropData.y = centerY - newHeight / 2;
            
            // Í≤ΩÍ≥Ñ Ï≤¥ÌÅ¨
            cropData.x = Math.max(0, Math.min(cropData.x, cropCanvas.width - cropData.width));
            cropData.y = Math.max(0, Math.min(cropData.y, cropCanvas.height - cropData.height));
            
            updateCropBox();
        }

        // ÌÅ¨Î°≠ Ìï∏Îì§Îü¨ ÏÑ§Ï†ï
        function setupCropHandlers() {
            // ÎìúÎûòÍ∑∏
            cropBox.addEventListener('mousedown', (e) => {
                if (e.target.classList.contains('crop-handle')) {
                    isResizing = true;
                    resizeHandle = e.target.className.split(' ')[1];
                } else {
                    isDragging = true;
                }
                startX = e.clientX;
                startY = e.clientY;
                e.preventDefault();
            });

            document.addEventListener('mousemove', (e) => {
                if (!isDragging && !isResizing) return;
                
                const deltaX = e.clientX - startX;
                const deltaY = e.clientY - startY;
                
                if (isDragging) {
                    cropData.x += deltaX;
                    cropData.y += deltaY;
                    
                    // Í≤ΩÍ≥Ñ Ï≤¥ÌÅ¨
                    cropData.x = Math.max(0, Math.min(cropData.x, cropCanvas.width - cropData.width));
                    cropData.y = Math.max(0, Math.min(cropData.y, cropCanvas.height - cropData.height));
                } else if (isResizing) {
                    const ratio = document.querySelector('input[name="crop-ratio"]:checked').value;
                    const isFixedRatio = ratio !== 'free';
                    
                    handleResize(deltaX, deltaY, resizeHandle, isFixedRatio);
                }
                
                startX = e.clientX;
                startY = e.clientY;
                updateCropBox();
            });

            document.addEventListener('mouseup', () => {
                isDragging = false;
                isResizing = false;
                resizeHandle = null;
            });
        }

        // Î¶¨ÏÇ¨Ïù¥Ï¶à Ï≤òÎ¶¨
        function handleResize(deltaX, deltaY, handle, isFixedRatio) {
            const ratio = document.querySelector('input[name="crop-ratio"]:checked').value;
            let aspectRatio = 1;
            
            if (isFixedRatio) {
                const [w, h] = ratio.split(':').map(Number);
                aspectRatio = w / h;
            }
            
            const minSize = 50;
            
            switch (handle) {
                case 'se':
                    if (isFixedRatio) {
                        const newWidth = cropData.width + deltaX;
                        cropData.width = Math.max(minSize, Math.min(newWidth, cropCanvas.width - cropData.x));
                        cropData.height = cropData.width / aspectRatio;
                        
                        if (cropData.y + cropData.height > cropCanvas.height) {
                            cropData.height = cropCanvas.height - cropData.y;
                            cropData.width = cropData.height * aspectRatio;
                        }
                    } else {
                        cropData.width = Math.max(minSize, Math.min(cropData.width + deltaX, cropCanvas.width - cropData.x));
                        cropData.height = Math.max(minSize, Math.min(cropData.height + deltaY, cropCanvas.height - cropData.y));
                    }
                    break;
                    
                case 'sw':
                    if (isFixedRatio) {
                        const newWidth = cropData.width - deltaX;
                        if (newWidth >= minSize && cropData.x + deltaX >= 0) {
                            cropData.x += deltaX;
                            cropData.width = newWidth;
                            cropData.height = cropData.width / aspectRatio;
                            
                            if (cropData.y + cropData.height > cropCanvas.height) {
                                cropData.height = cropCanvas.height - cropData.y;
                                cropData.width = cropData.height * aspectRatio;
                            }
                        }
                    } else {
                        if (cropData.width - deltaX >= minSize && cropData.x + deltaX >= 0) {
                            cropData.x += deltaX;
                            cropData.width -= deltaX;
                        }
                        cropData.height = Math.max(minSize, Math.min(cropData.height + deltaY, cropCanvas.height - cropData.y));
                    }
                    break;
                    
                case 'ne':
                    if (isFixedRatio) {
                        const newWidth = cropData.width + deltaX;
                        const newHeight = newWidth / aspectRatio;
                        
                        if (newWidth >= minSize && newWidth <= cropCanvas.width - cropData.x && newHeight >= minSize) {
                            cropData.width = newWidth;
                            cropData.height = newHeight;
                            cropData.y += deltaY;
                            
                            if (cropData.y < 0) {
                                cropData.y = 0;
                                cropData.height = cropData.height;
                                cropData.width = cropData.height * aspectRatio;
                            }
                        }
                    } else {
                        cropData.width = Math.max(minSize, Math.min(cropData.width + deltaX, cropCanvas.width - cropData.x));
                        if (cropData.height - deltaY >= minSize && cropData.y + deltaY >= 0) {
                            cropData.y += deltaY;
                            cropData.height -= deltaY;
                        }
                    }
                    break;
                    
                case 'nw':
                    if (isFixedRatio) {
                        const newWidth = cropData.width - deltaX;
                        const newHeight = newWidth / aspectRatio;
                        
                        if (newWidth >= minSize && cropData.x + deltaX >= 0 && newHeight >= minSize) {
                            cropData.x += deltaX;
                            cropData.width = newWidth;
                            cropData.height = newHeight;
                            cropData.y += deltaY;
                            
                            if (cropData.y < 0) {
                                cropData.y = 0;
                            }
                        }
                    } else {
                        if (cropData.width - deltaX >= minSize && cropData.x + deltaX >= 0) {
                            cropData.x += deltaX;
                            cropData.width -= deltaX;
                        }
                        if (cropData.height - deltaY >= minSize && cropData.y + deltaY >= 0) {
                            cropData.y += deltaY;
                            cropData.height -= deltaY;
                        }
                    }
                    break;
                    
                case 'n':
                    if (!isFixedRatio) {
                        if (cropData.height - deltaY >= minSize && cropData.y + deltaY >= 0) {
                            cropData.y += deltaY;
                            cropData.height -= deltaY;
                        }
                    }
                    break;
                    
                case 's':
                    if (!isFixedRatio) {
                        cropData.height = Math.max(minSize, Math.min(cropData.height + deltaY, cropCanvas.height - cropData.y));
                    }
                    break;
                    
                case 'w':
                    if (!isFixedRatio) {
                        if (cropData.width - deltaX >= minSize && cropData.x + deltaX >= 0) {
                            cropData.x += deltaX;
                            cropData.width -= deltaX;
                        }
                    }
                    break;
                    
                case 'e':
                    if (!isFixedRatio) {
                        cropData.width = Math.max(minSize, Math.min(cropData.width + deltaX, cropCanvas.width - cropData.x));
                    }
                    break;
            }
        }

        // ÌÅ¨Î°≠ Ï†ÅÏö©
        document.getElementById('apply-crop').addEventListener('click', () => {
            const scaleX = currentImage.width / cropCanvas.width;
            const scaleY = currentImage.height / cropCanvas.height;
            
            const cropInfo = {
                x: Math.round(cropData.x * scaleX),
                y: Math.round(cropData.y * scaleY),
                width: Math.round(cropData.width * scaleX),
                height: Math.round(cropData.height * scaleY)
            };
            
            croppedImages.push({
                image: currentImage,
                crop: cropInfo,
                file: imageFiles[currentImageIndex]
            });
            
            // Îã§Ïùå Ïù¥ÎØ∏ÏßÄ
            loadImageForCrop(currentImageIndex + 1);
        });

        // ÌÅ¨Î°≠ Í±¥ÎÑàÎõ∞Í∏∞
        document.getElementById('skip-crop').addEventListener('click', () => {
            croppedImages.push({
                image: currentImage,
                crop: null,
                file: imageFiles[currentImageIndex]
            });
            
            // Îã§Ïùå Ïù¥ÎØ∏ÏßÄ
            loadImageForCrop(currentImageIndex + 1);
        });

        // ÌÅ¨Î°≠ ÏôÑÎ£å
        function finishCropping() {
            document.getElementById('crop-area').classList.remove('active');
            document.getElementById('image-settings').style.display = 'block';
            document.getElementById('image-file-list').style.display = 'block';
            document.getElementById('image-buttons').style.display = 'flex';
            
            displayImageFiles();
        }

        // ÌååÏùº Î¶¨Ïä§Ìä∏ ÌëúÏãú
        function displayImageFiles() {
            const fileList = document.getElementById('image-file-list');
            fileList.innerHTML = '';
            fileList.classList.add('active');
            
            croppedImages.forEach((item, index) => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.innerHTML = `
                    <div class="file-info">
                        <div class="file-name">${item.file.name}</div>
                        <div class="file-size">${formatFileSize(item.file.size)}</div>
                    </div>
                    <div class="file-status" id="status-${index}">${getMessage('status_waiting')}</div>
                `;
                fileList.appendChild(fileItem);
            });
        }

        // Ïù¥ÎØ∏ÏßÄ Ï≤òÎ¶¨
        document.getElementById('process').addEventListener('click', async () => {
            const quality = document.querySelector('input[name="quality"]:checked').value;
            const format = document.querySelector('input[name="format"]:checked').value;
            const resize = document.querySelector('input[name="resize"]:checked').value;
            const filename = document.querySelector('input[name="filename"]:checked').value;
            const removeExif = document.getElementById('remove-exif').checked;
            
            const loading = document.getElementById('loading');
            const progressBar = document.getElementById('image-progress');
            progressBar.classList.add('active');
            
            processedImages = [];
            let totalOriginalSize = 0;
            let totalCompressedSize = 0;

            for (let i = 0; i < croppedImages.length; i++) {
                const item = croppedImages[i];
                const statusElement = document.getElementById(`status-${i}`);
                statusElement.textContent = getMessage('status_processing');
                statusElement.className = 'file-status processing';
                
                loading.classList.add('active');

                try {
                    const processed = await processImage(item, quality, format, resize, filename, removeExif);
                    processedImages.push(processed);
                    
                    totalOriginalSize += item.file.size;
                    totalCompressedSize += processed.blob.size;
                    
                    statusElement.textContent = getMessage('status_complete');
                    statusElement.className = 'file-status complete';
                } catch (error) {
                    console.error('Error processing image:', error);
                    statusElement.textContent = getMessage('status_error');
                    statusElement.className = 'file-status error';
                }

                const progress = ((i + 1) / croppedImages.length) * 100;
                progressBar.querySelector('.progress-fill').style.width = progress + '%';
            }

            loading.classList.remove('active');
            
            displayStats(totalOriginalSize, totalCompressedSize);
            showSuccessMessage(`${croppedImages.length}${getMessage('message_compressed')}`);
            
            document.getElementById('download').style.display = 'inline-block';
            progressBar.classList.remove('active');
        });

        // Ïù¥ÎØ∏ÏßÄ Ï≤òÎ¶¨ Ìï®Ïàò
        async function processImage(item, quality, format, resize, filename, removeExif) {
            return new Promise((resolve) => {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                // ÌÅ¨Î°≠ Ï†ÅÏö©
                let sourceX = 0, sourceY = 0, sourceWidth = item.image.width, sourceHeight = item.image.height;
                
                if (item.crop) {
                    sourceX = item.crop.x;
                    sourceY = item.crop.y;
                    sourceWidth = item.crop.width;
                    sourceHeight = item.crop.height;
                }
                
                // Î¶¨ÏÇ¨Ïù¥Ï¶à Ï†ÅÏö©
                let targetWidth = sourceWidth;
                let targetHeight = sourceHeight;
                
                if (resize === 'custom') {
                    const customWidth = parseInt(document.getElementById('custom-width').value) || sourceWidth;
                    const customHeight = parseInt(document.getElementById('custom-height').value) || sourceHeight;
                    targetWidth = customWidth;
                    targetHeight = customHeight;
                } else if (resize !== 'none') {
                    const maxSize = parseInt(resize);
                    const ratio = Math.min(maxSize / sourceWidth, maxSize / sourceHeight);
                    if (ratio < 1) {
                        targetWidth = Math.round(sourceWidth * ratio);
                        targetHeight = Math.round(sourceHeight * ratio);
                    }
                }
                
                canvas.width = targetWidth;
                canvas.height = targetHeight;
                
                // Ïù¥ÎØ∏ÏßÄ Í∑∏Î¶¨Í∏∞
                ctx.drawImage(
                    item.image,
                    sourceX, sourceY, sourceWidth, sourceHeight,
                    0, 0, targetWidth, targetHeight
                );
                
                // Ìè¨Îß∑ Í≤∞Ï†ï
                let mimeType = 'image/jpeg';
                let ext = 'jpg';
                
                if (format === 'original') {
                    const originalType = item.file.type;
                    if (originalType === 'image/png') {
                        mimeType = 'image/png';
                        ext = 'png';
                    } else if (originalType === 'image/webp') {
                        mimeType = 'image/webp';
                        ext = 'webp';
                    }
                } else {
                    if (format === 'png') {
                        mimeType = 'image/png';
                        ext = 'png';
                    } else if (format === 'webp') {
                        mimeType = 'image/webp';
                        ext = 'webp';
                    }
                }
                
                // ÌíàÏßà ÏÑ§Ï†ï
                let qualityValue = 0.85;
                if (quality === 'high') qualityValue = 0.95;
                else if (quality === 'low') qualityValue = 0.7;
                
                canvas.toBlob((blob) => {
                    // ÌååÏùºÎ™Ö ÏÉùÏÑ±
                    let baseName = item.file.name.substring(0, item.file.name.lastIndexOf('.')) || item.file.name;
                    
                    if (filename === 'timestamp') {
                        const timestamp = new Date().getTime();
                        baseName += `_${timestamp}`;
                    }
                    
                    const fileName = `${baseName}.${ext}`;
                    
                    resolve({
                        blob: blob,
                        name: fileName
                    });
                }, mimeType, qualityValue);
            });
        }

        // ÌÜµÍ≥Ñ ÌëúÏãú
        function displayStats(originalSize, compressedSize) {
            const stats = document.getElementById('image-stats');
            stats.classList.add('active');
            
            document.getElementById('total-files').textContent = croppedImages.length;
            document.getElementById('original-size').textContent = formatFileSize(originalSize);
            document.getElementById('compressed-size').textContent = formatFileSize(compressedSize);
            
            const savedPercentage = Math.round((1 - compressedSize / originalSize) * 100);
            document.getElementById('saved').textContent = savedPercentage + '%';
        }

        // Îã§Ïö¥Î°úÎìú
        document.getElementById('download').addEventListener('click', async () => {
            if (processedImages.length === 0) return;
            
            showSuccessMessage(getMessage('message_preparing'));
            
            if (processedImages.length === 1) {
                downloadFile(processedImages[0].blob, processedImages[0].name);
            } else {
                const zip = new JSZip();
                processedImages.forEach(img => {
                    zip.file(img.name, img.blob);
                });
                
                const zipBlob = await zip.generateAsync({type: 'blob'});
                downloadFile(zipBlob, 'images.zip');
            }
            
            setTimeout(() => {
                showSuccessMessage(getMessage('message_complete'));
            }, 1000);
        });

        // Ï¥àÍ∏∞Ìôî
        document.getElementById('clear').addEventListener('click', () => {
            imageFiles = [];
            croppedImages = [];
            processedImages = [];
            currentImage = null;
            document.getElementById('crop-area').classList.remove('active');
            document.getElementById('image-settings').style.display = 'none';
            document.getElementById('image-file-list').style.display = 'none';
            document.getElementById('image-stats').classList.remove('active');
            document.getElementById('image-buttons').style.display = 'none';
            document.getElementById('download').style.display = 'none';
            imageInput.value = '';
        });

        // ============= VIDEO Ï≤òÎ¶¨ =============
        let videoFiles = [];
        let processedVideos = [];
        let ffmpegLoaded = false;
        let ffmpeg;

        const videoInput = document.getElementById('video-input');
        const videoUploadArea = document.getElementById('video-upload-area');

        // FFmpeg Ï¥àÍ∏∞Ìôî
        async function loadFFmpeg() {
            if (ffmpegLoaded) return;
            
            try {
                const { createFFmpeg } = FFmpeg;
                ffmpeg = createFFmpeg({ log: false });
                await ffmpeg.load();
                ffmpegLoaded = true;
                console.log('FFmpeg loaded');
            } catch (error) {
                console.error('Failed to load FFmpeg:', error);
            }
        }

        // ÌéòÏù¥ÏßÄ Î°úÎìúÏãú FFmpeg Ï¥àÍ∏∞Ìôî
        loadFFmpeg();

        videoUploadArea.addEventListener('click', () => videoInput.click());

        videoUploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            videoUploadArea.classList.add('dragover');
        });

        videoUploadArea.addEventListener('dragleave', () => {
            videoUploadArea.classList.remove('dragover');
        });

        videoUploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            videoUploadArea.classList.remove('dragover');
            const files = Array.from(e.dataTransfer.files).filter(f => f.type.startsWith('video/'));
            handleVideoFiles(files);
        });

        videoInput.addEventListener('change', (e) => {
            handleVideoFiles(Array.from(e.target.files));
        });

        function handleVideoFiles(files) {
            if (files.length === 0) return;
            
            videoFiles = files;
            processedVideos = [];
            
            document.getElementById('video-settings').style.display = 'block';
            document.getElementById('video-file-list').style.display = 'block';
            document.getElementById('video-buttons').style.display = 'flex';
            
            displayVideoFiles();
        }

        function displayVideoFiles() {
            const fileList = document.getElementById('video-file-list');
            fileList.innerHTML = '';
            
            videoFiles.forEach((file, index) => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.innerHTML = `
                    <div class="file-info">
                        <div class="file-name">${file.name}</div>
                        <div class="file-size">${formatFileSize(file.size)}</div>
                    </div>
                    <div class="file-status" id="video-status-${index}">${getMessage('status_waiting')}</div>
                `;
                fileList.appendChild(fileItem);
            });
        }

        document.getElementById('video-process').addEventListener('click', async () => {
            if (!ffmpegLoaded) {
                alert(getMessage('message_ready'));
                return;
            }

            const quality = document.querySelector('input[name="video-quality"]:checked').value;
            const resolution = document.querySelector('input[name="video-resolution"]:checked').value;
            const removeAudio = document.getElementById('remove-audio').checked;

            const loading = document.getElementById('video-loading');
            const progressBar = document.getElementById('video-progress');
            progressBar.classList.add('active');
            
            processedVideos = [];
            let totalOriginalSize = 0;
            let totalCompressedSize = 0;

            for (let i = 0; i < videoFiles.length; i++) {
                const file = videoFiles[i];
                const statusElement = document.getElementById(`video-status-${i}`);
                statusElement.textContent = getMessage('status_processing');
                statusElement.className = 'file-status processing';
                
                loading.classList.add('active');
                loading.querySelector('.loading-text').textContent = `${getMessage('status_processing')}: ${file.name}`;

                try {
                    const processed = await processVideo(file, quality, resolution, removeAudio);
                    processedVideos.push(processed);
                    
                    totalOriginalSize += file.size;
                    totalCompressedSize += processed.blob.size;
                    
                    statusElement.textContent = getMessage('status_complete');
                    statusElement.className = 'file-status complete';
                } catch (error) {
                    console.error('Error processing video:', error);
                    statusElement.textContent = getMessage('status_error');
                    statusElement.className = 'file-status error';
                }

                const progress = ((i + 1) / videoFiles.length) * 100;
                progressBar.querySelector('.progress-fill').style.width = progress + '%';
            }

            loading.classList.remove('active');
            
            displayVideoStats(totalOriginalSize, totalCompressedSize);
            showSuccessMessage(`${videoFiles.length}${getMessage('message_compressed_video')}`);
            
            document.getElementById('video-download').style.display = 'inline-block';
            progressBar.classList.remove('active');
        });

        async function processVideo(file, quality, resolution, removeAudio) {
            const inputName = 'input.mp4';
            const outputName = 'output.mp4';
            
            const data = new Uint8Array(await file.arrayBuffer());
            ffmpeg.FS('writeFile', inputName, data);
            
            let ffmpegCommand = ['-i', inputName];
            
            if (quality === 'low') {
                ffmpegCommand.push('-crf', '28');
            } else if (quality === 'medium') {
                ffmpegCommand.push('-crf', '23');
            } else {
                ffmpegCommand.push('-crf', '18');
            }
            
            if (resolution !== 'original') {
                if (resolution === '1080') {
                    ffmpegCommand.push('-vf', 'scale=-2:1080');
                } else if (resolution === '720') {
                    ffmpegCommand.push('-vf', 'scale=-2:720');
                } else if (resolution === '480') {
                    ffmpegCommand.push('-vf', 'scale=-2:480');
                }
            }
            
            if (removeAudio) {
                ffmpegCommand.push('-an');
            }
            
            ffmpegCommand.push('-c:v', 'libx264', '-preset', 'medium', outputName);
            
            await ffmpeg.run(...ffmpegCommand);
            
            const outputData = ffmpeg.FS('readFile', outputName);
            const blob = new Blob([outputData.buffer], { type: 'video/mp4' });
            
            ffmpeg.FS('unlink', inputName);
            ffmpeg.FS('unlink', outputName);
            
            const baseName = file.name.substring(0, file.name.lastIndexOf('.')) || file.name;
            const fileName = `${baseName}.mp4`;
            
            return {
                blob: blob,
                name: fileName,
                originalName: file.name
            };
        }

        function displayVideoStats(originalSize, compressedSize) {
            document.getElementById('video-stats').classList.add('active');
            document.getElementById('video-total-files').textContent = videoFiles.length;
            document.getElementById('video-original-size').textContent = formatFileSize(originalSize);
            document.getElementById('video-compressed-size').textContent = formatFileSize(compressedSize);
            
            const savedPercentage = Math.round((1 - compressedSize / originalSize) * 100);
            document.getElementById('video-saved').textContent = savedPercentage + '%';
        }

        document.getElementById('video-download').addEventListener('click', async () => {
            if (processedVideos.length === 0) return;
            
            showSuccessMessage(getMessage('message_preparing'));
            
            if (processedVideos.length === 1) {
                downloadFile(processedVideos[0].blob, processedVideos[0].name);
            } else {
                const zip = new JSZip();
                processedVideos.forEach(video => {
                    zip.file(video.name, video.blob);
                });
                
                const zipBlob = await zip.generateAsync({type: 'blob'});
                downloadFile(zipBlob, 'videos.zip');
            }
            
            setTimeout(() => {
                showSuccessMessage(getMessage('message_complete'));
            }, 1000);
        });

        document.getElementById('video-clear').addEventListener('click', () => {
            videoFiles = [];
            processedVideos = [];
            document.getElementById('video-settings').style.display = 'none';
            document.getElementById('video-file-list').style.display = 'none';
            document.getElementById('video-stats').classList.remove('active');
            document.getElementById('video-buttons').style.display = 'none';
            document.getElementById('video-download').style.display = 'none';
            videoInput.value = '';
        });

        // ============= Ïú†Ìã∏Î¶¨Ìã∞ =============
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
        }

        function downloadFile(blob, filename) {
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        window.addEventListener('load', () => {
            initLanguage();
            console.log('OHOTORO HORIE Optimizer ready');
        });
    </script>
</body>
</html>
